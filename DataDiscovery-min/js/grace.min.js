LazyLoad=(function(k){var g,h,b={},e=0,f={css:[],js:[]},n=k.styleSheets;function m(r,q){var s=k.createElement(r),p;for(p in q){if(q.hasOwnProperty(p)){s.setAttribute(p,q[p])}}return s}function j(q){var s=b[q],t,r;if(s){t=s.callback;r=s.urls;r.shift();e=0;if(!r.length){t&&t.call(s.context,s.obj);b[q]=null;f[q].length&&l(q)}}}function c(){var p=navigator.userAgent;g={async:k.createElement("script").async===true};(g.webkit=/AppleWebKit\//.test(p))||(g.ie=/MSIE|Trident/.test(p))||(g.opera=/Opera/.test(p))||(g.gecko=/Gecko\//.test(p))||(g.unknown=true)}function l(B,A,C,x,t){var v=function(){j(B)},D=B==="css",r=[],w,y,u,s,z,q;g||c();if(A){A=typeof A==="string"?[A]:A.concat();if(D||g.async||g.gecko||g.opera){f[B].push({urls:A,callback:C,obj:x,context:t})}else{for(w=0,y=A.length;w<y;++w){f[B].push({urls:[A[w]],callback:w===y-1?C:null,obj:x,context:t})}}}if(b[B]||!(s=b[B]=f[B].shift())){return}h||(h=k.head||k.getElementsByTagName("head")[0]);z=s.urls;for(w=0,y=z.length;w<y;++w){q=z[w];if(D){u=g.gecko?m("style"):m("link",{href:q,rel:"stylesheet"})}else{u=m("script",{src:q});u.async=false}u.className="lazyload";u.setAttribute("charset","utf-8");if(g.ie&&!D&&"onreadystatechange" in u&&!("draggable" in u)){u.onreadystatechange=function(){if(/loaded|complete/.test(u.readyState)){u.onreadystatechange=null;v()}}}else{if(D&&(g.gecko||g.webkit)){if(g.webkit){s.urls[w]=u.href;d()}else{u.innerHTML='@import "'+q+'";';a(u)}}else{u.onload=u.onerror=v}}r.push(u)}for(w=0,y=r.length;w<y;++w){h.appendChild(r[w])}}function a(r){var q;try{q=!!r.sheet.cssRules}catch(p){e+=1;if(e<200){setTimeout(function(){a(r)},50)}else{q&&j("css")}return}j("css")}function d(){var q=b.css,p;if(q){p=n.length;while(--p>=0){if(n[p].href===q.urls[0]){j("css");break}}e+=1;if(q){if(e<200){setTimeout(d,50)}else{j("css")}}}}return{css:function(r,s,q,p){l("css",r,s,q,p)},js:function(r,s,q,p){l("js",r,s,q,p)}}})(this.document);(function(){var ai=this,ac=ai._,ae={},ar=Array.prototype,ab=Object.prototype,an=Function.prototype,aw=ar.push,ah=ar.slice,au=ar.concat,ak=ab.toString,aq=ab.hasOwnProperty,ad=ar.forEach,ag=ar.map,ao=ar.reduce,aa=ar.reduceRight,at=ar.filter,ap=ar.every,aj=ar.some,X=ar.indexOf,av=ar.lastIndexOf,Y=Array.isArray,ax=Object.keys,am=an.bind,Z=function(a){return a instanceof Z?a:this instanceof Z?(this._wrapped=a,void 0):new Z(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Z),exports._=Z):ai._=Z,Z.VERSION="1.4.4";var W=Z.each=Z.forEach=function(h,f,g){if(null!=h){if(ad&&h.forEach===ad){h.forEach(f,g)}else{if(h.length===+h.length){for(var c=0,d=h.length;d>c;c++){if(f.call(g,h[c],c,h)===ae){return}}}else{for(var b in h){if(Z.has(h,b)&&f.call(g,h[b],b,h)===ae){return}}}}}};Z.map=Z.collect=function(d,a,b){var c=[];return null==d?c:ag&&d.map===ag?d.map(a,b):(W(d,function(g,e,f){c[c.length]=a.call(b,g,e,f)}),c)};var H="Reduce of empty array with no initial value";Z.reduce=Z.foldl=Z.inject=function(f,b,c,d){var a=arguments.length>2;if(null==f&&(f=[]),ao&&f.reduce===ao){return d&&(b=Z.bind(b,d)),a?f.reduce(b,c):f.reduce(b)}if(W(f,function(h,g,e){a?c=b.call(d,c,h,g,e):(c=h,a=!0)}),!a){throw new TypeError(H)}return c},Z.reduceRight=Z.foldr=function(j,f,g,h){var c=arguments.length>2;if(null==j&&(j=[]),aa&&j.reduceRight===aa){return h&&(f=Z.bind(f,h)),c?j.reduceRight(f,g):j.reduceRight(f)}var d=j.length;if(d!==+d){var b=Z.keys(j);d=b.length}if(W(j,function(e,k,a){k=b?b[--d]:--d,c?g=f.call(h,g,j[k],k,a):(g=j[k],c=!0)}),!c){throw new TypeError(H)}return g},Z.find=Z.detect=function(d,a,b){var c;return Q(d,function(g,e,f){return a.call(b,g,e,f)?(c=g,!0):void 0}),c},Z.filter=Z.select=function(d,a,b){var c=[];return null==d?c:at&&d.filter===at?d.filter(a,b):(W(d,function(g,e,f){a.call(b,g,e,f)&&(c[c.length]=g)}),c)},Z.reject=function(c,a,b){return Z.filter(c,function(g,f,d){return !a.call(b,g,f,d)},b)},Z.every=Z.all=function(d,b,c){b||(b=Z.identity);var a=!0;return null==d?a:ap&&d.every===ap?d.every(b,c):(W(d,function(g,f,e){return(a=a&&b.call(c,g,f,e))?void 0:ae}),!!a)};var Q=Z.some=Z.any=function(d,b,c){b||(b=Z.identity);var a=!1;return null==d?a:aj&&d.some===aj?d.some(b,c):(W(d,function(g,f,e){return a||(a=b.call(c,g,f,e))?ae:void 0}),!!a)};Z.contains=Z.include=function(b,a){return null==b?!1:X&&b.indexOf===X?b.indexOf(a)!=-1:Q(b,function(c){return c===a})},Z.invoke=function(d,a){var b=ah.call(arguments,2),c=Z.isFunction(a);return Z.map(d,function(e){return(c?a:e[a]).apply(e,b)})},Z.pluck=function(b,a){return Z.map(b,function(c){return c[a]})},Z.where=function(c,a,b){return Z.isEmpty(a)?b?null:[]:Z[b?"find":"filter"](c,function(e){for(var d in a){if(a[d]!==e[d]){return !1}}return !0})},Z.findWhere=function(b,a){return Z.where(b,a,!0)},Z.max=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.max.apply(Math,d)}if(!a&&Z.isEmpty(d)){return -1/0}var c={computed:-1/0,value:-1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;e>=c.computed&&(c={value:h,computed:e})}),c.value},Z.min=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.min.apply(Math,d)}if(!a&&Z.isEmpty(d)){return 1/0}var c={computed:1/0,value:1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;c.computed>e&&(c={value:h,computed:e})}),c.value},Z.shuffle=function(d){var a,b=0,c=[];return W(d,function(e){a=Z.random(b++),c[b-1]=c[a],c[a]=e}),c};var al=function(a){return Z.isFunction(a)?a:function(b){return b[a]}};Z.sortBy=function(d,a,b){var c=al(a);return Z.pluck(Z.map(d,function(g,f,e){return{value:g,index:f,criteria:c.call(b,g,f,e)}}).sort(function(j,f){var g=j.criteria,h=f.criteria;if(g!==h){if(g>h||g===void 0){return 1}if(h>g||h===void 0){return -1}}return j.index<f.index?-1:1}),"value")};var P=function(g,c,d,f){var a={},b=al(c||Z.identity);return W(g,function(h,e){var j=b.call(d,h,e,g);f(a,j,h)}),a};Z.groupBy=function(c,a,b){return P(c,a,b,function(f,d,e){(Z.has(f,d)?f[d]:f[d]=[]).push(e)})},Z.countBy=function(c,a,b){return P(c,a,b,function(e,d){Z.has(e,d)||(e[d]=0),e[d]++})},Z.sortedIndex=function(k,f,g,h){g=null==g?Z.identity:al(g);for(var c=g.call(h,f),d=0,b=k.length;b>d;){var j=d+b>>>1;c>g.call(h,k[j])?d=j+1:b=j}return d},Z.toArray=function(a){return a?Z.isArray(a)?ah.call(a):a.length===+a.length?Z.map(a,Z.identity):Z.values(a):[]},Z.size=function(a){return null==a?0:a.length===+a.length?a.length:Z.keys(a).length},Z.first=Z.head=Z.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:ah.call(c,0,a)},Z.initial=function(c,a,b){return ah.call(c,0,c.length-(null==a||b?1:a))},Z.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:ah.call(c,Math.max(c.length-a,0))},Z.rest=Z.tail=Z.drop=function(c,a,b){return ah.call(c,null==a||b?1:a)},Z.compact=function(a){return Z.filter(a,Z.identity)};var G=function(c,a,b){return W(c,function(d){Z.isArray(d)?a?aw.apply(b,d):G(d,a,b):b.push(d)}),b};Z.flatten=function(b,a){return G(b,a,[])},Z.without=function(a){return Z.difference(a,ah.call(arguments,1))},Z.uniq=Z.unique=function(j,f,g,h){Z.isFunction(f)&&(h=g,g=f,f=!1);var c=g?Z.map(j,g,h):j,d=[],b=[];return W(c,function(a,k){(f?k&&b[b.length-1]===a:Z.contains(b,a))||(b.push(a),d.push(j[k]))}),d},Z.union=function(){return Z.uniq(au.apply(ar,arguments))},Z.intersection=function(b){var a=ah.call(arguments,1);return Z.filter(Z.uniq(b),function(c){return Z.every(a,function(d){return Z.indexOf(d,c)>=0})})},Z.difference=function(b){var a=au.apply(ar,ah.call(arguments,1));return Z.filter(b,function(c){return !Z.contains(a,c)})},Z.zip=function(){for(var d=ah.call(arguments),a=Z.max(Z.pluck(d,"length")),b=Array(a),c=0;a>c;c++){b[c]=Z.pluck(d,""+c)}return b},Z.object=function(f,b){if(null==f){return{}}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1]}return c},Z.indexOf=function(f,b,c){if(null==f){return -1}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=Z.sortedIndex(f,b),f[d]===b?d:-1}d=0>c?Math.max(0,a+c):c}if(X&&f.indexOf===X){return f.indexOf(b,c)}for(;a>d;d++){if(f[d]===b){return d}}return -1},Z.lastIndexOf=function(f,b,c){if(null==f){return -1}var d=null!=c;if(av&&f.lastIndexOf===av){return d?f.lastIndexOf(b,c):f.lastIndexOf(b)}for(var a=d?c:f.length;a--;){if(f[a]===b){return a}}return -1},Z.range=function(g,c,d){1>=arguments.length&&(c=g||0,g=0),d=arguments[2]||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=0,b=Array(f);f>a;){b[a++]=g,g+=d}return b},Z.bind=function(c,a){if(c.bind===am&&am){return am.apply(c,ah.call(arguments,1))}var b=ah.call(arguments,2);return function(){return c.apply(a,b.concat(ah.call(arguments)))}},Z.partial=function(b){var a=ah.call(arguments,1);return function(){return b.apply(this,a.concat(ah.call(arguments)))}},Z.bindAll=function(b){var a=ah.call(arguments,1);return 0===a.length&&(a=Z.functions(b)),W(a,function(c){b[c]=Z.bind(b[c],b)}),b},Z.memoize=function(c,a){var b={};return a||(a=Z.identity),function(){var d=a.apply(this,arguments);return Z.has(b,d)?b[d]:b[d]=c.apply(this,arguments)}},Z.delay=function(c,a){var b=ah.call(arguments,2);return setTimeout(function(){return c.apply(null,b)},a)},Z.defer=function(a){return Z.delay.apply(Z,[a,1].concat(ah.call(arguments,1)))},Z.throttle=function(k,f){var g,h,c,d,b=0,j=function(){b=new Date,c=null,d=k.apply(g,h)};return function(){var e=new Date,a=f-(e-b);return g=this,h=arguments,0>=a?(clearTimeout(c),c=null,b=e,d=k.apply(g,h)):c||(c=setTimeout(j,a)),d}},Z.debounce=function(f,b,c){var d,a;return function(){var g=this,e=arguments,h=function(){d=null,c||(a=f.apply(g,e))},j=c&&!d;return clearTimeout(d),d=setTimeout(h,b),j&&(a=f.apply(g,e)),a}},Z.once=function(c){var a,b=!1;return function(){return b?a:(b=!0,a=c.apply(this,arguments),c=null,a)}},Z.wrap=function(b,a){return function(){var c=[b];return aw.apply(c,arguments),a.apply(this,c)}},Z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}},Z.after=function(b,a){return 0>=b?a():function(){return 1>--b?a.apply(this,arguments):void 0}},Z.keys=ax||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var a=[];for(var b in c){Z.has(c,b)&&(a[a.length]=b)}return a},Z.values=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push(c[b])}return a},Z.pairs=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push([b,c[b]])}return a},Z.invert=function(c){var a={};for(var b in c){Z.has(c,b)&&(a[c[b]]=b)}return a},Z.functions=Z.methods=function(c){var a=[];for(var b in c){Z.isFunction(c[b])&&a.push(b)}return a.sort()},Z.extend=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){a[c]=b[c]}}}),a},Z.pick=function(c){var a={},b=au.apply(ar,ah.call(arguments,1));return W(b,function(d){d in c&&(a[d]=c[d])}),a},Z.omit=function(d){var b={},c=au.apply(ar,ah.call(arguments,1));for(var a in d){Z.contains(c,a)||(b[a]=d[a])}return b},Z.defaults=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){null==a[c]&&(a[c]=b[c])}}}),a},Z.clone=function(a){return Z.isObject(a)?Z.isArray(a)?a.slice():Z.extend({},a):a},Z.tap=function(b,a){return a(b),b};var L=function(g,q,b,k){if(g===q){return 0!==g||1/g==1/q}if(null==g||null==q){return g===q}g instanceof Z&&(g=g._wrapped),q instanceof Z&&(q=q._wrapped);var p=ak.call(g);if(p!=ak.call(q)){return !1}switch(p){case"[object String]":return g==q+"";case"[object Number]":return g!=+g?q!=+q:0==g?1/g==1/q:g==+q;case"[object Date]":case"[object Boolean]":return +g==+q;case"[object RegExp]":return g.source==q.source&&g.global==q.global&&g.multiline==q.multiline&&g.ignoreCase==q.ignoreCase}if("object"!=typeof g||"object"!=typeof q){return !1}for(var h=b.length;h--;){if(b[h]==g){return k[h]==q}}b.push(g),k.push(q);var m=0,d=!0;if("[object Array]"==p){if(m=g.length,d=m==q.length){for(;m--&&(d=L(g[m],q[m],b,k));){}}}else{var l=g.constructor,j=q.constructor;if(l!==j&&!(Z.isFunction(l)&&l instanceof l&&Z.isFunction(j)&&j instanceof j)){return !1}for(var v in g){if(Z.has(g,v)&&(m++,!(d=Z.has(q,v)&&L(g[v],q[v],b,k)))){break}}if(d){for(v in q){if(Z.has(q,v)&&!m--){break}}d=!m}}return b.pop(),k.pop(),d};Z.isEqual=function(b,a){return L(b,a,[],[])},Z.isEmpty=function(b){if(null==b){return !0}if(Z.isArray(b)||Z.isString(b)){return 0===b.length}for(var a in b){if(Z.has(b,a)){return !1}}return !0},Z.isElement=function(a){return !(!a||1!==a.nodeType)},Z.isArray=Y||function(a){return"[object Array]"==ak.call(a)},Z.isObject=function(a){return a===Object(a)},W(["Arguments","Function","String","Number","Date","RegExp"],function(a){Z["is"+a]=function(b){return ak.call(b)=="[object "+a+"]"}}),Z.isArguments(arguments)||(Z.isArguments=function(a){return !(!a||!Z.has(a,"callee"))}),"function"!=typeof/./&&(Z.isFunction=function(a){return"function"==typeof a}),Z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},Z.isNaN=function(a){return Z.isNumber(a)&&a!=+a},Z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==ak.call(a)},Z.isNull=function(a){return null===a},Z.isUndefined=function(a){return a===void 0},Z.has=function(b,a){return aq.call(b,a)},Z.noConflict=function(){return ai._=ac,this},Z.identity=function(a){return a},Z.times=function(f,b,c){for(var d=Array(f),a=0;f>a;a++){d[a]=b.call(c,a)}return d},Z.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1))};var K={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};K.unescape=Z.invert(K.escape);var C={escape:RegExp("["+Z.keys(K.escape).join("")+"]","g"),unescape:RegExp("("+Z.keys(K.unescape).join("|")+")","g")};Z.each(["escape","unescape"],function(a){Z[a]=function(b){return null==b?"":(""+b).replace(C[a],function(c){return K[a][c]})}}),Z.result=function(c,a){if(null==c){return null}var b=c[a];return Z.isFunction(b)?b.call(c):b},Z.mixin=function(a){W(Z.functions(a),function(b){var c=Z[b]=a[b];Z.prototype[b]=function(){var d=[this._wrapped];return aw.apply(d,arguments),U.call(this,c.apply(Z,d))}})};var J=0;Z.uniqueId=function(b){var a=++J+"";return b?b+a:a},Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,af={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;Z.template=function(f,m,b){var h;b=Z.defaults({},b,Z.templateSettings);var l=RegExp([(b.escape||z).source,(b.interpolate||z).source,(b.evaluate||z).source].join("|")+"|$","g"),g=0,k="__p+='";f.replace(l,function(c,n,p,a,q){return k+=f.slice(g,q).replace(V,function(e){return"\\"+af[e]}),n&&(k+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),p&&(k+="'+\n((__t=("+p+"))==null?'':__t)+\n'"),a&&(k+="';\n"+a+"\n__p+='"),g=q+c.length,c}),k+="';\n",b.variable||(k="with(obj||{}){\n"+k+"}\n"),k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{h=Function(b.variable||"obj","_",k)}catch(d){throw d.source=k,d}if(m){return h(m,Z)}var j=function(a){return h.call(this,a,Z)};return j.source="function("+(b.variable||"obj")+"){\n"+k+"}",j},Z.chain=function(a){return Z(a).chain()};var U=function(a){return this._chain?Z(a).chain():a};Z.mixin(Z),W(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=ar[b];Z.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!=b&&"splice"!=b||0!==c.length||delete c[0],U.call(this,c)}}),W(["concat","join","slice"],function(b){var a=ar[b];Z.prototype[b]=function(){return U.call(this,a.apply(this._wrapped,arguments))}}),Z.extend(Z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);Date.$VERSION=1.02;Date.LZ=function(a){return(a<0||a>9?"":"0")+a};Date.monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December");Date.monthAbbreviations=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");Date.dayNames=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");Date.dayAbbreviations=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat");Date.preferAmericanFormat=true;if(!Date.prototype.getFullYear){Date.prototype.getFullYear=function(){var a=this.getYear();return(a<1900?a+1900:a)}}Date.parseString=function(I,B){if(typeof(B)=="undefined"||B==null||B==""){var p=new Array("y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","MMM-d","d-MMM");var b=new Array("M/d/y","M-d-y","M.d.y","M/d","M-d");var n=new Array("d/M/y","d-M-y","d.M.y","d/M","d-M");var e=new Array(p,Date.preferAmericanFormat?b:n,Date.preferAmericanFormat?n:b);for(var z=0;z<e.length;z++){var v=e[z];for(var w=0;w<v.length;w++){var C=Date.parseString(I,v[w]);if(C!=null){return C}}}return null}this.isInteger=function(d){for(var c=0;c<d.length;c++){if("1234567890".indexOf(d.charAt(c))==-1){return false}}return true};this.getInt=function(J,l,y,j){for(var c=j;c>=y;c--){var d=J.substring(l,l+c);if(d.length<y){return null}if(this.isInteger(d)){return d}}return null};I=I+"";B=B+"";var H=0;var s=0;var E="";var g="";var G="";var k,h;var m=new Date().getFullYear();var F=1;var D=1;var a=0;var A=0;var u=0;var r="";while(s<B.length){E=B.charAt(s);g="";while((B.charAt(s)==E)&&(s<B.length)){g+=B.charAt(s++)}if(g=="yyyy"||g=="yy"||g=="y"){if(g=="yyyy"){k=4;h=4}if(g=="yy"){k=2;h=2}if(g=="y"){k=2;h=4}m=this.getInt(I,H,k,h);if(m==null){return null}H+=m.length;if(m.length==2){if(m>70){m=1900+(m-0)}else{m=2000+(m-0)}}}else{if(g=="MMM"||g=="NNN"){F=0;var q=(g=="MMM"?(Date.monthNames.concat(Date.monthAbbreviations)):Date.monthAbbreviations);for(var z=0;z<q.length;z++){var f=q[z];if(I.substring(H,H+f.length).toLowerCase()==f.toLowerCase()){F=(z%12)+1;H+=f.length;break}}if((F<1)||(F>12)){return null}}else{if(g=="EE"||g=="E"){var q=(g=="EE"?Date.dayNames:Date.dayAbbreviations);for(var z=0;z<q.length;z++){var t=q[z];if(I.substring(H,H+t.length).toLowerCase()==t.toLowerCase()){H+=t.length;break}}}else{if(g=="MM"||g=="M"){F=this.getInt(I,H,g.length,2);if(F==null||(F<1)||(F>12)){return null}H+=F.length}else{if(g=="dd"||g=="d"){D=this.getInt(I,H,g.length,2);if(D==null||(D<1)||(D>31)){return null}H+=D.length}else{if(g=="hh"||g=="h"){a=this.getInt(I,H,g.length,2);if(a==null||(a<1)||(a>12)){return null}H+=a.length}else{if(g=="HH"||g=="H"){a=this.getInt(I,H,g.length,2);if(a==null||(a<0)||(a>23)){return null}H+=a.length}else{if(g=="KK"||g=="K"){a=this.getInt(I,H,g.length,2);if(a==null||(a<0)||(a>11)){return null}H+=a.length;a++}else{if(g=="kk"||g=="k"){a=this.getInt(I,H,g.length,2);if(a==null||(a<1)||(a>24)){return null}H+=a.length;a--}else{if(g=="mm"||g=="m"){A=this.getInt(I,H,g.length,2);if(A==null||(A<0)||(A>59)){return null}H+=A.length}else{if(g=="ss"||g=="s"){u=this.getInt(I,H,g.length,2);if(u==null||(u<0)||(u>59)){return null}H+=u.length}else{if(g=="a"){if(I.substring(H,H+2).toLowerCase()=="am"){r="AM"}else{if(I.substring(H,H+2).toLowerCase()=="pm"){r="PM"}else{return null}}H+=2}else{if(I.substring(H,H+g.length)!=g){return null}else{H+=g.length}}}}}}}}}}}}}}if(H!=I.length){return null}if(F==2){if(((m%4==0)&&(m%100!=0))||(m%400==0)){if(D>29){return null}}else{if(D>28){return null}}}if((F==4)||(F==6)||(F==9)||(F==11)){if(D>30){return null}}if(a<12&&r=="PM"){a=a-0+12}else{if(a>11&&r=="AM"){a-=12}}return new Date(m,F-1,D,a,A,u)};Date.isValid=function(b,a){return(Date.parseString(b,a)!=null)};Date.prototype.isBefore=function(a){if(a==null){return false}return(this.getTime()<a.getTime())};Date.prototype.isAfter=function(a){if(a==null){return false}return(this.getTime()>a.getTime())};Date.prototype.equals=function(a){if(a==null){return false}return(this.getTime()==a.getTime())};Date.prototype.equalsIgnoreTime=function(c){if(c==null){return false}var b=new Date(this.getTime()).clearTime();var a=new Date(c.getTime()).clearTime();return(b.getTime()==a.getTime())};Date.prototype.format=function(G){G=G+"";var n="";var x=0;var J="";var f="";var l=this.getYear()+"";var g=this.getMonth()+1;var I=this.getDate();var q=this.getDay();var p=this.getHours();var A=this.getMinutes();var t=this.getSeconds();var v,w,b,u,L,e,F,D,B,r,O,p,N,j,a,C;var z=new Object();if(l.length<4){l=""+(+l+1900)}z.y=""+l;z.yyyy=l;z.yy=l.substring(2,4);z.M=g;z.MM=Date.LZ(g);z.MMM=Date.monthNames[g-1];z.NNN=Date.monthAbbreviations[g-1];z.d=I;z.dd=Date.LZ(I);z.E=Date.dayAbbreviations[q];z.EE=Date.dayNames[q];z.H=p;z.HH=Date.LZ(p);if(p==0){z.h=12}else{if(p>12){z.h=p-12}else{z.h=p}}z.hh=Date.LZ(z.h);z.K=z.h-1;z.k=z.H+1;z.KK=Date.LZ(z.K);z.kk=Date.LZ(z.k);if(p>11){z.a="PM"}else{z.a="AM"}z.m=A;z.mm=Date.LZ(A);z.s=t;z.ss=Date.LZ(t);while(x<G.length){J=G.charAt(x);f="";while((G.charAt(x)==J)&&(x<G.length)){f+=G.charAt(x++)}if(typeof(z[f])!="undefined"){n=n+z[f]}else{n=n+f}}return n};Date.prototype.getDayName=function(){return Date.dayNames[this.getDay()]};Date.prototype.getDayAbbreviation=function(){return Date.dayAbbreviations[this.getDay()]};Date.prototype.getMonthName=function(){return Date.monthNames[this.getMonth()]};Date.prototype.getMonthAbbreviation=function(){return Date.monthAbbreviations[this.getMonth()]};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.add=function(a,c){if(typeof(a)=="undefined"||a==null||typeof(c)=="undefined"||c==null){return this}c=+c;if(a=="y"){this.setFullYear(this.getFullYear()+c)}else{if(a=="M"){this.setMonth(this.getMonth()+c)}else{if(a=="d"){this.setDate(this.getDate()+c)}else{if(a=="w"){var b=(c>0)?1:-1;while(c!=0){this.add("d",b);while(this.getDay()==0||this.getDay()==6){this.add("d",b)}c-=b}}else{if(a=="h"){this.setHours(this.getHours()+c)}else{if(a=="m"){this.setMinutes(this.getMinutes()+c)}else{if(a=="s"){this.setSeconds(this.getSeconds()+c)}}}}}}}return this};(function(a){a.fn.appendAt=function(d,b){var c=this.children();if(b<0){if(c.length>0){a(c[0]).before(d)}else{this.append(d)}}else{if(b<c.length){a(c[b]).before(d)}else{this.append(d)}}}})(jQuery);(function(){Date.monthNames=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];Date.dateNames=(function(){var a=_.range(1,31+1);_.each(a,function(c,b,d){d[b]=c+"日"});return a})();Date.dayNames=["周日","周一","周二","周三","周四","周五","周六"];Date.hourNames=(function(){var a=_.range(0,24);_.each(a,function(c,b,d){d[b]=c+"时"});return a})();Date.prototype.getMonsday=function(){var a=new Date();a.setTime(this.getTime());a.clearTime();a.setDate(a.getDate()-(a.getDay()===0?6:a.getDay()-1));return a}})();(function(){var b;if(window){andrea=window.andrea||{}}else{andrea=andrea||{}}if(window.andrea){andrea.blink=window.andrea.blink||{}}else{andrea.blink=andrea.blink||{}}var a=andrea.blink;a.VERSION=function(){return"1.0.0"};a.BUILD=function(){return 1};a.declare=function(d){if(!d){throw new Error("name required")}if(typeof(d)!="string"){throw new Error("name has to be a string")}if(d.charAt(0)=="."||d.charAt(d.length-1)=="."||d.indexOf("..")!=-1){throw new Error("illegal name: "+d)}d=d.split(".");var e=window;for(var c=0;c<d.length;c++){e[d[c]]=e[d[c]]||{};e=e[d[c]]}return e};a.require=function(c){};a.extend=function(g,c){var d=g.prototype;if(c){g.superclass=c.prototype}else{console.log(g)}var e=function(){};e.prototype=c.prototype;g.prototype=new e();for(var f in d){if(d.hasOwnProperty(f)){g.prototype[f]=d[f]}}g.prototype.constructor=g;if(c.prototype.constructor==Object.prototype.constructor){c.prototype.constructor=c}return g}})();(function(){var b=andrea.blink;b.declare("andrea.blink.utils");var c=andrea.blink.utils;var a=0;c.genUID=function(){if(!a){a=0}return"vcgen_"+(a++)};var d={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"};c.applyObjectProperty=function(h,g,f){try{if(c.isFunction(h[g])){h[g](f)}else{h[g]=f}}catch(j){console.log(j)}};c.applyProperties=function(h,g){if(g!=null){var e=g.length;for(var f=0;f<e;f++){var j=g[f];if(j&&j!=null){c.applyObjectProperty(h,j.name,j.value)}}}};c.getObjectProperty=function(g,f){try{if(c.isFunction(g[f])){return g[f]()}else{if(g.hasOwnProperty(f)){return g[f]}}}catch(h){console.log(h)}};c.type=function(e){return e==null?String(e):d[Object.prototype.toString.call(e)]||"object"};c.isFunction=function(e){return c.type(e)==="function"};c.isBoolean=function(e){return c.type(e)==="boolean"};c.isString=function(e){return c.type(e)==="string"};c.isArray=function(e){return c.type(e)==="array"};c.isNumber=function(e){return c.type(e)==="number"};c.isRegExp=function(e){return c.type(e)==="regexp"};c.sortArrayOn=function(e,g,f){if(c.isArray(e)&&c.isString(g)){e.sort(function(j,h){return f?(j[g]<h[g])-(j[g]>h[g]):(j[g]>h[g])-(j[g]<h[g])})}};c.noop=function(){}})();(function(){var a=andrea.blink;a.declare("andrea.blink.events.Event");var b=andrea.blink.events.Event=function(c,e,d){this.__className="andrea.blink.events.Event";this._type=c;this._target=e;this.data=d};b.prototype.type=function(){return this._type};b.prototype.target=function(){return this._target}})();(function(){var a=andrea.blink;a.declare("andrea.blink.events.EventDispatcher");var b=andrea.blink.utils;var c=andrea.blink.events.EventDispatcher=function(){this.__className="andrea.blink.events.EventDispatcher";this._enableDispatchEvent=true};c.prototype.addEventListener=function(h,f,m,k){if(!k){k=0}var d=this._findEventListener(h,f,m);if(d){return}d={type:h,scope:m,listener:f,priority:k};var j=this.listeners()[h];if(!j){this.listeners()[h]=j=[d]}else{var g=false;for(var e=0;e<j.length;++e){var l=j[e];if(k>l.priority){j.splice(e,0,d);g=true;break}}if(g==false){j.push(d)}}};c.prototype.removeEventListener=function(g,h,f){var d=this._findEventListener(g,h,f);if(d){var e=this.listeners()[g];e.splice(e.indexOf(d),1)}};c.prototype.removeEventListeners=function(d){this.listeners()[d]=[]};c.prototype.removeAllEventListeners=function(){this._listeners={}};c.prototype.hasEventListener=function(f,g,e){var d=this._findEventListener(f,g,e);return d!=null};c.prototype.hasEventListeners=function(e){var d=this.listeners()[e];if(d){return d.length>0}return false};c.prototype.dispatchEvent=function(f){if(this._enableDispatchEvent===undefined){this._enableDispatchEvent=true}if(this._enableDispatchEvent){var e=f.type();var d=this.listeners()[e];if(d){var h=d.slice(0);for(var j=0;j<h.length;++j){var g=h[j];g.listener.call(g.scope,f)}}}};c.prototype.enableDispatchEvent=function(d){if(this._enableDispatchEvent===undefined){this._enableDispatchEvent=true}if(arguments.length>=1){if(b.isBoolean(d)){this._enableDispatchEvent=d}return this}else{return this._enableDispatchEvent}};c.prototype._findEventListener=function(g,h,f){var e=this.listeners()[g];if(!e){return null}for(var j=0;j<e.length;++j){var d=e[j];if(d.listener===h&&d.scope===f){return d}}return null};c.prototype.listeners=function(){if(this._listeners===undefined){this._listeners={}}return this._listeners}})();(function(){var a=andrea.blink;a.declare("andrea.blink.mvc.Action");var b=andrea.blink.mvc.Action=function(){this.__className="andrea.blink.mvc.Action"};b.prototype.execute=function(c){return null};b.prototype._getModel=function(c){return null}})();(function(){var a=andrea.blink;a.declare("andrea.blink.mvc.Model");var b=andrea.blink.mvc.Model=function(){this.__className="andrea.blink.mvc.Model";this._notifyRequested=null};b.prototype._notify=function(c,d){};b.prototype._deferNotify=function(c){if(this._notifyRequested){this._notifyRequested.names.push(c)}else{this._notifyRequested={names:[c]};var d=this;_.defer(function(){var f=_.uniq(d._notifyRequested.names);d._notifyRequested=null;for(var e=0;e<f.length;e++){d._notify.call(d,f[e])}})}}})();(function(){var a=andrea.blink;a.declare("andrea.blink.mvc.Notification");var b=andrea.blink.mvc.Notification=function(c,e,d){b.superclass.constructor.apply(this,arguments);this.__className="andrea.blink.mvc.Notification";this._type=c;this._target=null;this._source=e;this.data=d};a.extend(andrea.blink.mvc.Notification,andrea.blink.events.Event);b.prototype.source=function(){return this._source}})();(function(){var a=andrea.blink;a.declare("andrea.blink.mvc.View");var b=andrea.blink.mvc.View=function(c){b.superclass.constructor.apply(this,arguments);this.__className="andrea.blink.mvc.View";this._dom=c;this._explicitWidth=null;this._explicitHeight=null;this._measuredWidth=0;this._measuredHeight=0};a.extend(andrea.blink.mvc.View,andrea.blink.events.EventDispatcher);b.prototype.dom=function(){return this._dom};b.prototype.size=function(c){if(arguments.length>0){var d=false;if(c.width!=null&&this._explicitWidth!==c.width){this._explicitWidth=c.width;d=true}if(c.height!=null&&this._explicitHeight!==c.height){this._explicitHeight=c.height;d=true}if(d){this.invalidateSize()}return this}else{if(this._explicitWidth==null||this._explicitHeight==null){this._measuredWidth=$(this._dom).outerWidth();this._measuredHeight=$(this._dom).outerHeight()}return{width:this._explicitWidth!=null?this._explicitWidth:this._measuredWidth,height:this._explicitHeight!=null?this._explicitHeight:this._measuredHeight,}}};b.prototype.invalidateSize=function(){this._validateSize()};b.prototype._validateSize=function(){}})();(function(){var a=andrea.blink;a.declare("andrea.blink.mvc.ViewMediator");var b=andrea.blink.mvc.ViewMediator=function(){this.__className="andrea.blink.mvc.ViewMediator"};b.prototype.init=function(){};b.prototype._getModel=function(c){return null};b.prototype._subscribe=function(c,d){};b.prototype._unsubscribe=function(c,d){};b.prototype._action=function(c,d){return null}})();(function(){var a=andrea.blink;a.declare("andrea.blink.mvc.App");var e=andrea.blink.mvc;var b=andrea.blink.utils;var d=andrea.blink.events.EventDispatcher;var c=andrea.blink.mvc.App=function(){this.__className="andrea.blink.mvc.App";var m={};var h={};var q={};var j=new d();var k=function(r,s){if(b.isString(r)&&j.hasEventListeners(r)){var t=new e.Notification(r,this,s);j.dispatchEvent(t)}};var p=function(r){if(b.isString(r)){return h[r]}return null};var l=function(r){if(b.isString(r)){return h[r]}return null};var n=function(r,s){if(b.isString(r)&&b.isFunction(s)){j.addEventListener(r,s)}};var f=function(r,s){if(b.isString(r)&&b.isFunction(s)){j.removeEventListener(r,s)}};var g=function(t,u){if(b.isString(t)){var v=m[t];if(b.isFunction(v)){var r=null;var s=new v();if(s instanceof e.Action){s._getModel=p;r=s.execute.call(s,u)}s=null;return r}}return null};this.registerAction=function(r,s){if(b.isString(r)&&b.isFunction(s)){m[r]=s}};this.unregisterAction=function(r){if(b.isString(r)){var s=m[r];if(b.isFunction(s)){delete m[r]}}};this.registerModel=function(s,r){if(b.isString(s)&&r instanceof e.Model){r._notify=k;h[s]=r}};this.unregisterModel=function(r){if(b.isString(r)){delete h[r]}};this.registerViewMediator=function(r,s){if(b.isString(r)&&s instanceof e.ViewMediator){q[r]=s;s._getModel=l;s._subscribe=n;s._unsubscribe=f;s._action=g;s.init()}};this.unregisterViewMediator=function(r){if(b.isString(r)){var s=q[r];if(s instanceof e.ViewMediator){delete q[r];delete s._getModel;delete s._subscribe;delete s._unsubscribe;delete s._action}}}}})();(function(){andrea.blink.declare("andrea.grace");var a=andrea.grace;andrea.blink.declare("andrea.grace.Index");var b=a.Index=function(c){$(document).bind("selectstart",function(){return false});b._instance=this;$(window).load($.proxy(function(){LazyLoad.js(c,$.proxy(this._jsReady,this));this._$index=$(".grace-index");var e=$("#btnYourData",this._$index);var d=$("#btnSampleData",this._$index);d.on("click",$.proxy(this._btnSampleDataClickHandler,this));this._$dataDiscovery=$(".grace-analysis")},this));this._$index=null;this._$dataDiscovery=null;this._lazyLoading=true;this._dp=null};b._instance=null;b.flashCallback=function(d,c){return b._instance._flashDataHandler.apply(b._instance,arguments)};b.prototype._flashDataHandler=function(d,c){var e=function(f){return JSON.parse(decodeURIComponent(f))};_.defer($.proxy(this._dpReady,this),{rows:_.isString(d)?e(d):d,columnDescriptors:_.isString(c)?e(c):c,source:"excel"});return true};b.prototype._btnSampleDataClickHandler=function(){this._dpReady(new a.testingData.SampleTOPTrade())};b.prototype._dpReady=function(c){this._dp=c;this._gotoDataDiscovery()};b.prototype._jsReady=function(){this._lazyLoading=false;this._gotoDataDiscovery()};b.prototype._gotoDataDiscovery=function(){if(!this._dp){return}if(this._lazyLoading){return}var c=new a.DataDiscovery($("#divDataDiscovery")[0]);c.rowBasedDataProvider(this._dp.rows,this._dp.columnDescriptors,this._dp.source);var d="pt-page-scaleDown";var e="pt-page-moveFromTop pt-page-ontop pt-page-delay300";var g=false;var f=false;function j(l,k){g=false;f=false;l.detach();k.removeClass(e)}var h="webkitAnimationEnd";this._$index.addClass(d).on(h,$.proxy(function(){this._$index.off(h);g=true;if(f){j(this._$index,this._$dataDiscovery)}},this));this._$dataDiscovery.addClass(e).on(h,$.proxy(function(){this._$dataDiscovery.off(h);f=true;if(g){j(this._$index,this._$dataDiscovery)}},this))}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.AppConst");var a=andrea.grace.constants.AppConst;a.MODEL_GRACE="MODEL_GRACE";a.MEDIATOR_DATA_DISCOVERY="MEDIATOR_DATA_DISCOVERY";a.MEDIATOR_ANALYSIS_SRC_DIM="MEDIATOR_ANALYSIS_SRC_DIM";a.MEDIATOR_ANALYSIS_SRC_MEA="MEDIATOR_ANALYSIS_SRC_MEA";a.MEDIATOR_ANALYSIS_DES_DIM="MEDIATOR_ANALYSIS_DES_DIM";a.MEDIATOR_ANALYSIS_DES_MEA="MEDIATOR_ANALYSIS_DES_MEA";a.MEDIATOR_ANALYSIS_RESULT="MEDIATOR_ANALYSIS_RESULT";a.MEDIATOR_VIZ_NAVIGATOR="MEDIATOR_VIZ_NAVIGATOR";a.ACTION_CHANGE_DATA_PROVIDER="ACTION_CHANGE_DATA_PROVIDER";a.ACTION_RUN_ANALYSIS="ACTION_RUN_ANALYSIS";a.NOTIFICATION_DATA_PROVIDER_CHANGED="NOTIFICATION_DATA_PROVIDER_CHANGED";a.NOTIFICATION_VIZ_CONTEXT_CHANGED="NOTIFICATION_VIZ_CONTEXT_CHANGED";a.NOTIFICATION_VIZ_CONTEXT_APPLIED="NOTIFICATION_VIZ_CONTEXT_APPLIED";a.VIEW_NOTIFICATION_PASTE_TO="VIEW_NOTIFICATION_PASTE_TO"})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.ShelfType");var a=b.constants.ShelfType;a.SRC_DIM="srcDim";a.SRC_MEA="srcMea";a.DES_DIM="desDimX";a.DES_VALUE="desMeaValueY";a.PROC_FILTER="procFilter";a.like=function(d,c){return d.substring(0,3)===c.substring(0,3)};a.src=function(c){return c&&c.substring(0,3)==="src"};a.des=function(c){return c&&c.substring(0,3)==="des"};a.proc=function(c){return c&&c.substring(0,4)==="proc"};a.dim=function(c){return c===a.SRC_DIM||c===a.DES_DIM}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.AnalysisType");var a=b.constants.AnalysisType;a.DIMENSION="dimension";a.MEASURE="measure"})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.DataType");var a=b.constants.DataType;a.STRING="string";a.NUMBER="number";a.GEO="geo";a.DATE="date"})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.VizType");var a=b.constants.VizType;a.RECOMMEND="RECOMMEND";a.BAR="BAR";a.STACKED_BAR="STACKED_BAR";a.COLUMN="COLUMN";a.STACKED_COLUMN="STACKED_COLUMN";a.LINE="LINE";a.AREA="AREA";a.RADAR="RADAR";a.PIE="PIE";a.WATERFALL="WATERFALL";a.SCATTER="SCATTER";a.BUBBLE="BUBBLE";a.TABLE="TABLE";a.GEO="GEO";a.TREE_MAP="TREE_MAP";a._MANIFESTS=(function(){var d=function(h,j,f,e,g){return{type:h,title:j,required:{numDimensions:f,numMeasures:e},icon:g}};var c={};c[a.RECOMMEND]=d(a.RECOMMEND,"推荐",0,0,"");c[a.COLUMN]=d(a.COLUMN,"柱状图",0,1,"./assets/navigator/column.png","");c[a.BAR]=d(a.BAR,"条状图",0,1,"./assets/navigator/bar.png","");c[a.RADAR]=d(a.RADAR,"雷达图",1,1,"./assets/navigator/radar.png","");c[a.SCATTER]=d(a.SCATTER,"散点图",1,1,"./assets/navigator/scatter.png","");c[a.BUBBLE]=d(a.BUBBLE,"气泡图",1,3,"./assets/navigator/bubble.png","");c[a.LINE]=d(a.LINE,"折线图",1,1,"./assets/navigator/line.png","");c[a.AREA]=d(a.AREA,"面积图",1,1,"./assets/navigator/area.png","");c[a.PIE]=d(a.PIE,"饼图",1,1,"./assets/navigator/pie.png","");c[a.STACKED_COLUMN]=d(a.STACKED_COLUMN,"堆积柱状图",2,1,"./assets/navigator/stackedColumn.png","");c[a.STACKED_BAR]=d(a.STACKED_BAR,"堆积条状图",2,1,"./assets/navigator/stackedBar.png","");return c})();a.manifest=function(c){return a._MANIFESTS[c]};a.vertical=function(c){return c===a.BAR||c===a.STACKED_BAR};a.horizontal=function(c){return c===a.COLUMN||c===a.STACKED_COLUMN||c===a.LINE||c===a.AREA}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.operation.OperationPriorityBaseline");var b=a.operation.OperationPriorityBaseline;b.DISPLAY_ONLY=0;b.DEFAULT_OPERATION=10000;b.USER_SPECIFICATION=20000})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.operation.OperationType");var a=b.operation.OperationType;a.CARD_REMOVE="CARD_REMOVE";a.CARD_ADD_TO_DIMENSION="CARD_ADD_TO_DIMENSION";a.CARD_ADD_TO_MEASURE="CARD_ADD_TO_MEASURE";a.CALC_COUNT="CALC_COUNT";a.CALC_UNIQ_COUNT="CALC_UNIQ_COUNT";a.CALC_SUM="CALC_SUM";a.CALC_AVG="CALC_AVG";a.CALC_MAX="CALC_MAX";a.CALC_MIN="CALC_MIN";a.SORT_NONE="SORT_NONE";a.SORT_ASCEND="SORT_ASCEND";a.SORT_DESCEND="SORT_DESCEND";a.DRILL_YEAR="DRILL_YEAR";a.DRILL_MONTH="DRILL_MONTH";a.DRILL_WEEK="DRILL_WEEK";a.DRILL_DATE="DRILL_DATE";a.GROUP_MONTH="GROUP_MONTH";a.GROUP_DATE="GROUP_DATE";a.GROUP_DAY="GROUP_DAY";a.GROUP_HOUR="GROUP_HOUR"})(jQuery);(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.operation.OperationClassification");var b=a.operation.OperationClassification;b.CARD_OPERATION="cardOperation";b.CALCULATE="calculate";b.SORT="sort";b.DRILL="drill";b.GROUP="group";b.exclusive=function(d,c){if(d===c){return true}else{if((d===b.DRILL||d===b.GROUP)&&(c===b.DRILL||c===b.GROUP)){return true}else{return false}}}})();(function(d){var c=andrea.grace;var e=c.operation.OperationClassification;var b=c.operation.OperationType;andrea.blink.declare("andrea.grace.operation.Operation");var a=c.operation.Operation=function(g,f){this.id=_.uniqueId("operationID_");this.type=g;this.priority=f;this.name=a._TYPE_TO_NAME[this.type];this.abbreviation=a._TYPE_TO_ABBREVIATION[this.type];this.classification=a._TYPE_TO_CLASSIFICATION[this.type];this.classificationName=a._CLASSIFICATION_TO_NAME[this.classification]};a._TYPE_TO_NAME={};a._TYPE_TO_ABBREVIATION={};a._TYPE_TO_CLASSIFICATION={};a._CLASSIFICATION_TO_TYPES={};a._CLASSIFICATION_TO_NAME={};a._loadClass=function(){var j=function(n,m,l,p){a._TYPE_TO_CLASSIFICATION[m]=n;a._TYPE_TO_NAME[m]=l;a._TYPE_TO_ABBREVIATION[m]=p;if(!a._CLASSIFICATION_TO_TYPES[n]){a._CLASSIFICATION_TO_TYPES[n]=[]}a._CLASSIFICATION_TO_TYPES[n].push(m)};var h=function(m,l){a._CLASSIFICATION_TO_NAME[m]=l};h(e.CARD_OPERATION,"删除");h(e.CALCULATE,"计算");h(e.SORT,"排序");h(e.DRILL,"每");h(e.GROUP,"按...分组");j(e.CARD_OPERATION,b.CARD_ADD_TO_DIMENSION,"\uf067 分析纬度","");j(e.CARD_OPERATION,b.CARD_ADD_TO_MEASURE,"\uf067 分析指标","");j(e.CARD_OPERATION,b.CARD_REMOVE,"\uf00d 移除","");j(e.CALCULATE,b.CALC_COUNT,"总数","总");j(e.CALCULATE,b.CALC_UNIQ_COUNT,"计数（唯一）","计");j(e.CALCULATE,b.CALC_SUM,"∑ 总和","∑");j(e.CALCULATE,b.CALC_AVG,"平均值","均");j(e.CALCULATE,b.CALC_MAX,"最大值","大");j(e.CALCULATE,b.CALC_MIN,"最小值","小");j(e.SORT,b.SORT_NONE,"不排序","");j(e.SORT,b.SORT_ASCEND,"\uf160 升序","\uf160");j(e.SORT,b.SORT_DESCEND,"\uf161 降序","\uf161");var g=new Date();j(e.DRILL,b.DRILL_YEAR,"每年 ("+g.format("yyyy")+")","每年");j(e.DRILL,b.DRILL_MONTH,"每月 ("+g.format("yyyy/M")+")","每月");var k=g.getMonsday();var f=new Date();f.setTime(k.getTime()+7*24*3600*1000);j(e.DRILL,b.DRILL_WEEK,"每周 ("+k.format("yyyy/M/d")+" - "+f.format("M/d")+")","每周");j(e.DRILL,b.DRILL_DATE,"每日 ("+g.format("yyyy/M/d")+")","每日");j(e.GROUP,b.GROUP_MONTH,"按月划分 (1 - 12)","按月");j(e.GROUP,b.GROUP_DATE,"按日划分 (1 - 31)","按日");j(e.GROUP,b.GROUP_DAY,"按星期划分 (1 - 7)","按星");j(e.GROUP,b.GROUP_HOUR,"按时划分 (0 - 23)","按时")};a._loadClass();a.getTypes=function(f){return a._CLASSIFICATION_TO_TYPES[f]}})(jQuery);(function(d){var b=andrea.grace;var a=b.operation.Operation;var e=b.operation.OperationPriorityBaseline;andrea.blink.declare("andrea.grace.operation.OperationFactory");var c=b.operation.OperationFactory;if(!c._count){c._count=0}if(!c._mapping){c._mapping={}}c.produce=function(f,g){var h=new a(f,g+c._count);c._count++;c._mapping[h.id]=h;return h};c.get=function(f){return c._mapping[f]}})(jQuery);(function(e){var c=andrea.grace;var b=c.operation.OperationType;var a=c.operation.Operation;var d=c.operation.OperationFactory;var g=c.operation.OperationClassification;andrea.blink.declare("andrea.grace.operation.OperationGroup");var f=c.operation.OperationGroup=function(h){this._operations=null;this._typeToOperation=null;this._initialize(h)};f.createByTypes=function(j,l){if(l){l=OperationPriorityBaseline.DISPLAY_ONLY}var k=[];for(var h=0;h<j.length;h++){var m=d.produce(j[h]);k.push(m.id)}return new f(k)};f.createByClassification=function(j,k){var h=a.getTypes(j);if(k){k.splice(0,0,h);h=_.without.apply(null,k)}return f.createByTypes(h)};f.prototype._initialize=function(j){this._operations=[];this._typeToOperation={};if(!j){return}var h;for(h=0;h<j.length;h++){var l=j[h];var k=d.get(l);this._operations.push(k);this._typeToOperation[k.type]=k}};f.prototype.operations=function(){return this._operations};f.prototype.mapIDs=function(){return _.map(this._operations,function(h){return h.id})};f.prototype.mapNames=function(){return _.map(this._operations,function(h){return h.name})};f.prototype.mapAbbrs=function(){return _.map(this._operations,function(h){return h.abbreviation})};f.prototype.get=function(h){return this._typeToOperation[h]};f.prototype.ascend=function(){return this.get(b.SORT_ASCEND)};f.prototype.descend=function(){return this.get(b.SORT_DESCEND)};f.prototype.has=function(h){return this._typeToOperation[h]!==undefined};f.prototype.hasClassification=function(h){return _.map(this._operations,function(j){return j.classification}).indexOf(h)!=-1};f.prototype.calculator=function(){if(this.has(b.CALC_COUNT)){return new c.calculator.Count()}else{if(this.has(b.CALC_UNIQ_COUNT)){return new c.calculator.UniqCount()}else{if(this.has(b.CALC_SUM)){return new c.calculator.Sum()}else{if(this.has(b.CALC_AVG)){return new c.calculator.Avg()}else{if(this.has(b.CALC_MAX)){return new c.calculator.Max()}else{if(this.has(b.CALC_MIN)){return new c.calculator.Min()}}}}}}return null};f.prototype.addOperation=function(j){var h=d.get(j);this._operations=_.filter(this._operations,function(k){return !g.exclusive(k.classification,h.classification)});this._operations.push(h)};f.prototype.removeOperation=function(j){var h=d.get(j);this._operations=_.without(this._operations,h)}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.utils.ConverterType");var a=b.utils.ConverterType;a.ANY="any";a.STRING="string";a.NUMBER="number";a.EXCEL_DATE="excelDate";a.DATE="date";a._dateFormats=(function(){var c=[];c.push("yyyy/MM/dd");c.push("yyyy/M/d");c.push("yy/MM/dd");c.push("yy/M/d");c.push("MM/dd/yyyy");c.push("M/d/yyyy");c.push("MM/dd/yy");c.push("M/d/yy");c.reverse();return c})();a.getDateFormats=function(){return a._dateFormats}})();(function(){var c=andrea.grace;var b=c.utils.ConverterType;andrea.blink.declare("andrea.grace.utils.DataConvertUtil");var a=c.utils.DataConvertUtil;a.match=function(d,g){var f=null;var e=null;if(d){if(f===null){f=a._convertNumber(d);if(g&&(f>=32874&&f<=47848)){f=a._convertExcelDate(d);e=b.EXCEL_DATE}else{e=b.NUMBER}}if(f===null){f=a._convertDate(d);e=b.DATE}if(f===null){f=a._convertString(d);e=b.STRING}}else{e=b.ANY;f=null}return{type:e,value:f}};a.getConverter=function(d){if(d===b.NUMBER){return a._convertNumber}else{if(d===b.DATE){return a._convertDate}else{if(d===b.EXCEL_DATE){return a._convertExcelDate}else{if(d===b.STRING){return a._convertString}else{return null}}}}};a._convertString=function(d){if(d!=null){return d.toString().trim()}else{return""}};a._convertNumber=function(d){if(d!=null){var e=d.toString().trim();if(!isNaN(e)){return Number(e)}else{if(e.length>1&&e.substr(e.length-1,1)==="%"){e=e.substr(0,e.length-1);if(!isNaN(e)){return Number(e)}}}}else{return 0}return null};a._convertDate=function(f){if(!f){return}var h=f.toString().trim();if(h.length<6||isNaN(h.substr(0,1))||isNaN(h.substr(h.length-1,1))){return null}h=h.replace(/[年月日_-]/g,"/");if(h.indexOf("/")===-1){return null}var j;if(h.indexOf(" ")!==-1){if(h.indexOf(":")===-1){return null}else{if(h.indexOf(":")===h.lastIndexOf(":")){j="H:m"}else{j="H:m:s"}}}var e=null;if(a._preferDateTest){e=Date.parseString(h,a._preferDateTest)}var d=b.getDateFormats();for(var g=d.length-1;g>=0&&!e;g--){var k=d[g];if(j){k=k+" "+j}e=Date.parseString(h,k);if(e){a._preferDateTest=k}}return e};a._preferDateTest=null;a._convertExcelDate=function(e){if(!e){return}var f=e.toString().trim();if(isNaN(f)){return null}excelTime=parseFloat(f);if(excelTime>a._WRONG_DATE_IN_EXCEL_FORMAT){excelTime=excelTime-1}var h=a._EXCEL_BASE_TIME-a._DAY_IN_MILLISECONDS;var g=h+excelTime*a._DAY_IN_MILLISECONDS;var d=new Date();d.setTime(g+a._getTimezoneOffsetMS());return d};a._EXCEL_BASE_TIME=-2208988800000;a._WRONG_DATE_IN_EXCEL_FORMAT=60;a._DAY_IN_MILLISECONDS=86400000;a._TIMEZONE_OFFSET_MS=0;a._createAndReadTimezoneOffset=function(){a._TIMEZONE_OFFSET_MS=new Date().getTimezoneOffset()*60*1000;a._getTimezoneOffsetMS=a._readTimezoneOffset;return a._readTimezoneOffset()};a._readTimezoneOffset=function(){return a._TIMEZONE_OFFSET_MS};a._getTimezoneOffsetMS=a._createAndReadTimezoneOffset})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.utils.ColorUtil");var b=a.utils.ColorUtil;b.hexToRgb=function(e){var d=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(d,function(h,k,j,f){return k+k+j+j+f+f});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null};b.rgbToHex=function(e,d,c){return"#"+b._componentToHex(e)+b._componentToHex(d)+b._componentToHex(c)};b._componentToHex=function(e){var d=e.toString(16);return d.length==1?"0"+d:d}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.utils.Stopwatch");var a=b.utils.Stopwatch=function(d,c){this._s=null;this._laps=null;this.type=d;if(c===true){this.start()}};a.prototype.start=function(){this._s=new Date().getTime();this._laps=[]};a.prototype.lap=function(){var c=this._laps;c.push(new Date().getTime());if(c.length>1){return c[c.length-1]-c[c.length-2]}else{return c[0]-this._s}}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.supportClasses.ICalculator");var a=b.calculator.supportClasses.ICalculator=function(){};a.prototype.addFactor=function(c){};a.prototype.calculate=function(){return 0}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Sum");var a=b.calculator.Sum=function(){this._sum=0};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){c=parseFloat(c);if(!isNaN(c)){this._sum=parseFloat((this._sum+c).toFixed(4))}};a.prototype.calculate=function(){return this._sum}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Max");var b=a.calculator.Max=function(){this._max=0};andrea.blink.extend(b,a.calculator.supportClasses.ICalculator);b.prototype.addFactor=function(c){if(!isNaN(c)){this._max=Math.max(this._max,c)}};b.prototype.calculate=function(){return this._max}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Min");var a=b.calculator.Min=function(){this._max=Number.MAX_VALUE};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){if(!isNaN(c)){this._max=Math.min(this._max,c)}};a.prototype.calculate=function(){return this._max}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Avg");var a=b.calculator.Avg=function(){this._sumTimes100=0;this._count=0};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){if(!isNaN(c)){this._sumTimes100+=Math.round(c*100)}this._count++};a.prototype.calculate=function(){return Math.round(this._sumTimes100/this._count)/100}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Count");var a=b.calculator.Count=function(){this._count=0};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){this._count++};a.prototype.calculate=function(){return this._count}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.calculator.UniqCount");var b=a.calculator.UniqCount=function(){this._count=0;this._mapping={}};andrea.blink.extend(b,a.calculator.supportClasses.ICalculator);b.prototype.addFactor=function(c){if(!this._mapping[c]){this._mapping[c]=true;this._count++}};b.prototype.calculate=function(){return this._count}})();(function(b){var a=andrea.grace;andrea.blink.declare("andrea.grace.managers.PopUpManager");var c=a.managers.PopUpManager;c.createPopUp=function(e){var d=b(e.dom());d.appendTo(b("body"));return e};c.removePopUp=function(e){var d=b(e.dom());d.detach()}})(jQuery);(function(e){var d=andrea.grace;andrea.blink.declare("andrea.grace.models.vo.Analysis");var b=d.constants.ShelfType;var c=d.utils.DataConvertUtil;var a=d.models.vo.Analysis=function(){this.id=_.uniqueId("analysisID_");this.index=null;this.name=null;this.dataType=null;this.analysisType=null;this.numUniqueValue=null;this.dateSpan=null}})(jQuery);(function(e){var d=andrea.grace;var b=d.constants.DataType;var a=d.constants.AnalysisType;var f=d.operation.OperationClassification;andrea.blink.declare("andrea.grace.models.vo.ShelvedAnalysis");var c=d.models.vo.ShelvedAnalysis=function(h,g){this.id=h;this.source=g;this.operationGroup=null;this.visualized=false;this.numPartialVisualized=0};c.prototype.isDateSeries=function(){return this.source.dataType===b.DATE&&this.operationGroup.hasClassification(f.DRILL)};c.prototype.multiply=function(h){var g={};if(h&&h.source&&h.source.numUniqueValue){g.numUniqueValue=this.source.numUniqueValue*h.source.numUniqueValue}else{g.numUniqueValue=this.source.numUniqueValue}return g}})(jQuery);(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.models.DataProvider");var a=b.models.DataProvider=function(d){this._values2d=d;this.numRows=0;this.numColumns=0;this._columnBasedValues2d=null;this._columnBasedUniqueValues2d=null;this._build()};andrea.blink.extend(a,andrea.blink.mvc.Model);a.prototype.getRow=function(d){return this._values2d[d]};a.prototype._build=function(){var h,g;var f;var d=[];this._columnBasedValues2d=[];this._columnBasedUniqueValues2d=[];this.numRows=this._values2d.length;this.numColumns=this._values2d[0].length;f=this.getRow(0);for(g=0;g<f.length;g++){this._columnBasedValues2d[g]=[];this._columnBasedUniqueValues2d[g]=[];d[g]=[]}for(h=0;h<this.numRows;h++){f=this.getRow(h);for(g=0;g<f.length;g++){var e=f[g];this._columnBasedValues2d[g].push(e);if(!d[g][e]){d[g][e]=true;this._columnBasedUniqueValues2d[g].push(e)}}}};a.prototype.getCValues=function(d){return _.clone(this._columnBasedValues2d[d])};a.prototype.getCUniqueValues=function(d){return _.clone(this._columnBasedUniqueValues2d[d])};a.prototype.getCUniqueValuesBySA=function(d){return this.getCUniqueValues(d.source.index)}})(jQuery);(function(f){var e=andrea.grace;andrea.blink.declare("andrea.grace.models.DataDiscoveryModel");var d=e.constants.ShelfType;var a=andrea.grace.constants.AppConst;var c=e.constants.VizType;var b=e.models.DataDiscoveryModel=function(){b.superclass.constructor.apply(this,arguments);this.raw=null;this.analyses=null;this.dataProvider=null;this._analysisDimesions=[];this._analysisDatas=[];this._vizType=c.RECOMMEND};andrea.blink.extend(b,andrea.blink.mvc.Model);b.prototype.viewNotify=function(g,h){this._notify(g,h)};b.prototype.setDataProvider=function(h,g,j){this.raw=h;this.analyses=g;this.dataProvider=j;this._vizType=c.RECOMMEND;this._analysisDimesions=[];this._analysisDatas=[];this._notify(a.NOTIFICATION_DATA_PROVIDER_CHANGED)};b.prototype.vizType=function(g){if(arguments.length>0){if(this._vizType!==g){this._vizType=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}}else{return this._vizType}};b.prototype.analysisDimesions=function(g){if(arguments.length>0){this._analysisDimesions=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}else{return this._analysisDimesions}};b.prototype.analysisDatas=function(g){if(arguments.length>0){this._analysisDatas=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}else{return this._analysisDatas}};b.prototype.invalidateShelvedAnalysis=function(){this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_APPLIED)};b.prototype.getAnalyses=function(j){var g=[];for(var h=0;h<j.length;h++){g.push(this.getAnalysis(j[h]))}return g};b.prototype.getAnalysis=function(g){return this._get(g,this.analyses)};b.prototype.getShelvedAnalysis=function(h){var g=this._get(h,this._analysisDimesions);if(!g){g=this._get(h,this._analysisDatas)}return g};b.prototype._get=function(j,g){for(var h=0;h<g.length;h++){if(g[h].id===j){return g[h]}}return null}})(jQuery);(function(){var j=andrea.grace;andrea.blink.declare("andrea.grace.actions.ChangeDataProviderAction");var k=j.utils.ConverterType;var g=j.constants.DataType;var d=andrea.grace.constants.AnalysisType;var h=andrea.grace.constants.AppConst;var c=j.models.vo.Analysis;var a=j.models.DataProvider;var f=j.utils.DataConvertUtil;var b=j.utils.Stopwatch;var e=j.actions.ChangeDataProviderAction=function(){e.superclass.constructor.apply(this,arguments)};andrea.blink.extend(e,andrea.blink.mvc.Action);e.prototype.execute=function(x){e.superclass.execute.apply(this,arguments);var H={columnDescriptors:x.columnDescriptors,rows:x.rows,source:x.source};var P,O;var U=H.source==="excel";var A=H.columnDescriptors;var D=H.rows;var t=D.length;var y=A.length;var G=new b("ChangeDataProviderAction, "+t+"*"+y,true);var R=[];for(O=0;O<y;O++){var T=new c();T.index=O;var S=A[O];T.name=S.name;T.analysisType=S.analysisType;R[O]=T}var I=[];var n=null;var K=null;var q=[];var Q;for(P=t-1;P>=0;P--){I[P]=[];var w=D[P];for(O=y-1;O>=0;O--){var m=w[O];Q=q[O];if(!Q){q[O]=Q={numByType:{}};Q.numByType[k.ANY]=0}var s=R[O].converterType;if(s){if(!Q.fn){Q.fn=f.getConverter(s)}K=Q.fn.call(null,m)}else{var F=U;if(Q.numByType&&Q.numByType[k.NUMBER]&&Q.numByType[k.NUMBER]>3){F=false}var z=f.match(m,F);s=z.type;K=z.value;if(!Q.numByType[s]){Q.numByType[s]=0}Q.numByType[s]++}I[P][O]=K}}console.log("["+G.type+"] parse: "+G.lap());for(O=0;O<y;O++){T=R[O];if(!T.name){T.name="列"+(O+1)}if(!T.dataType){var L=false;var N=false;var C=null;Q=q[O];if(Q.numByType){for(s in Q.numByType){var u=Q.numByType[s];var E=Q.numByType[k.ANY];if(s===k.ANY){continue}if(u/(t-E)>0.5){if(s===k.EXCEL_DATE||s===k.DATE){T.dataType=g.DATE}else{if(s===k.NUMBER){T.dataType=g.NUMBER}else{if(s===k.STRING){T.dataType=g.STRING}}}if(u/t===1){L=true}else{C=s;if((u+E)/t===1){N=true}}break}}}if(!T.dataType){T.dataType=g.STRING}if(!L){var B=f.getConverter(C);for(P=t-1;P>=0;P--){m=D[P][O];if(!m||!N){I[P][O]=B.call(null,m)}}}else{}}if(!T.analysisType){if(T.dataType===g.NUMBER){T.analysisType=d.MEASURE}else{T.analysisType=d.DIMENSION}}}console.log("["+G.type+"] rinse: "+G.lap());var J=new a(I);for(O=0;O<y;O++){T=R[O];var l=J.getCUniqueValues(O);T.numUniqueValue=l.length;if(T.dataType===g.DATE){var l=_.without(l,null);var v=_.sortBy(l,function(V){return V.getTime()});var M=v[0];var p=v[v.length-1];T.dateSpan=p.getTime()-M.getTime()}}var r=this._getModel(h.MODEL_GRACE);r.setDataProvider(H,R,J);console.log("["+G.type+"] setDataProvider: "+G.lap())}})();(function(){var e=andrea.grace;andrea.blink.declare("andrea.grace.actions.RunAnalysisAction");var b=andrea.grace.constants.AppConst;var c=e.constants.ShelfType;var d=e.models.vo.ShelvedAnalysis;var a=e.actions.RunAnalysisAction=function(){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.mvc.Action);a.prototype.execute=function(m){a.superclass.execute.apply(this,arguments);var h;var g=c;var j=this._getModel(b.MODEL_GRACE);if(g.des(m.shelfType)&&m.shelvedContexts){var f=m.shelfType;var k=m.shelvedContexts;var n=[];for(h=0;h<k.length;h++){var p=k[h];var l=j.getShelvedAnalysis(p.shelvedAnalysisID);if(!l){l=new d(p.shelvedAnalysisID,j.getAnalysis(p.analysisID))}l.operationGroup=p.operationGroup;n.push(l)}if(f===g.DES_DIM){if(!_.isEqual(n,j.analysisDimesions())){j.analysisDimesions(n)}}else{if(f===g.DES_VALUE){if(!_.isEqual(n,j.analysisDatas())){j.analysisDatas(n)}}}}else{if(m.vizType){j.vizType(m.vizType)}}}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.events.ShelfEvent");var b=a.views.analysisContainer.events.ShelfEvent=function(c,e,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.events.Event);b.CARD_COPIED="cardCopied";b.CARD_SHELVED="cardShelved";b.HELPER_DROPPED="helperDropped"})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.PopUpEvent");var a=b.views.popUp.PopUpEvent=function(c,e,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.events.Event);a.POPUP_OPENED="popupOpened";a.POPUP_CLOSED="popupClosed"})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.PopUpBase");var e=b.managers.PopUpManager;var a=b.views.popUp.PopUpEvent;var d=b.views.popUp.PopUpBase=function(f){d.superclass.constructor.apply(this,arguments);this._classVisible=null};andrea.blink.extend(d,andrea.blink.mvc.View);d.prototype.open=function(g){var h=this;var f=c(this._dom);f.css({position:"absolute",left:g.offset().left,top:g.offset().top+g.outerHeight()});if(this._classVisible){_.defer(function(){f.addClass(h._classVisible)})}e.createPopUp(this);this.dispatchEvent(new a(a.POPUP_OPENED,this))};d.prototype.close=function(g){var h=this;var f=c(this._dom);if(g==null){g=1}if(this._classVisible){f.removeClass(this._classVisible);g=2000}if(g>0){setTimeout(function(){e.removePopUp(h)},g)}else{e.removePopUp(h)}this.dispatchEvent(new a(a.POPUP_CLOSED,this))};d.prototype.closeImmediately=function(){this.close(0)}})(jQuery);(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.MenuEvent");var b=a.views.popUp.MenuEvent=function(c,e,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.events.Event);b.ITEM_SELECTED="itemSelected"})();(function(b){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.OperationMenu");var c=a.views.popUp.MenuEvent;var d=a.views.popUp.OperationMenu=function(e){d.superclass.constructor.apply(this,arguments);this._classVisible="grace-menu-visible";this._operationGroups=null};andrea.blink.extend(d,a.views.popUp.PopUpBase);d.create=function(f){var g=new d(b("<div/>"));var e=g.dom();e.addClass("grace-menu");g._createChildren(f);return g};d.prototype.open=function(g){d.superclass.open.apply(this,arguments);var l=this;var f=b(this._dom);var e=true;var k=function(){setTimeout(function(){if(!e){l.close()}},240)};var j=function(){e=true};var h=function(){e=false;k()};g.hover(j,h);b(this._dom).hover(j,h)};d.prototype._createChildren=function(e){this._operationGroups=e;this._createMenu(this._operationGroups,b(this._dom))};d.prototype._createMenu=function(q,r){var m=this;var n=function(j){p=b(j.currentTarget);m.dispatchEvent(new c(c.ITEM_SELECTED,m,{operation:p.data("__operation")}));m.close()};var l=b("<ul/>").appendTo(r);var k,h;var f;var e;for(k=0;k<q.length;k++){e=q[k].operations();if(k!==0){b("<div/>").appendTo(l)}for(h=0;h<e.length;h++){var p=b("<li/>").appendTo(l);var g=b("<a/>").appendTo(p);f=e[h];p.data({__operation:f}).click(n);g.text(f.name)}}}})(jQuery);(function(g){var j=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.supportClasses.ShelfBase");var h=j.constants.DataType;var f=andrea.grace.constants.AnalysisType;var l=j.views.analysisContainer.events.ShelfEvent;var e=j.models.vo.Analysis;var d=j.constants.ShelfType;var m=j.views.popUp.OperationMenu;var a=j.views.popUp.PopUpEvent;var k=j.operation.OperationFactory;var q=j.views.popUp.MenuEvent;var r=j.operation.OperationGroup;var p=j.operation.OperationClassification;var c=j.operation.OperationPriorityBaseline;var b=j.operation.OperationType;var n=j.views.analysisContainer.supportClasses.ShelfBase=function(u){n.superclass.constructor.apply(this,arguments);var v=this;this._$ph=g("<div/>").addClass("grace-analysis-card_placeholder");this._operationMenu=null;this._type=null;this._layout=null;this._initialization();this.helperGetAnalysis=null;g(this._dom).css({}).addClass("grace-analysis-contaier");var t;t=g(this._dom);t=g("<div/>").appendTo(t).addClass("grace-analysis-titleArea grace-analysis-clearfix");t=g("<div/>").appendTo(t).addClass("grace-analysis-title");g("<h2/>").appendTo(t).addClass("grace-analysis-title-text");g("<a/>").appendTo(t).addClass("grace-analysis-title-icon");t=g(this._dom);t=g("<div/>").appendTo(t).addClass("grace-analysis-cardArea");var s=g("<div/>").appendTo(t).addClass("grace-analysis-cards fancy-scrollbar");if(this._layout==="horizontal"){s.addClass("grace-analysis-cards_noScroll")}g("<div/>").appendTo(t).addClass("grace-analysis-cardArea-gradientTop");g("<div/>").appendTo(t).addClass("grace-analysis-cardArea-gradientBottom");g(this._dom).droppable({tolerance:"pointer",accept:function(x){var A=x.attr("__containerType");var z=v._type;var w=v.helperGetAnalysis(x.attr("__analysisID"));var y=d;if(y.src(z)){if(z===d.SRC_MEA){if(y.src(A)&&w.dataType===h.NUMBER){return true}}else{if(y.src(A)){return true}}}else{if(y.des(z)){if(z===d.DES_DIM){if(w.analysisType===f.DIMENSION){return true}}else{return true}}else{if(y.proc(z)){return true}}}return false},activate:function(x){var w=g(x.currentTarget);var A=w.attr("__containerType");var z=v._type;var y=d;if(A!==z&&y.des(z)){g(this).addClass("grace-analysis-contaier_dropAcceptable")}},deactivate:function(w){g(this).removeClass("grace-analysis-contaier_dropAcceptable");v._$ph.detach()},drop:function(x,y){var A=y.helper.attr("__containerType");var z=v._type;v._$ph.detach();y.helper.attr("__toContainerType",z);var w=null;if(A===z){w=y.helper.attr("__shelvedAnalysisID")}v.dispatchEvent(new l(l.HELPER_DROPPED,v,{analysisID:y.helper.attr("__analysisID"),"$helper":y.helper,from:A,to:z}));v.dispatchEvent(new l(l.CARD_SHELVED,v,{shelvedContexts:v.getShelvedContexts()}))},over:function(x,y){y.helper.attr("__overContainerType",v._type);v._$ph.attr("__toIndex","");var w=g(v._dom).find(".grace-analysis-cards");v._$ph.appendTo(w).css({width:y.helper.outerWidth()+"px",height:y.helper.outerHeight()+"px"});if(v._layout==="horizontal"){v._$ph.addClass("grace-analysis-card_horizontal")}y.helper.on("event-drag",function(){var A=[];var D=-1;v._traversalCards(function(F){var G=g(this);if(G.attr("__dragging")==="true"){D=A.length}A.push({top:G.offset().top,left:G.offset().left})},true,false);var E;if(v._layout==="vertical"){E="top"}else{if(v._layout==="horizontal"){E="left"}}var C=y.helper.offset()[E];for(i=-1;i<A.length;i++){var B=i<0?Number.MIN_VALUE:A[i][E];var z=i===A.length-1?Number.MAX_VALUE:A[i+1][E];if(C>B&&C<=z){if(v._$ph.attr("__toIndex")!==i+1+""){v._$ph.detach();v._$ph.attr("__toIndex",i+1);if(D===-1||(D!==i+1&&D!==i)){w.appendAt(v._$ph,i+1)}}break}}}).removeClass("grace-analysis-card_draggingHelper_noDrop").addClass("grace-analysis-card_draggingHelper_grabbing")},out:function(w,x){var y=x.helper.attr("__overContainerType");if(v._type===y){x.helper.off("event-drag").addClass("grace-analysis-card_draggingHelper_noDrop").removeClass("grace-analysis-card_draggingHelper_grabbing")}v._$ph.detach()}})};andrea.blink.extend(n,andrea.blink.mvc.View);n.OPERATION_DISPLAY_SPLITTER=" | ";n.prototype.getShelvedContexts=function(){var s=[];this._traversalCards(function(u){var v=g(this);var t={analysisID:v.attr("__analysisID"),shelvedAnalysisID:v.attr("__shelvedAnalysisID"),operationGroup:new r(JSON.parse(v.attr("__operationIDs")))};s.push(t)},true,true);return s};n.prototype._traversalCards=function(z,w,A){var s=g(this._dom).find(".grace-analysis-cards");var u=s.children();var y=0;for(var x=0;x<u.length;x++){var v=u[x];var t=g(v);if(w&&v===this._$ph[0]){continue}if(A&&t.attr("__dragging")==="true"){continue}z.call(v,y);y++}};n.prototype._setTitle=function(t){var s=g(this._dom).find("h2");s.text(t)};n.prototype._setRequired=function(t){var s=g(this._dom).find("h2");if(t){s.addClass("grace-analysis-title-text_required")}else{s.removeClass("grace-analysis-title-text_required")}};n.prototype.addSuffix=function(t){var s=g(this._dom).find("h2");if(t){s.addClass("grace-analysis-title-text_suffix").attr({__suffix:t})}else{s.removeClass("grace-analysis-title-text_suffix")}};n.prototype.type=function(s){if(arguments.length>0){this._type=s}else{return this._type}};n.prototype.dropAnalysis=function(s,t,w,v){var u=this._addCardAt(s,parseInt(this._$ph.attr("__toIndex")),t,w!==v)};n.prototype.addCard=function(s){this._addCardAt(s)};n.prototype._getOperationInfo=function(){return{availableOGs:[],defaultTypes:[]}};n.prototype._addCardAt=function(F,B,E,C){var A=this;var s=g(this._dom).find(".grace-analysis-cards");var t=g("<div/>").addClass("grace-analysis-card");if(this._layout==="horizontal"){t.addClass("grace-analysis-card_horizontal")}s.appendAt(t,B);var v;if(E&&!C){v=E.attr("__shelvedAnalysisID")}else{v=_.uniqueId("shelvedAnalysisID_")}t.data({__analysis:F});t.attr({__analysisID:F.id,__shelvedAnalysisID:v,__containerType:this._type});var D=g("<div/>").appendTo(t).addClass("grace-analysis-card-text grace-text-ellipsis").text(F.name);D.bind("mouseenter",function(){var H=g(this);if(this.offsetWidth<this.scrollWidth&&!t.attr("title")){t.attr("title",H.text())}});var x;var y;if(E&&E.attr("__operationIDs")){y=JSON.parse(E.attr("__operationIDs"))}var w=this._getOperationInfo(F);var u=w.availableOGs;var z=w.defaultTypes;if(d.des(this._type)){if(u&&u.length>0){x=g("<span/>").appendTo(t).addClass("grace-analysis-card-operation grace-analysis-card-operation_dropDown");x.hover(function(H){A._createOperationMenu(u,F,t,x)},null)}}else{if(d.src(this._type)){x=g("<span/>").appendTo(t).addClass("grace-analysis-card-operation grace-analysis-card-operation_add");x.click(function(I){var H;if(A._type===d.SRC_DIM){H=d.DES_DIM}else{if(A._type===d.SRC_MEA){H=d.DES_VALUE}}A.dispatchEvent(new l(l.CARD_COPIED,A,{analysis:t.data("__analysis"),pasteTo:H}))})}}if(!y||y.length===0){y=r.createByTypes(z).mapIDs()}if(!y){y=[]}this._setOperations(y,t);if(d.src(this._type)){if(this._type===d.SRC_DIM){F.analysisType=f.DIMENSION}else{if(this._type===d.SRC_MEA){F.analysisType=f.MEASURE}}}if(d.dim(this._type)){var G;if(F.dataType===h.DATE){G="\uf073"}else{if(F.numUniqueValue!==null){G=F.numUniqueValue}}if(G){D.addClass("grace-analysis-card-text_suffix").attr({__suffix:G})}}t.addClass("grace-analysis-card_asSource");if(d.des(this._type)){if(this._type===d.DES_DIM){t.addClass("grace-analysis-card_asDimension")}else{if(this._type===d.DES_VALUE){t.addClass("grace-analysis-card_asMeasure")}}}t.draggable({containment:g("#divDataDiscovery"),helper:function(H){var I=g(this).clone();I.width(g(this).width()).addClass("grace-analysis-card_draggingHelper");I.removeClass("grace-analysis-card_asSource grace-analysis-card_asDimension grace-analysis-card_asMeasure");I.appendTo(g("body"));return I},start:function(H,I){g(this).addClass("grace-analysis-card_disabled").attr({__dragging:"true"});I.helper.addClass("grace-analysis-card_draggingHelper_grabbing")},stop:function(H,I){g(this).removeClass("grace-analysis-card_disabled").attr({__dragging:"false"});I.helper.removeClass("grace-analysis-card_draggingHelper_grabbing");var K=I.helper.attr("__containerType");var J=I.helper.attr("__toContainerType");if(J){if(d.like(K,J)){g(this).detach()}}else{if(d.des(K)){g(this).detach()}}I.helper.off("event-drag");A.dispatchEvent(new l(l.CARD_SHELVED,A,{shelvedContexts:A.getShelvedContexts()}))},drag:function(H,I){I.helper.trigger("event-drag")}});return t};n.prototype._addOperation=function(s,v){var u=k.produce(s,c.USER_SPECIFICATION);var t=new r(JSON.parse(v.attr("__operationIDs")));t.addOperation(u.id);this._setOperations(t.mapIDs(),v)};n.prototype._setOperations=function(x,y){var t=y.find(".grace-analysis-card-text");var w=JSON.stringify(x);if(w){if(y.attr("__operationIDs")!==w){y.attr({__shelvedAnalysisID:_.uniqueId("shelvedAnalysisID_"),__operationIDs:w})}var v=new r(x);var u=v.mapAbbrs();u=_.without(u,"");var s=u.join(n.OPERATION_DISPLAY_SPLITTER);if(s){t.addClass("grace-analysis-card-text_prefix").attr({__prefix:s})}else{t.removeClass("grace-analysis-card-text_prefix")}}else{y.removeAttr("__operationIDs");t.removeClass("grace-analysis-card-text_prefix")}};n.prototype._createOperationMenu=function(s,t,w,v){if(this._operationMenu){return}var u=this;v.addClass("grace-analysis-card-operation_hover");this._operationMenu=m.create(s);this._operationMenu.addEventListener(q.ITEM_SELECTED,function(y){var x=y.data.operation;if(x.classification===p.CARD_OPERATION){var z=function(B,A){u.dispatchEvent(new l(l.CARD_COPIED,u,{analysis:B.data("__analysis"),pasteTo:A}))};if(x.type===b.CARD_REMOVE){w.detach()}else{if(x.type===b.CARD_ADD_TO_DIMENSION){z(w,d.DES_DIM)}else{if(x.type===b.CARD_ADD_TO_MEASURE){z(w,d.DES_VALUE)}}}}else{u._addOperation(x.type,w)}u.dispatchEvent(new l(l.CARD_SHELVED,u))});this._operationMenu.addEventListener(a.POPUP_CLOSED,function(x){v.removeClass("grace-analysis-card-operation_hover");u._operationMenu.removeAllEventListeners();u._operationMenu=null},this);this._operationMenu.open(v)};n.prototype.updateShelvedAnalyses=function(t){var u=this;var s=0;this._traversalCards(function(w){var x=g(this);var v=t(x.attr("__shelvedAnalysisID"));if(v&&v.visualized){s++}},true,true);this._traversalCards(function(w){var x=g(this);var v=t(x.attr("__shelvedAnalysisID"));if(v){if(s>0&&!v.visualized){x.addClass("grace-analysis-card_disabled")}else{x.removeClass("grace-analysis-card_disabled")}u._setOperations(v.operationGroup.mapIDs(),x)}},true,true)};n.prototype.removeAll=function(){var s=g(this._dom).find(".grace-analysis-cards");s.empty()};n.prototype._validateSize=function(){var s=this.size();var u=s.height-36;var t=g(this._dom).find(".grace-analysis-cards");t.css({"max-height":u+"px",height:u+"px"})}})(jQuery);(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.supportClasses.ShelfBaseMediator");var a=c.constants.AppConst;var f=c.views.analysisContainer.events.ShelfEvent;var b=c.views.popUp.VizNavigatorEvent;var e=c.views.analysisContainer.supportClasses.ShelfBaseMediator=function(g){e.superclass.constructor.apply(this,arguments);this._view=g;this._model=null};andrea.blink.extend(e,andrea.blink.mvc.ViewMediator);e.prototype.init=function(){var h=this;this._model=this._getModel(a.MODEL_GRACE);this._view.helperGetAnalysis=function(j){return h._model.getAnalysis(j)};var g=function(){h._action(a.ACTION_RUN_ANALYSIS,{shelfType:h._view.type(),shelvedContexts:h._view.getShelvedContexts()})};this._view.addEventListener(f.CARD_SHELVED,function(j){g()},this);this._view.addEventListener(f.HELPER_DROPPED,function(k){var j=h._model.getAnalysis(k.data.analysisID);h._view.dropAnalysis(j,k.data.$helper,k.data.from,k.data.to)});this._view.addEventListener(f.CARD_COPIED,function(j){h._model.viewNotify(a.VIEW_NOTIFICATION_PASTE_TO,{analysis:j.data.analysis,targetShelfType:j.data.pasteTo})});this._subscribe(a.VIEW_NOTIFICATION_PASTE_TO,function(j){if(h._view.type()===j.data.targetShelfType){h._view.addCard(j.data.analysis)}g()});this._subscribe(a.NOTIFICATION_DATA_PROVIDER_CHANGED,function(j){h._dataProviderChangedHandler(j)});this._subscribe(a.NOTIFICATION_VIZ_CONTEXT_APPLIED,function(j){h._view.updateShelvedAnalyses(function(k){return h._model.getShelvedAnalysis(k)})})};e.prototype._dataProviderChangedHandler=function(g){this._view.removeAll()}})(jQuery);(function(){var e=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcDimensionShelf");var a=e.constants.AnalysisType;var b=e.constants.ShelfType;var g=e.operation.OperationClassification;var d=e.operation.OperationType;var f=e.operation.OperationGroup;var c=e.views.analysisContainer.source.SrcDimensionShelf=function(h){c.superclass.constructor.apply(this,arguments);this._setTitle("纬度");$(this._dom).css({})};andrea.blink.extend(c,e.views.analysisContainer.supportClasses.ShelfBase);c.prototype._initialization=function(){this._type=b.SRC_DIM;this._layout="vertical"}})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcDimensionShelfMediator");var b=c.constants.AppConst;var a=andrea.grace.constants.AnalysisType;var e=c.views.analysisContainer.source.SrcDimensionShelfMediator=function(){e.superclass.constructor.apply(this,arguments)};andrea.blink.extend(e,c.views.analysisContainer.supportClasses.ShelfBaseMediator);e.prototype.init=function(){e.superclass.init.apply(this,arguments)};e.prototype._dataProviderChangedHandler=function(){e.superclass._dataProviderChangedHandler.apply(this,arguments);var g=this._getModel(b.MODEL_GRACE);for(var h=0;h<g.analyses.length;h++){var f=g.analyses[h];if(f.analysisType===a.DIMENSION){this._view.addCard(f)}}}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcMeasureShelf");var a=d.constants.AnalysisType;var b=d.constants.ShelfType;var g=d.operation.OperationClassification;var c=d.operation.OperationType;var f=d.operation.OperationGroup;var e=d.views.analysisContainer.source.SrcMeasureShelf=function(h){e.superclass.constructor.apply(this,arguments);this._setTitle("指标")};andrea.blink.extend(e,d.views.analysisContainer.supportClasses.ShelfBase);e.prototype._initialization=function(){this._type=b.SRC_MEA;this._layout="vertical"}})();(function(e){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcMeasureShelfMediator");var b=d.constants.AppConst;var a=andrea.grace.constants.AnalysisType;var c=d.views.analysisContainer.source.SrcMeasureShelfMediator=function(){c.superclass.constructor.apply(this,arguments)};andrea.blink.extend(c,d.views.analysisContainer.supportClasses.ShelfBaseMediator);c.prototype.init=function(){c.superclass.init.apply(this,arguments)};c.prototype._dataProviderChangedHandler=function(){c.superclass._dataProviderChangedHandler.apply(this,arguments);var g=this._getModel(b.MODEL_GRACE);this._view.addSuffix(g.dataProvider.numRows);for(var h=0;h<g.analyses.length;h++){var f=g.analyses[h];if(f.analysisType===a.MEASURE){this._view.addCard(f)}}}})(jQuery);(function(){var f=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesDimensionShelf");var a=f.constants.AnalysisType;var c=f.constants.DataType;var d=f.constants.ShelfType;var h=f.operation.OperationClassification;var e=f.operation.OperationType;var g=f.operation.OperationGroup;var b=f.views.analysisContainer.destination.DesDimensionShelf=function(j){b.superclass.constructor.apply(this,arguments);this._setTitle("分析维度");this._setRequired(true)};andrea.blink.extend(b,f.views.analysisContainer.supportClasses.ShelfBase);b.prototype._initialization=function(){this._type=d.DES_DIM;this._layout="horizontal"};b.prototype._getOperationInfo=function(k){var j;var l;if(k.dataType===c.DATE){j=b.OGS_DATE;l=[e.SORT_ASCEND];if(k.dateSpan<86400000*(365/2+1)){l.push(e.DRILL_DATE)}else{if(k.dateSpan<86400000*(365*1)){l.push(e.DRILL_WEEK)}else{if(k.dateSpan<86400000*(365*5)){l.push(e.DRILL_MONTH)}else{l.push(e.DRILL_YEAR)}}}}else{j=b.OGS_DEFAULT;l=[e.SORT_NONE]}return{availableOGs:j,defaultTypes:l}};b.OGS_DATE=null;b.OGS_DEFAULT=null;b._loadClass=function(){var j;j=[];j.push(g.createByClassification(h.SORT,[e.SORT_NONE]));j.push(g.createByClassification(h.DRILL));j.push(g.createByClassification(h.GROUP));j.push(g.createByTypes([e.CARD_REMOVE]));b.OGS_DATE=j;j=[];j.push(g.createByClassification(h.SORT));j.push(g.createByTypes([e.CARD_REMOVE]));b.OGS_DEFAULT=j};b._loadClass()})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesDimensionShelfMediator");var a=c.constants.AppConst;var b=c.views.analysisContainer.destination.DesDimensionShelfMediator=function(){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,c.views.analysisContainer.supportClasses.ShelfBaseMediator);b.prototype.init=function(){b.superclass.init.apply(this,arguments)}})(jQuery);(function(){var e=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesMeasureShelf");var b=e.constants.AnalysisType;var c=e.constants.ShelfType;var d=e.operation.OperationType;var h=e.operation.OperationGroup;var g=e.operation.OperationClassification;var f=e.operation.OperationFactory;var a=e.views.analysisContainer.destination.DesMeasureShelf=function(j){a.superclass.constructor.apply(this,arguments);this._setTitle("分析指标");this._setRequired(true)};andrea.blink.extend(a,e.views.analysisContainer.supportClasses.ShelfBase);a.prototype._initialization=function(){this._type=c.DES_VALUE;this._layout="horizontal"};a.prototype._getOperationInfo=function(k){var j;var l;if(k.analysisType===b.DIMENSION){j=a.OGS_DIMENSION;l=[d.CALC_UNIQ_COUNT]}else{if(k.analysisType===b.MEASURE){j=a.OGS_MEASURE;l=[d.CALC_SUM]}}return{availableOGs:j,defaultTypes:l}};a.OGS_DIMENSION=null;a.OGS_MEASURE=null;a._loadClass=function(){var j;j=[];j.push(h.createByTypes([d.CALC_UNIQ_COUNT,d.CALC_COUNT]));j.push(h.createByClassification(g.SORT));j.push(h.createByTypes([d.CARD_REMOVE]));a.OGS_DIMENSION=j;j=[];j.push(h.createByTypes([d.CALC_SUM,d.CALC_AVG,d.CALC_MAX,d.CALC_MIN]));j.push(h.createByClassification(g.SORT));j.push(h.createByTypes([d.CARD_REMOVE]));a.OGS_MEASURE=j};a._loadClass()})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesMeasureShelfMediator");var b=c.constants.AppConst;var a=c.views.analysisContainer.destination.DesMeasureShelfMediator=function(){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,c.views.analysisContainer.supportClasses.ShelfBaseMediator);a.prototype.init=function(){a.superclass.init.apply(this,arguments)}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.processor.FilterShelf");var a=d.constants.AnalysisType;var b=d.constants.ShelfType;var c=d.views.analysisContainer.processor.FilterShelf=function(e){c.superclass.constructor.apply(this,arguments);this._setTitle("过滤器")};andrea.blink.extend(c,d.views.analysisContainer.supportClasses.ShelfBase);c.prototype._initialization=function(){this._type=b.PROC_FILTER;this._layout="vertical"}})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.processor.FilterShelfMediator");var a=b.constants.AppConst;var d=b.views.analysisContainer.processor.FilterShelfMediator=function(){d.superclass.constructor.apply(this,arguments)};andrea.blink.extend(d,b.views.analysisContainer.supportClasses.ShelfBaseMediator);d.prototype.init=function(){d.superclass.init.apply(this,arguments)}})(jQuery);(function(c){var b=andrea.grace;var a=b.constants.VizType;andrea.blink.declare("andrea.grace.views.analysisResult.viz.VizFactory");var d=b.views.analysisResult.viz.VizFactory;d.produce=function(l,g,f){var e;var j=b.views.analysisResult.viz.placeHolder;var k=b.views.analysisResult.viz.highCharts;var h=b.views.analysisResult.viz.googleCharts;if(g===a.BUBBLE){return new k.Scatter(l,"bubble",g)}else{if(g===a.SCATTER){return new k.Scatter(l,"scatter",g)}else{if(g===a.BAR||g===a.STACKED_BAR){return new k.BasicXY(l,"bar",g)}else{if(g===a.COLUMN||g===a.STACKED_COLUMN){return new k.BasicXY(l,"column",g)}else{if(g===a.LINE||g===a.RADAR){return new k.BasicXY(l,"line",g)}else{if(g===a.AREA){return new k.BasicXY(l,"area",g)}else{if(g===a.PIE){return new k.Pie(l,"pie",g)}else{return new j.VizPH(l,f)}}}}}}}}})(jQuery);(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.viz.VizBase");var a=b.views.analysisResult.viz.VizBase=function(d){a.superclass.constructor.apply(this,arguments);this._$dom=c(d);this._$dom.addClass("grace-result-viz")};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype.render=function(f,e,d){};a.prototype._addMessage=function(d){};a.prototype._removeMessages=function(d){};a._MESSAGES={}})(jQuery);(function(c){var b=andrea.grace;var a=b.constants.VizType;andrea.blink.declare("andrea.grace.views.analysisResult.viz.placeHolder.VizPH");var d=b.views.analysisResult.viz.placeHolder.VizPH=function(f,e){d.superclass.constructor.apply(this,arguments);this._selectedVizType=e};andrea.blink.extend(d,b.views.analysisResult.viz.VizBase);d.prototype.render=function(g,n,h){d.superclass.render.apply(this,arguments);var f=c("<div/>").appendTo(this._$dom).addClass("grace-result-viz-placeHolder-hint");var l=c("<span/>").appendTo(f);c("<br/>").appendTo(f);c("<br/>").appendTo(f);var k=c("<span/>").appendTo(f);if(this._selectedVizType===a.RECOMMEND){k.text("从纬度、指标开始发现之旅！")}else{l.text("未完成的图形");var e=a.manifest(this._selectedVizType);var j=e.required;var m=e.title+" 需要至少";if(j.numDimensions>0){m=m+j.numDimensions+"个分析纬度，"}if(j.numMeasures>0){m=m+j.numMeasures+"个分析指标。"}k.text(m)}f.css({left:(this._$dom.width()-f.width())/2+"px",top:(this._$dom.height()-f.height())/2+"px"})}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueToName");var a=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueToName;a.string=function(c){return c};a.number=function(c){return c};a.dateDrillYear=function(c){return c.format("yyyy")};a.dateDrillMonth=function(c){return c.format("yyyy/M")};a.dateDrillWeek=function(c){var e=c.getMonsday();var d=new Date();d.setTime(e.getTime()+7*24*3600*1000);return e.format("yyyy/M/d")+"-"+d.format("M/d")};a.dateDrillDate=function(c){return c.format("yyyy/M/d")};a.dateGroupMonth=function(c){return Date.monthNames[c.getMonth()]};a.dateGroupDate=function(c){return Date.dateNames[c.getDate()-1]};a.dateGroupDay=function(c){return Date.dayNames[c.getDay()]};a.dateGroupHour=function(c){return Date.hourNames[c.getHours()]}})();(function(){var d=andrea.grace;var a=d.constants.DataType;var c=d.operation.OperationType;var b=d.views.analysisResult.viz.highCharts.supportClasses.ValueToName;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueQuery");var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueQuery=function(g,f){this._dataProvider=g;this._sa=f;this._a=this._sa.source;this._names=null;this._valueToName=null;this._initialize()};e.NULL_NAME="-";e.prototype._initialize=function(){var f=this._dataProvider.getCUniqueValues(this._a.index);if(this._a.dataType===a.STRING){this._valueToName=b.string;this._names=this._generateNames(f)}else{if(this._a.dataType===a.NUMBER){this._valueToName=b.number;this._names=this._generateNames(f)}else{if(this._a.dataType===a.DATE){if(this._sa.operationGroup.has(c.DRILL_YEAR)){this._valueToName=b.dateDrillYear;this._names=this._generateDateDrillNames(f,function(g,h){return g.getFullYear()<h.getFullYear()},function(g){g.setFullYear(g.getFullYear()+1)})}else{if(this._sa.operationGroup.has(c.DRILL_MONTH)){this._valueToName=b.dateDrillMonth;this._names=this._generateDateDrillNames(f,function(g,h){return g.getFullYear()*12+g.getMonth()<h.getFullYear()*12+h.getMonth()},function(g){g.setMonth(g.getMonth()+1)})}else{if(this._sa.operationGroup.has(c.DRILL_WEEK)){this._valueToName=b.dateDrillWeek;this._names=this._generateDateDrillNames(f,function(g,h){return Math.floor(g.getMonsday().getTime()/7/24/3600/1000)<Math.floor(h.getMonsday().getTime()/7/24/3600/1000)},function(g){g.setDate(g.getDate()+7)})}else{if(this._sa.operationGroup.has(c.DRILL_DATE)){this._valueToName=b.dateDrillDate;this._names=this._generateDateDrillNames(f,function(g,h){return Math.floor(g.getTime()/24/3600/1000)<Math.floor(h.getTime()/24/3600/1000)},function(g){g.setDate(g.getDate()+1)})}else{if(this._sa.operationGroup.has(c.GROUP_MONTH)){this._valueToName=b.dateGroupMonth;this._names=this._generateSortedNames(f,_.clone(Date.monthNames))}else{if(this._sa.operationGroup.has(c.GROUP_DATE)){this._valueToName=b.dateGroupDate;this._names=this._generateSortedNames(f,_.clone(Date.dateNames))}else{if(this._sa.operationGroup.has(c.GROUP_DAY)){this._valueToName=b.dateGroupDay;this._names=this._generateSortedNames(f,_.clone(Date.dayNames))}else{if(this._sa.operationGroup.has(c.GROUP_HOUR)){this._valueToName=b.dateGroupHour;this._names=this._generateSortedNames(f,_.clone(Date.hourNames))}}}}}}}}}}}};e.prototype._generateNames=function(f){var j=_.without(f,null);var h=f.length!==j.length;if(this._sa.operationGroup.has(c.SORT_ASCEND)){j.sort()}else{if(this._sa.operationGroup.has(c.SORT_DESCEND)){j.sort();j.reverse()}}var g=j;if(h){g.push(this.valueToName(null))}return g};e.prototype._generateDateDrillNames=function(g,k,q){var j=_.without(g,null);var f=g.length!==j.length;var h=_.sortBy(j,function(r){return r.getTime()});var n=h[0];var p=h[h.length-1];var l=new Date();l.setTime(n.getTime());var m=[];while(true){m.push(this.valueToName(l));if(!k(l,p)){break}q(l)}return this._generateSortedNames(g,m)};e.prototype._generateSortedNames=function(f,j){var h=_.without(f,null);var g=f.length!==h.length;if(this._sa.operationGroup.has(c.SORT_DESCEND)){j.reverse()}if(g){j.push(this.valueToName(null))}return j};e.prototype.queryIndex=function(h){var j=h[this._a.index];var g=this.valueToName(j);var f=this._names.indexOf(g);if(f===-1){throw new Error("Can't find index!")}return f};e.prototype.names=function(){return this._names};e.prototype.valueToName=function(f){if(f){return this._valueToName.call(null,f)}else{return e.NULL_NAME}}})();(function(){var b=andrea.grace;var f=b.utils.ColorUtil;var a=b.constants.DataType;var c=b.operation.OperationGroup;var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueQuery;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption");var d=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;d.genMain=function(g){return{chart:{type:g},title:{text:null},credits:{enabled:false}}};d.genLegend=function(g){var h=null;if(g){h={layout:"vertical",align:"left",verticalAlign:"middle"}}else{h={enabled:false}}return{legend:h}};d._visualize=function(h,j){var g=null;if(j<h.length){g=h[j];g.visualized=true}return g};d._setVisualized=function(j){if(!j){return}if(!_.isArray(j)){j=[j]}for(var h=0;h<j.length;h++){var g=j[h];g.visualized=true}};d.dataConfig=function(H,n,u,w,x){var B,E;var y;var F,v,C;var D,s,z;var A,q;var k;var t;var p;var g=[];var r=[];var m=function(I){g.push(I);r.push(I.ascend());r.push(I.descend())};if(n){m(n.operationGroup)}if(u){m(u.operationGroup)}for(C=0;C<w.length;C++){m(w[0].operationGroup)}r=_.without(r,undefined);r.sort(function(J,I){return J.priority-I.priority});r.pop();_.each(g,function(I){_.each(r,function(J){I.removeOperation(J.id)})});if(!n){if(x){t=function(J,I){return I};D=w.length;z=1}else{t=function(J,I){return 0};D=1;z=w.length}}else{A=new e(H,n);t=function(J,I){return A.queryIndex(J)};D=A.names().length;z=w.length}if(!u){p=function(I){return 0};s=1}else{q=new e(H,u);p=function(I){return q.queryIndex(I)};s=q.names().length}var l=[];for(F=0;F<D;F++){l[F]={name:x?d.saToDisplay(w[F]):(A?A.names()[F]:d.saToDisplay(w[0])),data:[]};for(v=0;v<s;v++){l[F].data[v]={name:q?q.names()[v]:"",data:[]};for(C=0;C<z;C++){E=x?F:C;y=w[E].operationGroup;l[F].data[v].data[C]=y.calculator();if(!k&&(y.ascend()||y.descend())){k={si:F,di:C,ascend:y.ascend()}}}}}for(B=0;B<H.numRows;B++){var j=H.getRow(B);for(E=0;E<w.length;E++){F=t(j,E);v=p(j);C=x?0:E;l[F].data[v].data[C].addFactor(j[w[E].source.index])}}for(F=0;F<D;F++){for(v=0;v<s;v++){for(C=0;C<z;C++){l[F].data[v].data[C]=l[F].data[v].data[C].calculate()}}}var G={};if(q){G.categories=q.names()}G.series=l;if(k&&G.categories){var h=[];for(B=0;B<s;B++){o={category:G.categories[B],series:[]};for(F=0;F<G.series.length;F++){o.series[F]=G.series[F].data[B]}h.push(o)}h.sort(function(J,I){return J.series[k.si].data[k.di]-I.series[k.si].data[k.di]});if(!k.ascend){h.reverse()}G.categories=[];for(F=0;F<G.series.length;F++){G.series[F].data=[]}for(B=0;B<s;B++){o=h[B];G.categories.push(o.category);for(F=0;F<G.series.length;F++){G.series[F].data.push(o.series[F])}}}d._setVisualized(n);d._setVisualized(u);d._setVisualized(w);return G};d.OPERATION_DISPLAY_SPLITTER=" | ";d.OPERATION_DISPLAY_SPLITTER_ABBR="|";d.saToDisplay=function(g){var h=g.operationGroup.mapNames().join(d.OPERATION_DISPLAY_SPLITTER);if(h){return g.source.name+" ("+h+")"}else{return g.source.name}};d.saToDisplayAbbr=function(g){var h=g.operationGroup.mapAbbrs().join(d.OPERATION_DISPLAY_SPLITTER_ABBR);if(h){return g.source.name+"("+h+")"}else{return g.source.name}}})();(function(b){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.Pie");var d=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var e=a.calculator.supportClasses.CalculatorFactory;var c=a.views.analysisResult.viz.highCharts.Pie=function(f){c.superclass.constructor.apply(this,arguments);var g=this};andrea.blink.extend(c,a.views.analysisResult.viz.VizBase);c.prototype.render=function(h,q,n){c.superclass.render.apply(this,arguments);var g=d.genMain("pie");var f=d.dataConfig(h,null,q[0],n.slice(0,1));g.xAxis={title:{text:q[0].source.name},categories:f.categories};for(var l=0;l<f.series.length;l++){var m=f.series[l].data;for(var k=0;k<m.length;k++){m[k].y=m[k].data[0]}}g.series=f.series;g.tooltip={hideDelay:240};g.plotOptions={series:{dataLabels:{enabled:true,formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage.toFixed(2)+" %"}}}};if(g.series.length>50){this._addMessage("W001");var p=this;_.delay(function(){b(p._dom).highcharts(g);this._removeMessages()},300)}else{b(this._dom).highcharts(g)}}})(jQuery);(function(d){var c=andrea.grace;var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var b=c.constants.VizType;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.BasicXY");var a=c.views.analysisResult.viz.highCharts.BasicXY=function(h,f,g){a.superclass.constructor.apply(this,arguments);this._chartType=f;this._vizType=g};andrea.blink.extend(a,c.views.analysisResult.viz.VizBase);a.prototype.render=function(m,w,r){a.superclass.render.apply(this,arguments);var l=e.genMain(this._chartType);var g;var v;if(w.length>1){v=r.slice(0,1);g=e.dataConfig(m,w[1],w[0],v)}else{v=r;g=e.dataConfig(m,null,w[0],v,true)}l.xAxis={};if(w&&w[0]){l.xAxis.title={text:e.saToDisplayAbbr(w[0])}}else{l.xAxis.title={text:null}}if(g.categories){l.xAxis.categories=g.categories;l.xAxis.labels={rotation:-45,align:"right"}}else{l.xAxis.categories=[""]}var s=function(j){return{title:{text:j},min:0}};if(v.length===1){l.yAxis=s(e.saToDisplay(r[0]))}else{l.yAxis=s(null)}for(var p=0;p<g.series.length;p++){var q=g.series[p].data;for(var k=0;k<q.length;k++){q[k].y=q[k].data[0]}}l.series=g.series;var u=l.series.length>1;l=_.defaults(l,e.genLegend(u));l.tooltip={headerFormat:'<span style="font-size:10px">{point.key}</span><table>',footerFormat:"</table>",shared:true,useHTML:true,hideDelay:240};if(u){l.tooltip.pointFormat='<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>'}else{l.tooltip.pointFormat='<tr><td style="padding:0"><b>{point.y}</b></td></tr>'}if(this._vizType){if(this._vizType===b.RADAR){l.chart.polar=true;l.xAxis.labels={rotation:0,align:"center"}}else{if(this._vizType===b.STACKED_BAR||this._vizType===b.STACKED_COLUMN){l.plotOptions={series:{stacking:"normal"}}}}}var h=l.series.length;var t=l.series[0].data.length;var f;var n;if(b.horizontal(this._vizType)){n="width"}else{if(b.vertical(this._vizType)){n="height"}}if(this._vizType===b.BAR||this._vizType===b.COLUMN){f=h*t*12}else{if(this._vizType===b.STACKED_BAR||this._vizType===b.STACKED_COLUMN){f=t*16}else{if(this._vizType===b.LINE||this._vizType===b.AREA){f=h*t*8}}}if(f>this._$dom[n]()){this._$dom[n](f)}d(this._dom).highcharts(l)}})(jQuery);(function(d){var c=andrea.grace;var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var a=c.constants.VizType;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.Scatter");var b=c.views.analysisResult.viz.highCharts.Scatter=function(h,f,g){b.superclass.constructor.apply(this,arguments);this._chartType=f;this._vizType=g};andrea.blink.extend(b,c.views.analysisResult.viz.VizBase);b.prototype.render=function(B,k,z){b.superclass.render.apply(this,arguments);var v,u;var q=e.genMain(this._chartType);var m;if(this._vizType===a.SCATTER){m=z.slice(0,2)}else{if(this._vizType===a.BUBBLE){m=z.slice(0,3)}}var g;if(k.length===1){g=e.dataConfig(B,null,k[0],m)}else{g=e.dataConfig(B,k[0],k[1],m)}q.xAxis={title:{text:e.saToDisplay(z[0])},startOnTick:true,endOnTick:true};q.yAxis={};if(z.length>1){q.yAxis.title={text:e.saToDisplay(z[1])}}var f;var l=[];if(k.length===1){l.push("<b>"+e.saToDisplayAbbr(k[0])+": </b>{point.name}")}else{if(k.length===2){l.push("<b>"+e.saToDisplayAbbr(k[0])+": </b>{series.name}");l.push("<b>"+e.saToDisplayAbbr(k[1])+": </b>{point.name}")}}l.push("    "+e.saToDisplayAbbr(z[0])+": {point.x}");if(z.length>1){l.push("    "+e.saToDisplayAbbr(z[1])+": {point.y}")}if(z.length>2){l.push("    "+e.saToDisplayAbbr(z[2])+": {point.z}")}f=l.join("<br/>");var A;A="";q.plotOptions={series:{tooltip:{pointFormat:f,headerFormat:A}}};q.tooltip={hideDelay:240};var h;var t;var C;h=[];for(v=0;v<g.series.length;v++){var n=g.series[v];var p=n.data;t=[];for(u=0;u<p.length;u++){var y=p[u];var x=y.data;C={name:y.name,x:x[0],y:x[1]!=null?x[1]:1,z:x[2]!=null?x[2]:1};t.push(C)}h.push({name:n.name,data:t})}q.series=h;var w=q.series.length>1;q=_.defaults(q,e.genLegend(w));if(q.series.length>50||(q.series.length*q.series[0].data.length>1000)){this._addMessage("W001");var r=this;_.delay(function(){d(r._dom).highcharts(q);this._removeMessages()},300)}else{d(this._dom).highcharts(q)}}})(jQuery);(function(e){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.AnalysisResult");var f=d.views.analysisResult.viz.VizFactory;var c=d.constants.VizType;var b=d.constants.DataType;var a=d.views.analysisResult.AnalysisResult=function(g){a.superclass.constructor.apply(this,arguments);this._$dom=e(g);this._$dom.addClass("grace-result fancy-scrollbar");this._renderArgs=null};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype.render=function(p,j,r,l){this._renderArgs=arguments;var m=function(s){s.visualized=false;s.numPartialVisualized=0};_.each(r,m);_.each(l,m);var n=null;if(p===c.RECOMMEND){n=this._recommend(j,r,l)}else{if(this._valid(p,j,r,l)){n=p}else{n=null}}this._$dom.empty();var k=e("<div/>").appendTo(this._$dom).css({height:this.size().height+"px"});var q=f.produce(k[0],n,p);q.render(j,r,l);var h=this.size();var g=q.size();this._$dom.css({"overflow-x":"hidden","overflow-y":"hidden"});if(g.width>h.width){this._$dom.css("overflow-x","auto")}if(g.height>h.height){this._$dom.css("overflow-y","auto")}};a.prototype._validateSize=function(){var g=this.size();this._$dom.css({height:g.height+"px",width:g.width+"px"});if(this._renderArgs){this.render.apply(this,this._renderArgs)}};a.prototype._recommend=function(g,h,l){if(l.length===0){return null}if(h.length===0){return c.BAR}else{var k=h[0];var j=h[1];if(k.isDateSeries()){return c.LINE}else{if(l.length===1||k.source.numUniqueValue<60){return c.COLUMN}else{if(l.length===2){return c.SCATTER}else{if(l.length>=3){return c.BUBBLE}}}}}return null};a.prototype._valid=function(k,g,j,m){var h=c.manifest(k);var l=h.required;return j.length>=l.numDimensions&&m.length>=l.numMeasures}})(jQuery);(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.AnalysisResultMediator");var b=c.constants.AppConst;var a=c.views.analysisResult.AnalysisResultMediator=function(e){a.superclass.constructor.apply(this,arguments);this._view=e;this._model=null};andrea.blink.extend(a,andrea.blink.mvc.ViewMediator);a.prototype.init=function(){var f=this;var e=this._model=this._getModel(b.MODEL_GRACE);this._subscribe(b.NOTIFICATION_VIZ_CONTEXT_CHANGED,function(g){f._view.render(e.vizType(),e.dataProvider,e.analysisDimesions(),e.analysisDatas());e.invalidateShelvedAnalysis()});f._view.render(e.vizType(),e.dataProvider,e.analysisDimesions(),e.analysisDatas())}})(jQuery);(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.VizIconEvent");var b=a.views.popUp.VizIconEvent=function(c,e,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.events.Event);b.CLICK="click"})();(function(c){var b=andrea.grace;var d=b.views.popUp.VizIconEvent;andrea.blink.declare("andrea.grace.views.vizNavigator.VizIcon");var a=b.views.vizNavigator.VizIcon=function(f,e){a.superclass.constructor.apply(this,arguments);this._$dom=c(this._dom);this._enabled=false;this._selected=false;this._data=e.data;this._basicClass=e.basicClass;this._enabledClass=e.enabledClass;this._selectedClass=e.selectedClass;var g=this;this._$dom.addClass(this._basicClass).click(function(){g.dispatchEvent(new d(d.CLICK,g))});if(this._data.icon){this._$dom.css({"background-image":'url("'+this._data.icon+'")'})}else{if(this._data.title){this._$dom.text(this._data.title)}}this._$dom.attr({title:this._data.title})};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype.type=function(){return this._data.type};a.prototype.enabled=function(e){if(arguments.length>0){if(this._enabled!==e){this._enabled=e;if(this._enabled){if(!this.selected()){this._$dom.addClass(this._enabledClass)}else{this._$dom.removeClass(this._enabledClass)}}else{this._$dom.removeClass(this._enabledClass)}}return this}else{return this._enabled}};a.prototype.selected=function(e){if(arguments.length>0){if(this._selected!==e){this._selected=e;if(this._selected){this._$dom.addClass(this._selectedClass);this._$dom.removeClass(this._enabledClass)}else{this._$dom.removeClass(this._selectedClass);if(this.enabled()){this._$dom.addClass(this._enabledClass)}}}return this}else{return this._selected}};a.prototype.update=function(f,e){var g=this._data.required;this.enabled(f>=g.numDimensions&&e>=g.numMeasures)}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.VizNavigatorEvent");var a=b.views.popUp.VizNavigatorEvent=function(c,e,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.events.Event);a.VIZ_CHANGED="vizChanged"})();(function(f){var e=andrea.grace;var d=e.views.vizNavigator.VizIcon;var g=e.views.popUp.VizIconEvent;var c=e.views.popUp.VizNavigatorEvent;var b=e.constants.VizType;andrea.blink.declare("andrea.grace.views.vizNavigator.VizNavigator");var a=e.views.vizNavigator.VizNavigator=function(l){a.superclass.constructor.apply(this,arguments);this._$dom=f(this._dom);this._selectedType=null;this._defaultViewIcon=null;var n=b;var h=n.manifest(n.RECOMMEND);var v=[{title:"对比",icons:[n.manifest(n.COLUMN),n.manifest(n.BAR),n.manifest(n.RADAR)]},{title:"相关性",icons:[n.manifest(n.SCATTER),n.manifest(n.BUBBLE)]},{title:"趋势",icons:[n.manifest(n.LINE),n.manifest(n.AREA)]},{title:"贡献度",icons:[n.manifest(n.PIE),n.manifest(n.STACKED_COLUMN),n.manifest(n.STACKED_BAR)]}];var p=this;this._vizIcons=[];var u=f("<div/>").appendTo(this._$dom).addClass("grace-navigator-contaier");var j=f("<div/>").appendTo(u).addClass("grace-navigator-recommend");var s=f("<div/>").appendTo(j);var k=this._defaultViewIcon=new d(s[0],{data:h,basicClass:"grace-navigator-recommend-icon",enabledClass:"grace-navigator-recommend-icon-enabled",selectedClass:"grace-navigator-recommend-icon-selected"});this._vizIcons.push(k);var t=f("<div/>").appendTo(u).addClass("grace-navigator-selector");var r;r=f("<div/>").appendTo(t).addClass("grace-navigator-line");this._createGroup(r,v[0]);this._createGroup(r,v[1]);r=f("<div/>").appendTo(u).addClass("grace-navigator-line");this._createGroup(r,v[2]);this._createGroup(r,v[3]);var q=function(w){p._select(w.target())};for(var m=0;m<this._vizIcons.length;m++){this._vizIcons[m].addEventListener(g.CLICK,q)}k.enabled(true);this._select(this._defaultViewIcon)};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype._createGroup=function(p,q){var l=this;$group=f("<div/>").appendTo(p).addClass("grace-navigator-group");var h=f("<h2/>").appendTo($group).addClass("grace-navigator-group-text");h.text(q.title);var r=f("<div/>").appendTo($group).addClass("grace-navigator-group-icons");for(var j=0;j<q.icons.length;j++){var n=q.icons[j];var m=f("<div/>").appendTo(r);var k=new d(m[0],{data:n,basicClass:"grace-navigator-group-icon",enabledClass:"grace-navigator-group-icon-enabled",selectedClass:"grace-navigator-group-icon-selected"});this._vizIcons.push(k)}};a.prototype.selectedType=function(){return this._selectedType};a.prototype._select=function(h){if(!h.enabled()||h.selected()){return}this._selectedType=h.type();_.each(this._vizIcons,function(j){j.selected(j===h)});this.dispatchEvent(new c(c.VIZ_CHANGED,this))};a.prototype.update=function(j,h){var k=this;_.each(this._vizIcons,function(l){var n=l.selected();l.update(j,h);var m=l.enabled()})}})(jQuery);(function(e){var c=andrea.grace;var b=c.views.popUp.VizNavigatorEvent;var a=c.constants.AppConst;andrea.blink.declare("andrea.grace.views.vizNavigator.VizNavigatorMediator");var d=c.views.vizNavigator.VizNavigatorMediator=function(f){d.superclass.constructor.apply(this,arguments);this._view=f;this._model=null};andrea.blink.extend(d,andrea.blink.mvc.ViewMediator);d.prototype.init=function(){var g=this;var f=this._model=this._getModel(a.MODEL_GRACE);this._view.addEventListener(b.VIZ_CHANGED,function(h){g._action(a.ACTION_RUN_ANALYSIS,{vizType:g._view.selectedType()})},this);this._subscribe(a.NOTIFICATION_VIZ_CONTEXT_CHANGED,function(h){g._view.update(f.analysisDimesions().length,f.analysisDatas().length)})}})(jQuery);(function(){var h=andrea.grace;var g=h.constants.DataType;var c=h.constants.AnalysisType;andrea.blink.declare("andrea.grace.testingData.SampleTOPTrade");var b=h.testingData.SampleTOPTrade=function(){this.columnDescriptors=[];this.columnDescriptors.push(d("购买数量",g.STRING,c.MEASURE));this.columnDescriptors.push(d("交易状态",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("商品单价",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("优惠金额",g.STRING,c.MEASURE));this.columnDescriptors.push(d("使用积分",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("交易金额",g.STRING,c.MEASURE));this.columnDescriptors.push(d("交易创建日期",g.DATE,c.DIMENSION));this.columnDescriptors.push(d("交易结束日期",g.DATE,c.DIMENSION));this.columnDescriptors.push(d("买家昵称",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("买家区域",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("有否运费险",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("有否买家留言",g.STRING,c.DIMENSION));this.columnDescriptors.push(d("卖家发货日期",g.DATE,c.DIMENSION));this.rows=[];for(var n=0;n<1000;n++){var p=[];var q=l(-100+Math.floor(100/1000*n));p.push(f(5));p.push(k(["没有创建支付宝交易","等待买家付款","买家已付款","卖家已发货","交易成功","退款成功","交易关闭"]));p.push(f(2000)/100);p.push(f(100)/100);p.push(f(100));p.push(f(10000)/100);p.push(m(q,0));p.push(m(q,f(7)));p.push("buyer_"+f(1000));p.push(k(["安徽","福建","甘肃","广东","贵州","海南","河北","黑龙江","河南","湖北","湖南","江苏","江西","吉林","辽宁","青海","陕西","山东","山西","四川","云南","浙江","广西","内蒙古","宁夏","新疆","西藏","北京","重庆","上海","天津","香港","澳门","台湾"]));p.push(k(["有","无"]));p.push(k(["有","无"]));p.push(m(q,f(3)-1));this.rows.push(p)}};var a=new Date().getTime();var f=function(n){return Math.floor(Math.random()*n+1)};var k=function(n){return n[f(n.length)-1]};var l=function(n){var p=new Date();p.setDate(p.getDate()+n);return p};var m=function(p,n){p.setDate(p.getDate()+n);p.setHours(_.random(0,23));return p.format("yyyy/M/d H:m:s")};var j=function(p,n){p.setDate(p.getDate()+n);return p.getFullYear()+"/"+(p.getMonth()+1)};var e={trades_sold_get_response:{trades:{trade:[{buyer_obtain_point_fee:0,buyer_area:"浙江省杭州市",consign_time:"2000-01-01 00:00:00",receiver_zip:"223700",has_buyer_message:"true",receiver_address:"淘宝城911号",pic_path:"http://img08.taobao.net/bao/uploaded/i8/T1jVXXXePbXXaoPB6a_091917.jpg",adjust_fee:"200.07",type:"fixed(一口价)",buyer_rate:"true",receiver_phone:"13819175372",title:"麦包包",created:"2000-01-01 00:00:00",alipay_no:"2009112081173831",total_fee:"200.07",num_iid:3424234,seller_flag:1,tid:2231958349,receiver_state:"浙江省",seller_nick:"我在测试",commission_fee:"200.07",discount_fee:"200.07",payment:"200.07",status:"TRADE_NO_CREATE_PAY",receiver_city:"杭州市",shipping_type:"free",cod_fee:"12.07",cod_status:"EW_CREATED(订单已创建)",pay_time:"2000-01-01 00:00:00",received_payment:"200.07",receiver_mobile:"13512501826",post_fee:"200.07",receiver_name:"东方不败",modified:"2000-01-01 00:00:00",buyer_nick:"我在测试",receiver_district:"西湖区",point_fee:0,seller_rate:"true",num:1,price:"200.07",real_point_fee:0,end_time:"2000-01-01 00:00:00",orders:{order:[{refund_id:2231958349,outer_iid:"152e442aefe88dd41cb0879232c0dcb0",discount_fee:"200.07",payment:"200.07",status:"TRADE_NO_CREATE_PAY",pic_path:"http://img08.taobao.net/bao/uploaded/i8/T1jVXXXePbXXaoPB6a_091917.jpg",sku_properties_name:"颜色:桔色;尺码:M",adjust_fee:"1.01",outer_sku_id:"81893848",cid:123456,buyer_rate:"true",item_meal_name:"M8原装电池:便携支架:M8专用座充:莫凡保护袋",seller_rate:"true",num:10,title:"山寨版测试机器",item_meal_id:2564854632,price:"200.07",oid:2231958349,total_fee:"200.07",num_iid:2342344,refund_status:"SUCCESS(退款成功)",sku_id:"5937146",seller_type:"B（商城商家）"}]},alipay_id:"2011082299567459"}]},total_results:100}};var d=function(q,p,n){return{name:q,}}})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.DataDiscoveryMediator");var a=c.constants.AppConst;var b=andrea.grace.DataDiscoveryMediator=function(){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.mvc.ViewMediator);b.prototype.rowBasedDataProvider=function(g,f,e){this._action(a.ACTION_CHANGE_DATA_PROVIDER,{rows:g,columnDescriptors:f,source:e})}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.DataDiscovery");var c=andrea.blink.mvc.App;var a=d.constants.AppConst;var b=d.DataDiscovery=function(e){this._div=e;this._$dom=$(e);this._viewSourceDim=null;this._viewSourceMea=null;this._viewDesDimensionShelf=null;this._viewDesMeasureShelf=null;this._viewFilterShelf=null;this._viewAnalysisResult=null;this._viewVizNavigator=null;this._startup()};b.prototype.rowBasedDataProvider=function(g,f,e){this._apiMediator.rowBasedDataProvider(g,f,e)};b.prototype._startup=function(){var h=new c();var f=null;var g=null;this._viewSourceDim=new d.views.analysisContainer.source.SrcDimensionShelf($("#divSrcDim")[0]);this._viewSourceMea=new d.views.analysisContainer.source.SrcMeasureShelf($("#divSrcMea")[0]);this._viewDesDimensionShelf=new d.views.analysisContainer.destination.DesDimensionShelf($("#divDesAnalysisDim")[0]);this._viewDesMeasureShelf=new d.views.analysisContainer.destination.DesMeasureShelf($("#divDesAnalysisMea")[0]);this._viewFilterShelf=new d.views.analysisContainer.processor.FilterShelf($("#divProcFilter")[0]);this._viewAnalysisResult=new d.views.analysisResult.AnalysisResult($("#divAnalysisResult")[0]);this._viewVizNavigator=new d.views.vizNavigator.VizNavigator($("#divVizNavigator")[0]);h.registerModel(a.MODEL_GRACE,new d.models.DataDiscoveryModel());h.registerAction(a.ACTION_CHANGE_DATA_PROVIDER,d.actions.ChangeDataProviderAction);h.registerAction(a.ACTION_RUN_ANALYSIS,d.actions.RunAnalysisAction);g=new d.DataDiscoveryMediator();h.registerViewMediator(a.MEDIATOR_DATA_DISCOVERY,g);this._apiMediator=g;g=new d.views.analysisContainer.source.SrcDimensionShelfMediator(this._viewSourceDim);h.registerViewMediator(a.MEDIATOR_ANALYSIS_SRC_DIM,g);g=new d.views.analysisContainer.source.SrcMeasureShelfMediator(this._viewSourceMea);h.registerViewMediator(a.MEDIATOR_ANALYSIS_SRC_MEA,g);g=new d.views.analysisContainer.destination.DesDimensionShelfMediator(this._viewDesDimensionShelf);h.registerViewMediator(a.MEDIATOR_ANALYSIS_DES_DIM,g);g=new d.views.analysisContainer.destination.DesMeasureShelfMediator(this._viewDesMeasureShelf);h.registerViewMediator(a.MEDIATOR_ANALYSIS_DES_MEA,g);g=new d.views.analysisContainer.processor.FilterShelfMediator(this._viewFilterShelf);h.registerViewMediator(a.MEDIATOR_ANALYSIS_DES_MEA,g);g=new d.views.analysisResult.AnalysisResultMediator(this._viewAnalysisResult);h.registerViewMediator(a.MEDIATOR_ANALYSIS_RESULT,g);g=new d.views.vizNavigator.VizNavigatorMediator(this._viewVizNavigator);h.registerViewMediator(a.MEDIATOR_VIZ_NAVIGATOR,g);var j=this;var e=false;$(window).resize(function(){if(!e){setTimeout(function(){e=false;j._validateSize()},1000/24)}e=true});this._validateSize()};b.prototype._validateSize=function(){var t;var v,q;var g=parseInt($(this._viewSourceDim.dom()).css("margin-bottom"));var s=0;var r=parseInt($("body").css("margin"));var f=$(window).height()-r*2;var j=$(window).width()-r*2;var e=$("#divHeader",this._$dom);var k=$("#divMain",this._$dom);var p=parseInt(k.css("margin"));var u=f-e.outerHeight()-p*2;var l=j-p*2;k.css({height:u+"px",width:l+"px"});$("#divCol1").css({width:180+"px",height:u+"px"});this._viewSourceDim.size({width:180,height:(u-g)/2+g});this._viewSourceMea.size({width:180,height:(u-g)/2+g});$("#divCol2").css({width:0+"px",height:0+"px",visibility:"hidden"});v=l-180*1-s*2;$("#divCol3").css({width:v+"px",height:u+"px"});var n=$("#divVizNavigator",this._$dom);var m=$("#divDestinations",this._$dom);m.css({width:Math.min(1024,v-n.width()-parseInt(m.css("margin-right")))+"px"});this._viewDesDimensionShelf.size({height:35+34*1});this._viewDesMeasureShelf.size({height:35+34*1});this._viewAnalysisResult.size({height:u-(35+34*1)*2})};b.prototype._createChildDiv=function(e){var f=document.createElement("div");if(e){$(f).appendTo(e)}return f}})();