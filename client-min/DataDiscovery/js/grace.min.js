LazyLoad=(function(k){var g,h,b={},e=0,f={css:[],js:[]},n=k.styleSheets;function m(r,q){var s=k.createElement(r),p;for(p in q){if(q.hasOwnProperty(p)){s.setAttribute(p,q[p])}}return s}function j(q){var s=b[q],t,r;if(s){t=s.callback;r=s.urls;r.shift();e=0;if(!r.length){t&&t.call(s.context,s.obj);b[q]=null;f[q].length&&l(q)}}}function c(){var p=navigator.userAgent;g={async:k.createElement("script").async===true};(g.webkit=/AppleWebKit\//.test(p))||(g.ie=/MSIE|Trident/.test(p))||(g.opera=/Opera/.test(p))||(g.gecko=/Gecko\//.test(p))||(g.unknown=true)}function l(B,A,C,x,t){var v=function(){j(B)},D=B==="css",r=[],w,y,u,s,z,q;g||c();if(A){A=typeof A==="string"?[A]:A.concat();if(D||g.async||g.gecko||g.opera){f[B].push({urls:A,callback:C,obj:x,context:t})}else{for(w=0,y=A.length;w<y;++w){f[B].push({urls:[A[w]],callback:w===y-1?C:null,obj:x,context:t})}}}if(b[B]||!(s=b[B]=f[B].shift())){return}h||(h=k.head||k.getElementsByTagName("head")[0]);z=s.urls;for(w=0,y=z.length;w<y;++w){q=z[w];if(D){u=g.gecko?m("style"):m("link",{href:q,rel:"stylesheet"})}else{u=m("script",{src:q});u.async=false}u.className="lazyload";u.setAttribute("charset","utf-8");if(g.ie&&!D&&"onreadystatechange" in u&&!("draggable" in u)){u.onreadystatechange=function(){if(/loaded|complete/.test(u.readyState)){u.onreadystatechange=null;v()}}}else{if(D&&(g.gecko||g.webkit)){if(g.webkit){s.urls[w]=u.href;d()}else{u.innerHTML='@import "'+q+'";';a(u)}}else{u.onload=u.onerror=v}}r.push(u)}for(w=0,y=r.length;w<y;++w){h.appendChild(r[w])}}function a(r){var q;try{q=!!r.sheet.cssRules}catch(p){e+=1;if(e<200){setTimeout(function(){a(r)},50)}else{q&&j("css")}return}j("css")}function d(){var q=b.css,p;if(q){p=n.length;while(--p>=0){if(n[p].href===q.urls[0]){j("css");break}}e+=1;if(q){if(e<200){setTimeout(d,50)}else{j("css")}}}}return{css:function(r,s,q,p){l("css",r,s,q,p)},js:function(r,s,q,p){l("js",r,s,q,p)}}})(this.document);
/*!	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/
var swfobject=function(){var F="undefined",t="object",U="Shockwave Flash",Y="ShockwaveFlash.ShockwaveFlash",s="application/x-shockwave-flash",T="SWFObjectExprInst",z="onreadystatechange",Q=window,k=document,v=navigator,V=false,W=[h],q=[],P=[],K=[],m,S,G,D,L=false,a=false,p,I,n=true,O=function(){var ac=typeof k.getElementById!=F&&typeof k.getElementsByTagName!=F&&typeof k.createElement!=F,aj=v.userAgent.toLowerCase(),aa=v.platform.toLowerCase(),ag=aa?/win/.test(aa):/win/.test(aj),ae=aa?/mac/.test(aa):/mac/.test(aj),ah=/webkit/.test(aj)?parseFloat(aj.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,Z=!+"\v1",ai=[0,0,0],ad=null;if(typeof v.plugins!=F&&typeof v.plugins[U]==t){ad=v.plugins[U].description;if(ad&&!(typeof v.mimeTypes!=F&&v.mimeTypes[s]&&!v.mimeTypes[s].enabledPlugin)){V=true;Z=false;ad=ad.replace(/^.*\s+(\S+\s+\S+$)/,"$1");ai[0]=parseInt(ad.replace(/^(.*)\..*$/,"$1"),10);ai[1]=parseInt(ad.replace(/^.*\.(.*)\s.*$/,"$1"),10);ai[2]=/[a-zA-Z]/.test(ad)?parseInt(ad.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else{if(typeof Q.ActiveXObject!=F){try{var af=new ActiveXObject(Y);if(af){ad=af.GetVariable("$version");if(ad){Z=true;ad=ad.split(" ")[1].split(",");ai=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}}catch(ab){}}}return{w3:ac,pv:ai,wk:ah,ie:Z,win:ag,mac:ae}}(),l=function(){if(!O.w3){return}if((typeof k.readyState!=F&&k.readyState=="complete")||(typeof k.readyState==F&&(k.getElementsByTagName("body")[0]||k.body))){f()}if(!L){if(typeof k.addEventListener!=F){k.addEventListener("DOMContentLoaded",f,false)}if(O.ie&&O.win){k.attachEvent(z,function(){if(k.readyState=="complete"){k.detachEvent(z,arguments.callee);f()}});if(Q==top){(function(){if(L){return}try{k.documentElement.doScroll("left")}catch(Z){setTimeout(arguments.callee,0);return}f()})()}}if(O.wk){(function(){if(L){return}if(!/loaded|complete/.test(k.readyState)){setTimeout(arguments.callee,0);return}f()})()}u(f)}}();function f(){if(L){return}try{var ab=k.getElementsByTagName("body")[0].appendChild(E("span"));ab.parentNode.removeChild(ab)}catch(ac){return}L=true;var Z=W.length;for(var aa=0;aa<Z;aa++){W[aa]()}}function M(Z){if(L){Z()}else{W[W.length]=Z}}function u(aa){if(typeof Q.addEventListener!=F){Q.addEventListener("load",aa,false)}else{if(typeof k.addEventListener!=F){k.addEventListener("load",aa,false)}else{if(typeof Q.attachEvent!=F){j(Q,"onload",aa)}else{if(typeof Q.onload=="function"){var Z=Q.onload;Q.onload=function(){Z();aa()}}else{Q.onload=aa}}}}}function h(){if(V){X()}else{J()}}function X(){var Z=k.getElementsByTagName("body")[0];var ac=E(t);ac.setAttribute("type",s);var ab=Z.appendChild(ac);if(ab){var aa=0;(function(){if(typeof ab.GetVariable!=F){var ad=ab.GetVariable("$version");if(ad){ad=ad.split(" ")[1].split(",");O.pv=[parseInt(ad[0],10),parseInt(ad[1],10),parseInt(ad[2],10)]}}else{if(aa<10){aa++;setTimeout(arguments.callee,10);return}}Z.removeChild(ac);ab=null;J()})()}else{J()}}function J(){var ai=q.length;if(ai>0){for(var ah=0;ah<ai;ah++){var aa=q[ah].id;var ad=q[ah].callbackFn;var ac={success:false,id:aa};if(O.pv[0]>0){var ag=c(aa);if(ag){if(H(q[ah].swfVersion)&&!(O.wk&&O.wk<312)){y(aa,true);if(ad){ac.success=true;ac.ref=B(aa);ad(ac)}}else{if(q[ah].expressInstall&&C()){var ak={};ak.data=q[ah].expressInstall;ak.width=ag.getAttribute("width")||"0";ak.height=ag.getAttribute("height")||"0";if(ag.getAttribute("class")){ak.styleclass=ag.getAttribute("class")}if(ag.getAttribute("align")){ak.align=ag.getAttribute("align")}var aj={};var Z=ag.getElementsByTagName("param");var ae=Z.length;for(var af=0;af<ae;af++){if(Z[af].getAttribute("name").toLowerCase()!="movie"){aj[Z[af].getAttribute("name")]=Z[af].getAttribute("value")}}R(ak,aj,aa,ad)}else{r(ag);if(ad){ad(ac)}}}}}else{y(aa,true);if(ad){var ab=B(aa);if(ab&&typeof ab.SetVariable!=F){ac.success=true;ac.ref=ab}ad(ac)}}}}}function B(ac){var Z=null;var aa=c(ac);if(aa&&aa.nodeName=="OBJECT"){if(typeof aa.SetVariable!=F){Z=aa}else{var ab=aa.getElementsByTagName(t)[0];if(ab){Z=ab}}}return Z}function C(){return !a&&H("6.0.65")&&(O.win||O.mac)&&!(O.wk&&O.wk<312)}function R(ac,ad,Z,ab){a=true;G=ab||null;D={success:false,id:Z};var ag=c(Z);if(ag){if(ag.nodeName=="OBJECT"){m=g(ag);S=null}else{m=ag;S=Z}ac.id=T;if(typeof ac.width==F||(!/%$/.test(ac.width)&&parseInt(ac.width,10)<310)){ac.width="310"}if(typeof ac.height==F||(!/%$/.test(ac.height)&&parseInt(ac.height,10)<137)){ac.height="137"}k.title=k.title.slice(0,47)+" - Flash Player Installation";var af=O.ie&&O.win?"ActiveX":"PlugIn",ae="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+af+"&MMdoctitle="+k.title;if(typeof ad.flashvars!=F){ad.flashvars+="&"+ae}else{ad.flashvars=ae}if(O.ie&&O.win&&ag.readyState!=4){var aa=E("div");Z+="SWFObjectNew";aa.setAttribute("id",Z);ag.parentNode.insertBefore(aa,ag);ag.style.display="none";(function(){if(ag.readyState==4){ag.parentNode.removeChild(ag)}else{setTimeout(arguments.callee,10)}})()}w(ac,ad,Z)}}function r(aa){if(O.ie&&O.win&&aa.readyState!=4){var Z=E("div");aa.parentNode.insertBefore(Z,aa);Z.parentNode.replaceChild(g(aa),Z);aa.style.display="none";(function(){if(aa.readyState==4){aa.parentNode.removeChild(aa)}else{setTimeout(arguments.callee,10)}})()}else{aa.parentNode.replaceChild(g(aa),aa)}}function g(ae){var ad=E("div");if(O.win&&O.ie){ad.innerHTML=ae.innerHTML}else{var aa=ae.getElementsByTagName(t)[0];if(aa){var af=aa.childNodes;if(af){var Z=af.length;for(var ab=0;ab<Z;ab++){if(!(af[ab].nodeType==1&&af[ab].nodeName=="PARAM")&&!(af[ab].nodeType==8)){ad.appendChild(af[ab].cloneNode(true))}}}}}return ad}function w(ak,ai,aa){var Z,ac=c(aa);if(O.wk&&O.wk<312){return Z}if(ac){if(typeof ak.id==F){ak.id=aa}if(O.ie&&O.win){var aj="";for(var ag in ak){if(ak[ag]!=Object.prototype[ag]){if(ag.toLowerCase()=="data"){ai.movie=ak[ag]}else{if(ag.toLowerCase()=="styleclass"){aj+=' class="'+ak[ag]+'"'}else{if(ag.toLowerCase()!="classid"){aj+=" "+ag+'="'+ak[ag]+'"'}}}}}var ah="";for(var af in ai){if(ai[af]!=Object.prototype[af]){ah+='<param name="'+af+'" value="'+ai[af]+'" />'}}ac.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+aj+">"+ah+"</object>";P[P.length]=ak.id;Z=c(ak.id)}else{var ab=E(t);ab.setAttribute("type",s);for(var ae in ak){if(ak[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="styleclass"){ab.setAttribute("class",ak[ae])}else{if(ae.toLowerCase()!="classid"){ab.setAttribute(ae,ak[ae])}}}}for(var ad in ai){if(ai[ad]!=Object.prototype[ad]&&ad.toLowerCase()!="movie"){e(ab,ad,ai[ad])}}ac.parentNode.replaceChild(ab,ac);Z=ab}}return Z}function e(ab,Z,aa){var ac=E("param");ac.setAttribute("name",Z);ac.setAttribute("value",aa);ab.appendChild(ac)}function A(aa){var Z=c(aa);if(Z&&Z.nodeName=="OBJECT"){if(O.ie&&O.win){Z.style.display="none";(function(){if(Z.readyState==4){b(aa)}else{setTimeout(arguments.callee,10)}})()}else{Z.parentNode.removeChild(Z)}}}function b(ab){var aa=c(ab);if(aa){for(var Z in aa){if(typeof aa[Z]=="function"){aa[Z]=null}}aa.parentNode.removeChild(aa)}}function c(ab){var Z=null;try{Z=k.getElementById(ab)}catch(aa){}return Z}function E(Z){return k.createElement(Z)}function j(ab,Z,aa){ab.attachEvent(Z,aa);K[K.length]=[ab,Z,aa]}function H(ab){var aa=O.pv,Z=ab.split(".");Z[0]=parseInt(Z[0],10);Z[1]=parseInt(Z[1],10)||0;Z[2]=parseInt(Z[2],10)||0;return(aa[0]>Z[0]||(aa[0]==Z[0]&&aa[1]>Z[1])||(aa[0]==Z[0]&&aa[1]==Z[1]&&aa[2]>=Z[2]))?true:false}function x(ae,aa,af,ad){if(O.ie&&O.mac){return}var ac=k.getElementsByTagName("head")[0];if(!ac){return}var Z=(af&&typeof af=="string")?af:"screen";if(ad){p=null;I=null}if(!p||I!=Z){var ab=E("style");ab.setAttribute("type","text/css");ab.setAttribute("media",Z);p=ac.appendChild(ab);if(O.ie&&O.win&&typeof k.styleSheets!=F&&k.styleSheets.length>0){p=k.styleSheets[k.styleSheets.length-1]}I=Z}if(O.ie&&O.win){if(p&&typeof p.addRule==t){p.addRule(ae,aa)}}else{if(p&&typeof k.createTextNode!=F){p.appendChild(k.createTextNode(ae+" {"+aa+"}"))}}}function y(ab,Z){if(!n){return}var aa=Z?"visible":"hidden";if(L&&c(ab)){c(ab).style.visibility=aa}else{x("#"+ab,"visibility:"+aa)}}function N(aa){var ab=/[\\\"<>\.;]/;var Z=ab.exec(aa)!=null;return Z&&typeof encodeURIComponent!=F?encodeURIComponent(aa):aa}var d=function(){if(O.ie&&O.win){window.attachEvent("onunload",function(){var ae=K.length;for(var ad=0;ad<ae;ad++){K[ad][0].detachEvent(K[ad][1],K[ad][2])}var ab=P.length;for(var ac=0;ac<ab;ac++){A(P[ac])}for(var aa in O){O[aa]=null}O=null;for(var Z in swfobject){swfobject[Z]=null}swfobject=null})}}();return{registerObject:function(ad,Z,ac,ab){if(O.w3&&ad&&Z){var aa={};aa.id=ad;aa.swfVersion=Z;aa.expressInstall=ac;aa.callbackFn=ab;q[q.length]=aa;y(ad,false)}else{if(ab){ab({success:false,id:ad})}}},getObjectById:function(Z){if(O.w3){return B(Z)}},embedSWF:function(ad,aj,ag,ai,aa,ac,ab,af,ah,ae){var Z={success:false,id:aj};if(O.w3&&!(O.wk&&O.wk<312)&&ad&&aj&&ag&&ai&&aa){y(aj,false);M(function(){ag+="";ai+="";var al={};if(ah&&typeof ah===t){for(var an in ah){al[an]=ah[an]}}al.data=ad;al.width=ag;al.height=ai;var ao={};if(af&&typeof af===t){for(var am in af){ao[am]=af[am]}}if(ab&&typeof ab===t){for(var ak in ab){if(typeof ao.flashvars!=F){ao.flashvars+="&"+ak+"="+ab[ak]}else{ao.flashvars=ak+"="+ab[ak]}}}if(H(aa)){var ap=w(al,ao,aj);if(al.id==aj){y(aj,true)}Z.success=true;Z.ref=ap}else{if(ac&&C()){al.data=ac;R(al,ao,aj,ae);return}else{y(aj,true)}}if(ae){ae(Z)}})}else{if(ae){ae(Z)}}},switchOffAutoHideShow:function(){n=false},ua:O,getFlashPlayerVersion:function(){return{major:O.pv[0],minor:O.pv[1],release:O.pv[2]}},hasFlashPlayerVersion:H,createSWF:function(ab,aa,Z){if(O.w3){return w(ab,aa,Z)}else{return undefined}},showExpressInstall:function(ab,ac,Z,aa){if(O.w3&&C()){R(ab,ac,Z,aa)}},removeSWF:function(Z){if(O.w3){A(Z)}},createCSS:function(ac,ab,aa,Z){if(O.w3){x(ac,ab,aa,Z)}},addDomLoadEvent:M,addLoadEvent:u,getQueryParamValue:function(ac){var ab=k.location.search||k.location.hash;if(ab){if(/\?/.test(ab)){ab=ab.split("?")[1]}if(ac==null){return N(ab)}var aa=ab.split("&");for(var Z=0;Z<aa.length;Z++){if(aa[Z].substring(0,aa[Z].indexOf("="))==ac){return N(aa[Z].substring((aa[Z].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(a){var Z=c(T);if(Z&&m){Z.parentNode.replaceChild(m,Z);if(S){y(S,true);if(O.ie&&O.win){m.style.display="block"}}if(G){G(D)}}a=false}}}}();(function(){var ai=this,ac=ai._,ae={},ar=Array.prototype,ab=Object.prototype,an=Function.prototype,aw=ar.push,ah=ar.slice,au=ar.concat,ak=ab.toString,aq=ab.hasOwnProperty,ad=ar.forEach,ag=ar.map,ao=ar.reduce,aa=ar.reduceRight,at=ar.filter,ap=ar.every,aj=ar.some,X=ar.indexOf,av=ar.lastIndexOf,Y=Array.isArray,ax=Object.keys,am=an.bind,Z=function(a){return a instanceof Z?a:this instanceof Z?(this._wrapped=a,void 0):new Z(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=Z),exports._=Z):ai._=Z,Z.VERSION="1.4.4";var W=Z.each=Z.forEach=function(h,f,g){if(null!=h){if(ad&&h.forEach===ad){h.forEach(f,g)}else{if(h.length===+h.length){for(var c=0,d=h.length;d>c;c++){if(f.call(g,h[c],c,h)===ae){return}}}else{for(var b in h){if(Z.has(h,b)&&f.call(g,h[b],b,h)===ae){return}}}}}};Z.map=Z.collect=function(d,a,b){var c=[];return null==d?c:ag&&d.map===ag?d.map(a,b):(W(d,function(g,e,f){c[c.length]=a.call(b,g,e,f)}),c)};var H="Reduce of empty array with no initial value";Z.reduce=Z.foldl=Z.inject=function(f,b,c,d){var a=arguments.length>2;if(null==f&&(f=[]),ao&&f.reduce===ao){return d&&(b=Z.bind(b,d)),a?f.reduce(b,c):f.reduce(b)}if(W(f,function(h,g,e){a?c=b.call(d,c,h,g,e):(c=h,a=!0)}),!a){throw new TypeError(H)}return c},Z.reduceRight=Z.foldr=function(j,f,g,h){var c=arguments.length>2;if(null==j&&(j=[]),aa&&j.reduceRight===aa){return h&&(f=Z.bind(f,h)),c?j.reduceRight(f,g):j.reduceRight(f)}var d=j.length;if(d!==+d){var b=Z.keys(j);d=b.length}if(W(j,function(e,k,a){k=b?b[--d]:--d,c?g=f.call(h,g,j[k],k,a):(g=j[k],c=!0)}),!c){throw new TypeError(H)}return g},Z.find=Z.detect=function(d,a,b){var c;return Q(d,function(g,e,f){return a.call(b,g,e,f)?(c=g,!0):void 0}),c},Z.filter=Z.select=function(d,a,b){var c=[];return null==d?c:at&&d.filter===at?d.filter(a,b):(W(d,function(g,e,f){a.call(b,g,e,f)&&(c[c.length]=g)}),c)},Z.reject=function(c,a,b){return Z.filter(c,function(g,f,d){return !a.call(b,g,f,d)},b)},Z.every=Z.all=function(d,b,c){b||(b=Z.identity);var a=!0;return null==d?a:ap&&d.every===ap?d.every(b,c):(W(d,function(g,f,e){return(a=a&&b.call(c,g,f,e))?void 0:ae}),!!a)};var Q=Z.some=Z.any=function(d,b,c){b||(b=Z.identity);var a=!1;return null==d?a:aj&&d.some===aj?d.some(b,c):(W(d,function(g,f,e){return a||(a=b.call(c,g,f,e))?ae:void 0}),!!a)};Z.contains=Z.include=function(b,a){return null==b?!1:X&&b.indexOf===X?b.indexOf(a)!=-1:Q(b,function(c){return c===a})},Z.invoke=function(d,a){var b=ah.call(arguments,2),c=Z.isFunction(a);return Z.map(d,function(e){return(c?a:e[a]).apply(e,b)})},Z.pluck=function(b,a){return Z.map(b,function(c){return c[a]})},Z.where=function(c,a,b){return Z.isEmpty(a)?b?null:[]:Z[b?"find":"filter"](c,function(e){for(var d in a){if(a[d]!==e[d]){return !1}}return !0})},Z.findWhere=function(b,a){return Z.where(b,a,!0)},Z.max=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.max.apply(Math,d)}if(!a&&Z.isEmpty(d)){return -1/0}var c={computed:-1/0,value:-1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;e>=c.computed&&(c={value:h,computed:e})}),c.value},Z.min=function(d,a,b){if(!a&&Z.isArray(d)&&d[0]===+d[0]&&65535>d.length){return Math.min.apply(Math,d)}if(!a&&Z.isEmpty(d)){return 1/0}var c={computed:1/0,value:1/0};return W(d,function(h,f,g){var e=a?a.call(b,h,f,g):h;c.computed>e&&(c={value:h,computed:e})}),c.value},Z.shuffle=function(d){var a,b=0,c=[];return W(d,function(e){a=Z.random(b++),c[b-1]=c[a],c[a]=e}),c};var al=function(a){return Z.isFunction(a)?a:function(b){return b[a]}};Z.sortBy=function(d,a,b){var c=al(a);return Z.pluck(Z.map(d,function(g,f,e){return{value:g,index:f,criteria:c.call(b,g,f,e)}}).sort(function(j,f){var g=j.criteria,h=f.criteria;if(g!==h){if(g>h||g===void 0){return 1}if(h>g||h===void 0){return -1}}return j.index<f.index?-1:1}),"value")};var P=function(g,c,d,f){var a={},b=al(c||Z.identity);return W(g,function(h,e){var j=b.call(d,h,e,g);f(a,j,h)}),a};Z.groupBy=function(c,a,b){return P(c,a,b,function(f,d,e){(Z.has(f,d)?f[d]:f[d]=[]).push(e)})},Z.countBy=function(c,a,b){return P(c,a,b,function(e,d){Z.has(e,d)||(e[d]=0),e[d]++})},Z.sortedIndex=function(k,f,g,h){g=null==g?Z.identity:al(g);for(var c=g.call(h,f),d=0,b=k.length;b>d;){var j=d+b>>>1;c>g.call(h,k[j])?d=j+1:b=j}return d},Z.toArray=function(a){return a?Z.isArray(a)?ah.call(a):a.length===+a.length?Z.map(a,Z.identity):Z.values(a):[]},Z.size=function(a){return null==a?0:a.length===+a.length?a.length:Z.keys(a).length},Z.first=Z.head=Z.take=function(c,a,b){return null==c?void 0:null==a||b?c[0]:ah.call(c,0,a)},Z.initial=function(c,a,b){return ah.call(c,0,c.length-(null==a||b?1:a))},Z.last=function(c,a,b){return null==c?void 0:null==a||b?c[c.length-1]:ah.call(c,Math.max(c.length-a,0))},Z.rest=Z.tail=Z.drop=function(c,a,b){return ah.call(c,null==a||b?1:a)},Z.compact=function(a){return Z.filter(a,Z.identity)};var G=function(c,a,b){return W(c,function(d){Z.isArray(d)?a?aw.apply(b,d):G(d,a,b):b.push(d)}),b};Z.flatten=function(b,a){return G(b,a,[])},Z.without=function(a){return Z.difference(a,ah.call(arguments,1))},Z.uniq=Z.unique=function(j,f,g,h){Z.isFunction(f)&&(h=g,g=f,f=!1);var c=g?Z.map(j,g,h):j,d=[],b=[];return W(c,function(a,k){(f?k&&b[b.length-1]===a:Z.contains(b,a))||(b.push(a),d.push(j[k]))}),d},Z.union=function(){return Z.uniq(au.apply(ar,arguments))},Z.intersection=function(b){var a=ah.call(arguments,1);return Z.filter(Z.uniq(b),function(c){return Z.every(a,function(d){return Z.indexOf(d,c)>=0})})},Z.difference=function(b){var a=au.apply(ar,ah.call(arguments,1));return Z.filter(b,function(c){return !Z.contains(a,c)})},Z.zip=function(){for(var d=ah.call(arguments),a=Z.max(Z.pluck(d,"length")),b=Array(a),c=0;a>c;c++){b[c]=Z.pluck(d,""+c)}return b},Z.object=function(f,b){if(null==f){return{}}for(var c={},d=0,a=f.length;a>d;d++){b?c[f[d]]=b[d]:c[f[d][0]]=f[d][1]}return c},Z.indexOf=function(f,b,c){if(null==f){return -1}var d=0,a=f.length;if(c){if("number"!=typeof c){return d=Z.sortedIndex(f,b),f[d]===b?d:-1}d=0>c?Math.max(0,a+c):c}if(X&&f.indexOf===X){return f.indexOf(b,c)}for(;a>d;d++){if(f[d]===b){return d}}return -1},Z.lastIndexOf=function(f,b,c){if(null==f){return -1}var d=null!=c;if(av&&f.lastIndexOf===av){return d?f.lastIndexOf(b,c):f.lastIndexOf(b)}for(var a=d?c:f.length;a--;){if(f[a]===b){return a}}return -1},Z.range=function(g,c,d){1>=arguments.length&&(c=g||0,g=0),d=arguments[2]||1;for(var f=Math.max(Math.ceil((c-g)/d),0),a=0,b=Array(f);f>a;){b[a++]=g,g+=d}return b},Z.bind=function(c,a){if(c.bind===am&&am){return am.apply(c,ah.call(arguments,1))}var b=ah.call(arguments,2);return function(){return c.apply(a,b.concat(ah.call(arguments)))}},Z.partial=function(b){var a=ah.call(arguments,1);return function(){return b.apply(this,a.concat(ah.call(arguments)))}},Z.bindAll=function(b){var a=ah.call(arguments,1);return 0===a.length&&(a=Z.functions(b)),W(a,function(c){b[c]=Z.bind(b[c],b)}),b},Z.memoize=function(c,a){var b={};return a||(a=Z.identity),function(){var d=a.apply(this,arguments);return Z.has(b,d)?b[d]:b[d]=c.apply(this,arguments)}},Z.delay=function(c,a){var b=ah.call(arguments,2);return setTimeout(function(){return c.apply(null,b)},a)},Z.defer=function(a){return Z.delay.apply(Z,[a,1].concat(ah.call(arguments,1)))},Z.throttle=function(k,f){var g,h,c,d,b=0,j=function(){b=new Date,c=null,d=k.apply(g,h)};return function(){var e=new Date,a=f-(e-b);return g=this,h=arguments,0>=a?(clearTimeout(c),c=null,b=e,d=k.apply(g,h)):c||(c=setTimeout(j,a)),d}},Z.debounce=function(f,b,c){var d,a;return function(){var g=this,e=arguments,h=function(){d=null,c||(a=f.apply(g,e))},j=c&&!d;return clearTimeout(d),d=setTimeout(h,b),j&&(a=f.apply(g,e)),a}},Z.once=function(c){var a,b=!1;return function(){return b?a:(b=!0,a=c.apply(this,arguments),c=null,a)}},Z.wrap=function(b,a){return function(){var c=[b];return aw.apply(c,arguments),a.apply(this,c)}},Z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--){b=[a[c].apply(this,b)]}return b[0]}},Z.after=function(b,a){return 0>=b?a():function(){return 1>--b?a.apply(this,arguments):void 0}},Z.keys=ax||function(c){if(c!==Object(c)){throw new TypeError("Invalid object")}var a=[];for(var b in c){Z.has(c,b)&&(a[a.length]=b)}return a},Z.values=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push(c[b])}return a},Z.pairs=function(c){var a=[];for(var b in c){Z.has(c,b)&&a.push([b,c[b]])}return a},Z.invert=function(c){var a={};for(var b in c){Z.has(c,b)&&(a[c[b]]=b)}return a},Z.functions=Z.methods=function(c){var a=[];for(var b in c){Z.isFunction(c[b])&&a.push(b)}return a.sort()},Z.extend=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){a[c]=b[c]}}}),a},Z.pick=function(c){var a={},b=au.apply(ar,ah.call(arguments,1));return W(b,function(d){d in c&&(a[d]=c[d])}),a},Z.omit=function(d){var b={},c=au.apply(ar,ah.call(arguments,1));for(var a in d){Z.contains(c,a)||(b[a]=d[a])}return b},Z.defaults=function(a){return W(ah.call(arguments,1),function(b){if(b){for(var c in b){null==a[c]&&(a[c]=b[c])}}}),a},Z.clone=function(a){return Z.isObject(a)?Z.isArray(a)?a.slice():Z.extend({},a):a},Z.tap=function(b,a){return a(b),b};var L=function(g,q,b,k){if(g===q){return 0!==g||1/g==1/q}if(null==g||null==q){return g===q}g instanceof Z&&(g=g._wrapped),q instanceof Z&&(q=q._wrapped);var p=ak.call(g);if(p!=ak.call(q)){return !1}switch(p){case"[object String]":return g==q+"";case"[object Number]":return g!=+g?q!=+q:0==g?1/g==1/q:g==+q;case"[object Date]":case"[object Boolean]":return +g==+q;case"[object RegExp]":return g.source==q.source&&g.global==q.global&&g.multiline==q.multiline&&g.ignoreCase==q.ignoreCase}if("object"!=typeof g||"object"!=typeof q){return !1}for(var h=b.length;h--;){if(b[h]==g){return k[h]==q}}b.push(g),k.push(q);var m=0,d=!0;if("[object Array]"==p){if(m=g.length,d=m==q.length){for(;m--&&(d=L(g[m],q[m],b,k));){}}}else{var l=g.constructor,j=q.constructor;if(l!==j&&!(Z.isFunction(l)&&l instanceof l&&Z.isFunction(j)&&j instanceof j)){return !1}for(var v in g){if(Z.has(g,v)&&(m++,!(d=Z.has(q,v)&&L(g[v],q[v],b,k)))){break}}if(d){for(v in q){if(Z.has(q,v)&&!m--){break}}d=!m}}return b.pop(),k.pop(),d};Z.isEqual=function(b,a){return L(b,a,[],[])},Z.isEmpty=function(b){if(null==b){return !0}if(Z.isArray(b)||Z.isString(b)){return 0===b.length}for(var a in b){if(Z.has(b,a)){return !1}}return !0},Z.isElement=function(a){return !(!a||1!==a.nodeType)},Z.isArray=Y||function(a){return"[object Array]"==ak.call(a)},Z.isObject=function(a){return a===Object(a)},W(["Arguments","Function","String","Number","Date","RegExp"],function(a){Z["is"+a]=function(b){return ak.call(b)=="[object "+a+"]"}}),Z.isArguments(arguments)||(Z.isArguments=function(a){return !(!a||!Z.has(a,"callee"))}),"function"!=typeof/./&&(Z.isFunction=function(a){return"function"==typeof a}),Z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},Z.isNaN=function(a){return Z.isNumber(a)&&a!=+a},Z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==ak.call(a)},Z.isNull=function(a){return null===a},Z.isUndefined=function(a){return a===void 0},Z.has=function(b,a){return aq.call(b,a)},Z.noConflict=function(){return ai._=ac,this},Z.identity=function(a){return a},Z.times=function(f,b,c){for(var d=Array(f),a=0;f>a;a++){d[a]=b.call(c,a)}return d},Z.random=function(b,a){return null==a&&(a=b,b=0),b+Math.floor(Math.random()*(a-b+1))};var K={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};K.unescape=Z.invert(K.escape);var C={escape:RegExp("["+Z.keys(K.escape).join("")+"]","g"),unescape:RegExp("("+Z.keys(K.unescape).join("|")+")","g")};Z.each(["escape","unescape"],function(a){Z[a]=function(b){return null==b?"":(""+b).replace(C[a],function(c){return K[a][c]})}}),Z.result=function(c,a){if(null==c){return null}var b=c[a];return Z.isFunction(b)?b.call(c):b},Z.mixin=function(a){W(Z.functions(a),function(b){var c=Z[b]=a[b];Z.prototype[b]=function(){var d=[this._wrapped];return aw.apply(d,arguments),U.call(this,c.apply(Z,d))}})};var J=0;Z.uniqueId=function(b){var a=++J+"";return b?b+a:a},Z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,af={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},V=/\\|'|\r|\n|\t|\u2028|\u2029/g;Z.template=function(f,m,b){var h;b=Z.defaults({},b,Z.templateSettings);var l=RegExp([(b.escape||z).source,(b.interpolate||z).source,(b.evaluate||z).source].join("|")+"|$","g"),g=0,k="__p+='";f.replace(l,function(c,n,p,a,q){return k+=f.slice(g,q).replace(V,function(e){return"\\"+af[e]}),n&&(k+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),p&&(k+="'+\n((__t=("+p+"))==null?'':__t)+\n'"),a&&(k+="';\n"+a+"\n__p+='"),g=q+c.length,c}),k+="';\n",b.variable||(k="with(obj||{}){\n"+k+"}\n"),k="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+k+"return __p;\n";try{h=Function(b.variable||"obj","_",k)}catch(d){throw d.source=k,d}if(m){return h(m,Z)}var j=function(a){return h.call(this,a,Z)};return j.source="function("+(b.variable||"obj")+"){\n"+k+"}",j},Z.chain=function(a){return Z(a).chain()};var U=function(a){return this._chain?Z(a).chain():a};Z.mixin(Z),W(["pop","push","reverse","shift","sort","splice","unshift"],function(b){var a=ar[b];Z.prototype[b]=function(){var c=this._wrapped;return a.apply(c,arguments),"shift"!=b&&"splice"!=b||0!==c.length||delete c[0],U.call(this,c)}}),W(["concat","join","slice"],function(b){var a=ar[b];Z.prototype[b]=function(){return U.call(this,a.apply(this._wrapped,arguments))}}),Z.extend(Z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this);!function(y,k){function b(g,h){var f,c,a=g.toLowerCase();for(h=[].concat(h),f=0;h.length>f;f+=1){if(c=h[f]){if(c.test&&c.test(g)){return !0}if(c.toLowerCase()===a){return !0}}}}var C=k.prototype.trim,B=k.prototype.trimRight,q=k.prototype.trimLeft,m=function(a){return 1*a||0},j=function(c,f){if(1>f){return""}for(var a="";f>0;){1&f&&(a+=c),f>>=1,c+=c}return a},A=[].slice,z=function(a){return null==a?"\\s":a.source?a.source:"["+w.escapeRegExp(a)+"]"},D={lt:"<",gt:">",quot:'"',amp:"&",apos:"'"},x={};for(var d in D){x[D[d]]=d}x["'"]="#39";var v=function(){function f(g){return Object.prototype.toString.call(g).slice(8,-1).toLowerCase()}var c=j,a=function(){return a.cache.hasOwnProperty(arguments[0])||(a.cache[arguments[0]]=a.parse(arguments[0])),a.format.call(null,a.cache[arguments[0]],arguments)};return a.format=function(L,K){var E,r,h,J,I,M,G,e=1,F=L.length,H="",n=[];for(r=0;F>r;r++){if(H=f(L[r]),"string"===H){n.push(L[r])}else{if("array"===H){if(J=L[r],J[2]){for(E=K[e],h=0;J[2].length>h;h++){if(!E.hasOwnProperty(J[2][h])){throw new Error(v('[_.sprintf] property "%s" does not exist',J[2][h]))}E=E[J[2][h]]}}else{E=J[1]?K[J[1]]:K[e++]}if(/[^s]/.test(J[8])&&"number"!=f(E)){throw new Error(v("[_.sprintf] expecting number but found %s",f(E)))}switch(J[8]){case"b":E=E.toString(2);break;case"c":E=k.fromCharCode(E);break;case"d":E=parseInt(E,10);break;case"e":E=J[7]?E.toExponential(J[7]):E.toExponential();break;case"f":E=J[7]?parseFloat(E).toFixed(J[7]):parseFloat(E);break;case"o":E=E.toString(8);break;case"s":E=(E=k(E))&&J[7]?E.substring(0,J[7]):E;break;case"u":E=Math.abs(E);break;case"x":E=E.toString(16);break;case"X":E=E.toString(16).toUpperCase()}E=/[def]/.test(J[8])&&J[3]&&E>=0?"+"+E:E,M=J[4]?"0"==J[4]?"0":J[4].charAt(1):" ",G=J[6]-k(E).length,I=J[6]?c(M,G):"",n.push(J[5]?E+I:I+E)}}}return n.join("")},a.cache={},a.parse=function(F){for(var H=F,E=[],s=[],h=0;H;){if(null!==(E=/^[^\x25]+/.exec(H))){s.push(E[0])}else{if(null!==(E=/^\x25{2}/.exec(H))){s.push("%")}else{if(null===(E=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(H))){throw new Error("[_.sprintf] huh?")}if(E[2]){h|=1;var p=[],g=E[2],G=[];if(null===(G=/^([a-z_][a-z_\d]*)/i.exec(g))){throw new Error("[_.sprintf] huh?")}for(p.push(G[1]);""!==(g=g.substring(G[0].length));){if(null!==(G=/^\.([a-z_][a-z_\d]*)/i.exec(g))){p.push(G[1])}else{if(null===(G=/^\[(\d+)\]/.exec(g))){throw new Error("[_.sprintf] huh?")}p.push(G[1])}}E[2]=p}else{h|=2}if(3===h){throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported")}s.push(E)}}H=H.substring(E[0].length)}return s},a}(),w={VERSION:"2.3.0",isBlank:function(a){return null==a&&(a=""),/^\s*$/.test(a)},stripTags:function(a){return null==a?"":k(a).replace(/<\/?[^>]+>/g,"")},capitalize:function(a){return a=null==a?"":k(a),a.charAt(0).toUpperCase()+a.slice(1)},chop:function(c,a){return null==c?[]:(c=k(c),a=~~a,a>0?c.match(new RegExp(".{1,"+a+"}","g")):[c])},clean:function(a){return w.strip(a).replace(/\s+/g," ")},count:function(h,g){if(null==h||null==g){return 0}h=k(h),g=k(g);for(var f=0,a=0,c=g.length;;){if(a=h.indexOf(g,a),-1===a){break}f++,a+=c}return f},chars:function(a){return null==a?[]:k(a).split("")},swapCase:function(a){return null==a?"":k(a).replace(/\S/g,function(c){return c===c.toUpperCase()?c.toLowerCase():c.toUpperCase()})},escapeHTML:function(a){return null==a?"":k(a).replace(/[&<>"']/g,function(c){return"&"+x[c]+";"})},unescapeHTML:function(a){return null==a?"":k(a).replace(/\&([^;]+);/g,function(g,f){var c;return f in D?D[f]:(c=f.match(/^#x([\da-fA-F]+)$/))?k.fromCharCode(parseInt(c[1],16)):(c=f.match(/^#(\d+)$/))?k.fromCharCode(~~c[1]):g})},escapeRegExp:function(a){return null==a?"":k(a).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(g,h,f,c){var a=w.chars(g);return a.splice(~~h,~~f,c),a.join("")},insert:function(c,f,a){return w.splice(c,f,0,a)},include:function(c,a){return""===a?!0:null==c?!1:-1!==k(c).indexOf(a)},join:function(){var a=A.call(arguments),c=a.shift();return null==c&&(c=""),a.join(c)},lines:function(a){return null==a?[]:k(a).split("\n")},reverse:function(a){return w.chars(a).reverse().join("")},startsWith:function(c,a){return""===a?!0:null==c||null==a?!1:(c=k(c),a=k(a),c.length>=a.length&&c.slice(0,a.length)===a)},endsWith:function(c,a){return""===a?!0:null==c||null==a?!1:(c=k(c),a=k(a),c.length>=a.length&&c.slice(c.length-a.length)===a)},succ:function(a){return null==a?"":(a=k(a),a.slice(0,-1)+k.fromCharCode(a.charCodeAt(a.length-1)+1))},titleize:function(a){return null==a?"":(a=k(a).toLowerCase(),a.replace(/(?:^|\s|-)\S/g,function(c){return c.toUpperCase()}))},camelize:function(a){return w.trim(a).replace(/[-_\s]+(.)?/g,function(c,f){return f?f.toUpperCase():""})},underscored:function(a){return w.trim(a).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(a){return w.trim(a).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(a){return w.titleize(k(a).replace(/[\W_]/g," ")).replace(/\s/g,"")},humanize:function(a){return w.capitalize(w.underscored(a).replace(/_id$/,"").replace(/_/g," "))},trim:function(c,a){return null==c?"":!a&&C?C.call(c):(a=z(a),k(c).replace(new RegExp("^"+a+"+|"+a+"+$","g"),""))},ltrim:function(c,a){return null==c?"":!a&&q?q.call(c):(a=z(a),k(c).replace(new RegExp("^"+a+"+"),""))},rtrim:function(c,a){return null==c?"":!a&&B?B.call(c):(a=z(a),k(c).replace(new RegExp(a+"+$"),""))},truncate:function(f,c,a){return null==f?"":(f=k(f),a=a||"...",c=~~c,f.length>c?f.slice(0,c)+a:f)},prune:function(h,g,f){if(null==h){return""}if(h=k(h),g=~~g,f=null!=f?k(f):"...",g>=h.length){return h}var a=function(l){return l.toUpperCase()!==l.toLowerCase()?"A":" "},c=h.slice(0,g+1).replace(/.(?=\W*\w*$)/g,a);return c=c.slice(c.length-2).match(/\w\w/)?c.replace(/\s*\S+$/,""):w.rtrim(c.slice(0,c.length-1)),(c+f).length>h.length?h:h.slice(0,c.length)+f},words:function(a,c){return w.isBlank(a)?[]:w.trim(a,c).split(c||/\s+/)},pad:function(h,g,f,a){h=null==h?"":k(h),g=~~g;var c=0;switch(f?f.length>1&&(f=f.charAt(0)):f=" ",a){case"right":return c=g-h.length,h+j(f,c);case"both":return c=g-h.length,j(f,Math.ceil(c/2))+h+j(f,Math.floor(c/2));default:return c=g-h.length,j(f,c)+h}},lpad:function(c,f,a){return w.pad(c,f,a)},rpad:function(c,f,a){return w.pad(c,f,a,"right")},lrpad:function(c,f,a){return w.pad(c,f,a,"both")},sprintf:v,vsprintf:function(a,c){return c.unshift(a),v.apply(null,c)},toNumber:function(a,c){return a?(a=w.trim(a),a.match(/^-?\d+(?:\.\d+)?$/)?m(m(a).toFixed(~~c)):0/0):0},numberFormat:function(p,s,h,g){if(isNaN(p)||null==p){return""}p=p.toFixed(~~s),g="string"==typeof g?g:",";var c=p.split("."),f=c[0],a=c[1]?(h||".")+c[1]:"";return f.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+g)+a},strRight:function(f,c){if(null==f){return""}f=k(f),c=null!=c?k(c):c;var a=c?f.indexOf(c):-1;return ~a?f.slice(a+c.length,f.length):f},strRightBack:function(f,c){if(null==f){return""}f=k(f),c=null!=c?k(c):c;var a=c?f.lastIndexOf(c):-1;return ~a?f.slice(a+c.length,f.length):f},strLeft:function(f,c){if(null==f){return""}f=k(f),c=null!=c?k(c):c;var a=c?f.indexOf(c):-1;return ~a?f.slice(0,a):f},strLeftBack:function(c,f){if(null==c){return""}c+="",f=null!=f?""+f:f;var a=c.lastIndexOf(f);return ~a?c.slice(0,a):c},toSentence:function(h,l,g,f){l=l||", ",g=g||" and ";var a=h.slice(),c=a.pop();return h.length>2&&f&&(g=w.rtrim(l)+g),a.length?a.join(l)+g+c:c},toSentenceSerial:function(){var a=A.call(arguments);return a[3]=!0,w.toSentence.apply(w,a)},slugify:function(g){if(null==g){return""}var f="ąàáäâãåæăćęèéëêìíïîłńòóöôõøśșțùúüûñçżź",c="aaaaaaaaaceeeeeiiiilnoooooosstuuuunczz",a=new RegExp(z(f),"g");return g=k(g).toLowerCase().replace(a,function(h){var l=f.indexOf(h);return c.charAt(l)||"-"}),w.dasherize(g.replace(/[^\w\s-]/g,""))},surround:function(a,c){return[c,a,c].join("")},quote:function(a,c){return w.surround(a,c||'"')},unquote:function(a,c){return c=c||'"',a[0]===c&&a[a.length-1]===c?a.slice(1,a.length-1):a},exports:function(){var a={};for(var c in this){this.hasOwnProperty(c)&&!c.match(/^(?:include|contains|reverse)$/)&&(a[c]=this[c])}return a},repeat:function(g,f,c){if(null==g){return""}if(f=~~f,null==c){return j(k(g),f)}for(var a=[];f>0;a[--f]=g){}return a.join(c)},naturalCmp:function(F,g){if(F==g){return 0}if(!F){return -1}if(!g){return 1}for(var J=/(\.\d+)|(\d+)|(\D+)/g,I=k(F).toLowerCase().match(J),p=k(g).toLowerCase().match(J),n=Math.min(I.length,p.length),h=0;n>h;h++){var H=I[h],G=p[h];if(H!==G){var K=parseInt(H,10);if(!isNaN(K)){var E=parseInt(G,10);if(!isNaN(E)&&K-E){return K-E}}return G>H?-1:1}}return I.length===p.length?I.length-p.length:g>F?-1:1},levenshtein:function(n,h){if(null==n&&null==h){return 0}if(null==n){return k(h).length}if(null==h){return k(n).length}n=k(n),h=k(h);for(var g,c,f=[],a=0;h.length>=a;a++){for(var p=0;n.length>=p;p++){c=a&&p?n.charAt(p-1)===h.charAt(a-1)?g:Math.min(f[p],f[p-1],g)+1:a+p,g=f[p],f[p]=c}}return f.pop()},toBoolean:function(c,f,a){return"number"==typeof c&&(c=""+c),"string"!=typeof c?!!c:(c=w.trim(c),b(c,f||["true","1"])?!0:b(c,a||["false","0"])?!1:void 0)}};w.strip=w.trim,w.lstrip=w.ltrim,w.rstrip=w.rtrim,w.center=w.lrpad,w.rjust=w.lpad,w.ljust=w.rpad,w.contains=w.include,w.q=w.quote,w.toBool=w.toBoolean,"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(module.exports=w),exports._s=w),"function"==typeof define&&define.amd&&define("underscore.string",[],function(){return w}),y._=y._||{},y._.string=y._.str=w}(this,String);Date.$VERSION=1.02;Date.LZ=function(a){return(a<0||a>9?"":"0")+a};Date.monthNames=new Array("January","February","March","April","May","June","July","August","September","October","November","December");Date.monthAbbreviations=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");Date.dayNames=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday");Date.dayAbbreviations=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat");Date.preferAmericanFormat=true;if(!Date.prototype.getFullYear){Date.prototype.getFullYear=function(){var a=this.getYear();return(a<1900?a+1900:a)}}Date.parseString=function(I,B){if(typeof(B)=="undefined"||B==null||B==""){var p=new Array("y-M-d","MMM d, y","MMM d,y","y-MMM-d","d-MMM-y","MMM d","MMM-d","d-MMM");var b=new Array("M/d/y","M-d-y","M.d.y","M/d","M-d");var n=new Array("d/M/y","d-M-y","d.M.y","d/M","d-M");var e=new Array(p,Date.preferAmericanFormat?b:n,Date.preferAmericanFormat?n:b);for(var z=0;z<e.length;z++){var v=e[z];for(var w=0;w<v.length;w++){var C=Date.parseString(I,v[w]);if(C!=null){return C}}}return null}this.isInteger=function(d){for(var c=0;c<d.length;c++){if("1234567890".indexOf(d.charAt(c))==-1){return false}}return true};this.getInt=function(J,l,y,j){for(var c=j;c>=y;c--){var d=J.substring(l,l+c);if(d.length<y){return null}if(this.isInteger(d)){return d}}return null};I=I+"";B=B+"";var H=0;var s=0;var E="";var g="";var G="";var k,h;var m=new Date().getFullYear();var F=1;var D=1;var a=0;var A=0;var u=0;var r="";while(s<B.length){E=B.charAt(s);g="";while((B.charAt(s)==E)&&(s<B.length)){g+=B.charAt(s++)}if(g=="yyyy"||g=="yy"||g=="y"){if(g=="yyyy"){k=4;h=4}if(g=="yy"){k=2;h=2}if(g=="y"){k=2;h=4}m=this.getInt(I,H,k,h);if(m==null){return null}H+=m.length;if(m.length==2){if(m>70){m=1900+(m-0)}else{m=2000+(m-0)}}}else{if(g=="MMM"||g=="NNN"){F=0;var q=(g=="MMM"?(Date.monthNames.concat(Date.monthAbbreviations)):Date.monthAbbreviations);for(var z=0;z<q.length;z++){var f=q[z];if(I.substring(H,H+f.length).toLowerCase()==f.toLowerCase()){F=(z%12)+1;H+=f.length;break}}if((F<1)||(F>12)){return null}}else{if(g=="EE"||g=="E"){var q=(g=="EE"?Date.dayNames:Date.dayAbbreviations);for(var z=0;z<q.length;z++){var t=q[z];if(I.substring(H,H+t.length).toLowerCase()==t.toLowerCase()){H+=t.length;break}}}else{if(g=="MM"||g=="M"){F=this.getInt(I,H,g.length,2);if(F==null||(F<1)||(F>12)){return null}H+=F.length}else{if(g=="dd"||g=="d"){D=this.getInt(I,H,g.length,2);if(D==null||(D<1)||(D>31)){return null}H+=D.length}else{if(g=="hh"||g=="h"){a=this.getInt(I,H,g.length,2);if(a==null||(a<1)||(a>12)){return null}H+=a.length}else{if(g=="HH"||g=="H"){a=this.getInt(I,H,g.length,2);if(a==null||(a<0)||(a>23)){return null}H+=a.length}else{if(g=="KK"||g=="K"){a=this.getInt(I,H,g.length,2);if(a==null||(a<0)||(a>11)){return null}H+=a.length;a++}else{if(g=="kk"||g=="k"){a=this.getInt(I,H,g.length,2);if(a==null||(a<1)||(a>24)){return null}H+=a.length;a--}else{if(g=="mm"||g=="m"){A=this.getInt(I,H,g.length,2);if(A==null||(A<0)||(A>59)){return null}H+=A.length}else{if(g=="ss"||g=="s"){u=this.getInt(I,H,g.length,2);if(u==null||(u<0)||(u>59)){return null}H+=u.length}else{if(g=="a"){if(I.substring(H,H+2).toLowerCase()=="am"){r="AM"}else{if(I.substring(H,H+2).toLowerCase()=="pm"){r="PM"}else{return null}}H+=2}else{if(I.substring(H,H+g.length)!=g){return null}else{H+=g.length}}}}}}}}}}}}}}if(H!=I.length){return null}if(F==2){if(((m%4==0)&&(m%100!=0))||(m%400==0)){if(D>29){return null}}else{if(D>28){return null}}}if((F==4)||(F==6)||(F==9)||(F==11)){if(D>30){return null}}if(a<12&&r=="PM"){a=a-0+12}else{if(a>11&&r=="AM"){a-=12}}return new Date(m,F-1,D,a,A,u)};Date.isValid=function(b,a){return(Date.parseString(b,a)!=null)};Date.prototype.isBefore=function(a){if(a==null){return false}return(this.getTime()<a.getTime())};Date.prototype.isAfter=function(a){if(a==null){return false}return(this.getTime()>a.getTime())};Date.prototype.equals=function(a){if(a==null){return false}return(this.getTime()==a.getTime())};Date.prototype.equalsIgnoreTime=function(c){if(c==null){return false}var b=new Date(this.getTime()).clearTime();var a=new Date(c.getTime()).clearTime();return(b.getTime()==a.getTime())};Date.prototype.format=function(G){G=G+"";var n="";var x=0;var J="";var f="";var l=this.getYear()+"";var g=this.getMonth()+1;var I=this.getDate();var q=this.getDay();var p=this.getHours();var A=this.getMinutes();var t=this.getSeconds();var v,w,b,u,L,e,F,D,B,r,O,p,N,j,a,C;var z=new Object();if(l.length<4){l=""+(+l+1900)}z.y=""+l;z.yyyy=l;z.yy=l.substring(2,4);z.M=g;z.MM=Date.LZ(g);z.MMM=Date.monthNames[g-1];z.NNN=Date.monthAbbreviations[g-1];z.d=I;z.dd=Date.LZ(I);z.E=Date.dayAbbreviations[q];z.EE=Date.dayNames[q];z.H=p;z.HH=Date.LZ(p);if(p==0){z.h=12}else{if(p>12){z.h=p-12}else{z.h=p}}z.hh=Date.LZ(z.h);z.K=z.h-1;z.k=z.H+1;z.KK=Date.LZ(z.K);z.kk=Date.LZ(z.k);if(p>11){z.a="PM"}else{z.a="AM"}z.m=A;z.mm=Date.LZ(A);z.s=t;z.ss=Date.LZ(t);while(x<G.length){J=G.charAt(x);f="";while((G.charAt(x)==J)&&(x<G.length)){f+=G.charAt(x++)}if(typeof(z[f])!="undefined"){n=n+z[f]}else{n=n+f}}return n};Date.prototype.getDayName=function(){return Date.dayNames[this.getDay()]};Date.prototype.getDayAbbreviation=function(){return Date.dayAbbreviations[this.getDay()]};Date.prototype.getMonthName=function(){return Date.monthNames[this.getMonth()]};Date.prototype.getMonthAbbreviation=function(){return Date.monthAbbreviations[this.getMonth()]};Date.prototype.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this};Date.prototype.add=function(a,c){if(typeof(a)=="undefined"||a==null||typeof(c)=="undefined"||c==null){return this}c=+c;if(a=="y"){this.setFullYear(this.getFullYear()+c)}else{if(a=="M"){this.setMonth(this.getMonth()+c)}else{if(a=="d"){this.setDate(this.getDate()+c)}else{if(a=="w"){var b=(c>0)?1:-1;while(c!=0){this.add("d",b);while(this.getDay()==0||this.getDay()==6){this.add("d",b)}c-=b}}else{if(a=="h"){this.setHours(this.getHours()+c)}else{if(a=="m"){this.setMinutes(this.getMinutes()+c)}else{if(a=="s"){this.setSeconds(this.getSeconds()+c)}}}}}}}return this};(function(e){function d(j,h){if(this.createTextRange){var g=this.createTextRange();g.collapse(true);g.moveStart("character",j);g.moveEnd("character",h-j);g.select()}else{if(this.setSelectionRange){this.focus();this.setSelectionRange(j,h)}}}function b(j){var m=this.value.length;j=(j.toLowerCase()=="start"?"Start":"End");if(document.selection){var g=document.selection.createRange(),h,k,l;h=g.duplicate();h.expand("textedit");h.setEndPoint("EndToEnd",g);k=h.text.length-g.text.length;l=k+g.text.length;return j=="Start"?k:l}else{if(typeof(this["selection"+j])!="undefined"){m=this["selection"+j]}}return m}var a={codes:{188:44,109:45,190:46,191:47,192:96,220:92,222:39,221:93,219:91,173:45,187:61,186:59,189:45,110:46},shifts:{96:"~",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",48:")",45:"_",61:"+",91:"{",93:"}",92:"|",59:":",39:'"',44:"<",46:">",47:"?"}};e.fn.number=function(m,h,k,g){g=(typeof g==="undefined")?",":g;k=(typeof k==="undefined")?".":k;h=(typeof h==="undefined")?0:h;var n=("\\u"+("0000"+(k.charCodeAt(0).toString(16))).slice(-4)),l=new RegExp("[^"+n+"0-9]","g"),j=new RegExp(n,"g");if(m===true){if(this.is("input:text")){return this.on({"keydown.format":function(v){var w=e(this),t=w.data("numFormat"),q=(v.keyCode?v.keyCode:v.which),u="",p=b.apply(this,["start"]),s=b.apply(this,["end"]),r="",y=false;if(a.codes.hasOwnProperty(q)){q=a.codes[q]}if(!v.shiftKey&&(q>=65&&q<=90)){q+=32}else{if(!v.shiftKey&&(q>=69&&q<=105)){q-=48}else{if(v.shiftKey&&a.shifts.hasOwnProperty(q)){u=a.shifts[q]}}}if(u==""){u=String.fromCharCode(q)}if(q!==8&&u!=k&&!u.match(/[0-9]/)){var x=(v.keyCode?v.keyCode:v.which);if(x==46||x==8||x==9||x==27||x==13||((x==65||x==82)&&(v.ctrlKey||v.metaKey)===true)||((x>=35&&x<=39))){return}v.preventDefault();return false}if((p==0&&s==this.value.length||w.val()==0)&&!v.metaKey&&!v.ctrlKey&&!v.altKey&&u.length===1&&u!=0){p=s=1;this.value="";t.init=(h>0?-1:0);t.c=(h>0?-(h+1):0);d.apply(this,[0,0])}else{t.c=s-this.value.length}if(h>0&&u==k&&p==this.value.length-h-1){t.c++;t.init=Math.max(0,t.init);v.preventDefault();y=this.value.length+t.c}else{if(u==k){t.init=Math.max(0,t.init);v.preventDefault()}else{if(h>0&&q==8&&p==this.value.length-h){v.preventDefault();t.c--;y=this.value.length+t.c}else{if(h>0&&q==8&&p>this.value.length-h){if(this.value===""){return}if(this.value.slice(p-1,p)!="0"){r=this.value.slice(0,p-1)+"0"+this.value.slice(p);w.val(r.replace(l,"").replace(j,k))}v.preventDefault();t.c--;y=this.value.length+t.c}else{if(q==8&&this.value.slice(p-1,p)==g){v.preventDefault();t.c--;y=this.value.length+t.c}else{if(h>0&&p==s&&this.value.length>h+1&&p>this.value.length-h-1&&isFinite(+u)&&!v.metaKey&&!v.ctrlKey&&!v.altKey&&u.length===1){if(s===this.value.length){r=this.value.slice(0,p-1)}else{r=this.value.slice(0,p)+this.value.slice(p+1)}this.value=r;y=p}}}}}}if(y!==false){d.apply(this,[y,y])}w.data("numFormat",t)},"keyup.format":function(t){var s=e(this),q=s.data("numFormat"),p=(t.keyCode?t.keyCode:t.which),u=b.apply(this,["start"]),r;if(this.value===""||(p<48||p>57)&&(p<96||p>105)&&p!==8){return}s.val(s.val());if(h>0){if(q.init<1){u=this.value.length-h-(q.init<0?1:0);q.c=u-this.value.length;q.init=1;s.data("numFormat",q)}else{if(u>this.value.length-h&&p!=8){q.c++;s.data("numFormat",q)}}}r=this.value.length+q.c;d.apply(this,[r,r])},"paste.format":function(r){var q=e(this),p=r.originalEvent,s=null;if(window.clipboardData&&window.clipboardData.getData){s=window.clipboardData.getData("Text")}else{if(p.clipboardData&&p.clipboardData.getData){s=p.clipboardData.getData("text/plain")}}q.val(s);r.preventDefault();return false}}).each(function(){var p=e(this).data("numFormat",{c:-(h+1),decimals:h,thousands_sep:g,dec_point:k,regex_dec_num:l,regex_dec:j,init:false});if(this.value===""){return}p.val(p.val())})}else{return this.each(function(){var q=e(this),p=+q.text().replace(l,"").replace(j,".");q.number(!isFinite(p)?0:+p,h,k,g)})}}return this.text(e.number.apply(window,arguments))};var f=null,c=null;if(e.valHooks.text){f=e.valHooks.text.get;c=e.valHooks.text.set}else{e.valHooks.text={}}e.valHooks.text.get=function(h){var k=e(h),g,j=k.data("numFormat");if(!j){if(e.isFunction(f)){return f(h)}else{return undefined}}else{if(h.value===""){return""}g=+(h.value.replace(j.regex_dec_num,"").replace(j.regex_dec,"."));return""+(isFinite(g)?g:0)}};e.valHooks.text.set=function(g,k){var j=e(g),h=j.data("numFormat");if(!h){if(e.isFunction(c)){return c(g,k)}else{return undefined}}else{return g.value=e.number(k,h.decimals,h.dec_point,h.thousands_sep)}};e.number=function(m,j,k,h){h=(typeof h==="undefined")?",":h;k=(typeof k==="undefined")?".":k;j=!isFinite(+j)?0:Math.abs(j);var p=("\\u"+("0000"+(k.charCodeAt(0).toString(16))).slice(-4));m=(m+"").replace(new RegExp(p,"g"),".").replace(new RegExp("[^0-9+-Ee.]","g"),"");var q=!isFinite(+m)?0:+m,l="",g=function(t,r){var s=Math.pow(10,r);return""+Math.round(t*s)/s};l=(j?g(q,j):""+Math.round(q)).split(".");if(l[0].length>3){l[0]=l[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,h)}if((l[1]||"").length<j){l[1]=l[1]||"";l[1]+=new Array(j-l[1].length+1).join("0")}return l.join(k)}})(jQuery);(function(a){a.fn.appendAt=function(d,b){var c=this.children();if(b<0){if(c.length>0){a(c[0]).before(d)}else{this.append(d)}}else{if(b<c.length){a(c[b]).before(d)}else{this.append(d)}}};a.fn.vMargin=function(){return parseInt(this.css("margin-top"))+parseInt(this.css("margin-bottom"))};a.fn.hMargin=function(){return parseInt(this.css("margin-left"))+parseInt(this.css("margin-right"))};a.fn.vPadding=function(){return parseInt(this.css("padding-top"))+parseInt(this.css("padding-bottom"))};a.fn.hPadding=function(){return parseInt(this.css("padding-left"))+parseInt(this.css("padding-right"))};a.fn.layoutWidth=function(){return this.outerWidth()+this.hMargin()};a.fn.layoutHeight=function(){return this.outerHeight()+this.vMargin()};a.browser.chrome=/chrom(e|ium)/.test(navigator.userAgent.toLowerCase())})(jQuery);(function(){Date.monthNames=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"];Date.dateNames=(function(){var a=_.range(1,31+1);_.each(a,function(c,b,d){d[b]=c+"日"});return a})();Date.dayNames=["周日","周一","周二","周三","周四","周五","周六"];Date.hourNames=(function(){var a=_.range(0,24);_.each(a,function(c,b,d){d[b]=c+"时"});return a})();Date.prototype.getMonsday=function(){var a=new Date();a.setTime(this.getTime());a.clearTime();a.setDate(a.getDate()-(a.getDay()===0?6:a.getDay()-1));return a}})();andrea.blink.declare("andrea.grace");(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.AppConst");var a=andrea.grace.constants.AppConst;a.MODEL_GRACE="MODEL_GRACE";a.MEDIATOR_DATA_DISCOVERY="MEDIATOR_DATA_DISCOVERY";a.MEDIATOR_ANALYSIS_SRC_DIM="MEDIATOR_ANALYSIS_SRC_DIM";a.MEDIATOR_ANALYSIS_SRC_MEA="MEDIATOR_ANALYSIS_SRC_MEA";a.MEDIATOR_ANALYSIS_DES_DIM="MEDIATOR_ANALYSIS_DES_DIM";a.MEDIATOR_ANALYSIS_DES_MEA="MEDIATOR_ANALYSIS_DES_MEA";a.MEDIATOR_ANALYSIS_RESULT="MEDIATOR_ANALYSIS_RESULT";a.MEDIATOR_VIZ_NAVIGATOR="MEDIATOR_VIZ_NAVIGATOR";a.ACTION_CHANGE_DATA_PROVIDER="ACTION_CHANGE_DATA_PROVIDER";a.ACTION_RUN_ANALYSIS="ACTION_RUN_ANALYSIS";a.NOTIFICATION_DATA_PROVIDER_CHANGED="NOTIFICATION_DATA_PROVIDER_CHANGED";a.NOTIFICATION_VIZ_CONTEXT_CHANGED="NOTIFICATION_VIZ_CONTEXT_CHANGED";a.NOTIFICATION_VIZ_CONTEXT_APPLIED="NOTIFICATION_VIZ_CONTEXT_APPLIED";a.VIEW_NOTIFICATION_PASTE_TO="VIEW_NOTIFICATION_PASTE_TO"})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.ShelfType");var a=b.constants.ShelfType;a.SRC_DIM="srcDim";a.SRC_MEA="srcMea";a.DES_DIM="desDimX";a.DES_VALUE="desMeaValueY";a.PROC_FILTER="procFilter";a.like=function(d,c){return d.substring(0,3)===c.substring(0,3)};a.src=function(c){return c&&c.substring(0,3)==="src"};a.des=function(c){return c&&c.substring(0,3)==="des"};a.proc=function(c){return c&&c.substring(0,4)==="proc"};a.dim=function(c){return c===a.SRC_DIM||c===a.DES_DIM}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.AnalysisType");var a=b.constants.AnalysisType;a.DIMENSION="dimension";a.MEASURE="measure"})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.constants.ValueType");var b=a.constants.ValueType;b.NULL="null";b.STRING="string";b.NUMBER="number";b.DATE="date";b.GEO="geo"})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.VizType");var a=b.constants.VizType;a.RECOMMEND="RECOMMEND";a.BAR="BAR";a.STACKED_BAR="STACKED_BAR";a.COLUMN="COLUMN";a.STACKED_COLUMN="STACKED_COLUMN";a.LINE="LINE";a.AREA="AREA";a.RADAR="RADAR";a.PIE="PIE";a.WATERFALL="WATERFALL";a.SCATTER="SCATTER";a.TABLE="TABLE";a.GEO="GEO";a.TREE_MAP="TREE_MAP";a._MANIFESTS=(function(){var d=function(h,j,f,e,g){return{type:h,title:j,required:{numDimensions:f,numMeasures:e},icon:g?b.Settings.dataDiscovery.folder+g:""}};var c={};c[a.RECOMMEND]=d(a.RECOMMEND,"推荐图形",0,0,"");c[a.COLUMN]=d(a.COLUMN,"柱状图",0,1,"./assets/navigator/column.png","");c[a.BAR]=d(a.BAR,"条状图",0,1,"./assets/navigator/bar.png","");c[a.RADAR]=d(a.RADAR,"雷达图",1,1,"./assets/navigator/radar.png","");c[a.SCATTER]=d(a.SCATTER,"散点图",1,1,"./assets/navigator/scatter.png","");c[a.LINE]=d(a.LINE,"折线图",1,1,"./assets/navigator/line.png","");c[a.AREA]=d(a.AREA,"面积图",1,1,"./assets/navigator/area.png","");c[a.PIE]=d(a.PIE,"饼图",1,1,"./assets/navigator/pie.png","");c[a.STACKED_COLUMN]=d(a.STACKED_COLUMN,"堆积柱状图",2,1,"./assets/navigator/stackedColumn.png","");c[a.STACKED_BAR]=d(a.STACKED_BAR,"堆积条状图",2,1,"./assets/navigator/stackedBar.png","");return c})();a.manifest=function(c){return a._MANIFESTS[c]};a.vertical=function(c){return c===a.BAR||c===a.STACKED_BAR};a.horizontal=function(c){return c===a.COLUMN||c===a.STACKED_COLUMN||c===a.LINE||c===a.AREA}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.constants.Taobao");var a=b.constants.Taobao={trade:{}};a.trade.status={TRADE_NO_CREATE_PAY:"未创建支付宝交易",WAIT_BUYER_PAY:"等待买家付款",SELLER_CONSIGNED_PART:"卖家部分发货",WAIT_SELLER_SEND_GOODS:"等待卖家发货",WAIT_BUYER_CONFIRM_GOODS:"等待买家确认收货",TRADE_BUYER_SIGNED:"买家已签收",TRADE_FINISHED:"交易成功",TRADE_CLOSED:"退款成功，交易关闭",TRADE_CLOSED_BY_TAOBAO:"未付款，交易关闭"};a.trade.type={fixed:"一口价",auction:"拍卖",guarantee_trade:"一口价、拍卖",auto_delivery:"自动发货",independent_simple_trade:"旺店入门版交易",independent_shop_trade:"旺店标准版交易",ec:"直冲",cod:"货到付款",fenxiao:"分销",game_equipment:"游戏装备",shopex_trade:"ShopEX交易",netcn_trade:"万网交易",external_trade:"统一外部交易",step:"万人团"};a.trade.shipping_type={free:"卖家包邮",post:"平邮",express:"快递",ems:"EMS",virtual:"虚拟发货","25":"次日必达","26":"预约配送"};a.trade.trade_from={WAP:"手机",HITAO:"嗨淘",TOP:"TOP平台",TAOBAO:"普通淘宝",JHS:"聚划算"};a.isKey=function(c,d){return a[c]!=null&&a[c][d]!=null};a.toCaption=function(d,f,g){if(a.isKey(f,g)){if(g==="trade_from"){var e=g.split(",");if(e.length>1){var c=[];_.each(e,function(h){c.push(a.toCaption(d,f,h))});return c.join("，")}}return a[f][g][d]}else{return d}}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.operation.OperationPriorityBaseline");var b=a.operation.OperationPriorityBaseline;b.DISPLAY_ONLY=0;b.DEFAULT_OPERATION=10000;b.USER_SPECIFICATION=20000})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.operation.OperationType");var a=b.operation.OperationType;a.CARD_REMOVE="CARD_REMOVE";a.CARD_ADD_TO_DIMENSION="CARD_ADD_TO_DIMENSION";a.CARD_ADD_TO_MEASURE="CARD_ADD_TO_MEASURE";a.CALC_COUNT="CALC_COUNT";a.CALC_UNIQ_COUNT="CALC_UNIQ_COUNT";a.CALC_SUM="CALC_SUM";a.CALC_AVG="CALC_AVG";a.CALC_MAX="CALC_MAX";a.CALC_MIN="CALC_MIN";a.SORT_NONE="SORT_NONE";a.SORT_ASCEND="SORT_ASCEND";a.SORT_DESCEND="SORT_DESCEND";a.SORT_ALPHABET_ASCEND="SORT_ALPHABET_ASCEND";a.SORT_ALPHABET_DESCEND="SORT_ALPHABET_DESCEND";a.DRILL_YEAR="DRILL_YEAR";a.DRILL_MONTH="DRILL_MONTH";a.DRILL_WEEK="DRILL_WEEK";a.DRILL_DATE="DRILL_DATE";a.GROUP_MONTH="GROUP_MONTH";a.GROUP_DATE="GROUP_DATE";a.GROUP_DAY="GROUP_DAY";a.GROUP_HOUR="GROUP_HOUR"})(jQuery);(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.operation.OperationClassification");var b=a.operation.OperationClassification;b.CARD_OPERATION="cardOperation";b.CALCULATE="calculate";b.SORT="sort";b.DRILL="drill";b.GROUP="group";b.exclusive=function(d,c){if(d===c){return true}else{if((d===b.DRILL||d===b.GROUP)&&(c===b.DRILL||c===b.GROUP)){return true}else{return false}}}})();(function(d){var c=andrea.grace;var e=c.operation.OperationClassification;var b=c.operation.OperationType;andrea.blink.declare("andrea.grace.operation.Operation");var a=c.operation.Operation=function(g,f){this.id=_.uniqueId("operationID_");this.type=g;this.priority=f;this.name=a._TYPE_TO_NAME[this.type];this.abbreviation=a._TYPE_TO_ABBREVIATION[this.type];this.classification=a._TYPE_TO_CLASSIFICATION[this.type];this.classificationName=a._CLASSIFICATION_TO_NAME[this.classification]};a._TYPE_TO_NAME={};a._TYPE_TO_ABBREVIATION={};a._TYPE_TO_CLASSIFICATION={};a._CLASSIFICATION_TO_TYPES={};a._CLASSIFICATION_TO_NAME={};a._loadClass=function(){var j=function(n,m,l,p){a._TYPE_TO_CLASSIFICATION[m]=n;a._TYPE_TO_NAME[m]=l;a._TYPE_TO_ABBREVIATION[m]=p;if(!a._CLASSIFICATION_TO_TYPES[n]){a._CLASSIFICATION_TO_TYPES[n]=[]}a._CLASSIFICATION_TO_TYPES[n].push(m)};var h=function(m,l){a._CLASSIFICATION_TO_NAME[m]=l};h(e.CARD_OPERATION,"删除");h(e.CALCULATE,"计算");h(e.SORT,"排序");h(e.DRILL,"每");h(e.GROUP,"按...分组");j(e.CARD_OPERATION,b.CARD_ADD_TO_DIMENSION,"\uf067 分析纬度","");j(e.CARD_OPERATION,b.CARD_ADD_TO_MEASURE,"\uf067 分析指标","");j(e.CARD_OPERATION,b.CARD_REMOVE,"\uf00d 移除","");j(e.CALCULATE,b.CALC_COUNT,"总数","总");j(e.CALCULATE,b.CALC_UNIQ_COUNT,"计数（唯一）","数");j(e.CALCULATE,b.CALC_SUM,"∑ 总和","∑");j(e.CALCULATE,b.CALC_AVG,"平均值","均");j(e.CALCULATE,b.CALC_MAX,"最大值","Max");j(e.CALCULATE,b.CALC_MIN,"最小值","Min");j(e.SORT,b.SORT_NONE,"不排序","");j(e.SORT,b.SORT_ASCEND,"\uf160 升序","\uf160");j(e.SORT,b.SORT_DESCEND,"\uf161 降序","\uf161");j(e.SORT,b.SORT_ALPHABET_ASCEND,"\uf15d 升序","\uf15d");j(e.SORT,b.SORT_ALPHABET_DESCEND,"\uf15e 降序","\uf15e");var g=new Date();j(e.DRILL,b.DRILL_YEAR,"每年 ("+g.format("yyyy")+")","每年");j(e.DRILL,b.DRILL_MONTH,"每月 ("+g.format("yyyy/M")+")","每月");var k=g.getMonsday();var f=new Date();f.setTime(k.getTime()+7*24*3600*1000);j(e.DRILL,b.DRILL_WEEK,"每周 ("+k.format("yyyy/M/d")+" - "+f.format("M/d")+")","每周");j(e.DRILL,b.DRILL_DATE,"每日 ("+g.format("yyyy/M/d")+")","每日");j(e.GROUP,b.GROUP_MONTH,"月 (1 - 12)","月");j(e.GROUP,b.GROUP_DATE,"日 (1 - 31)","日");j(e.GROUP,b.GROUP_DAY,"星期 (1 - 7)","星");j(e.GROUP,b.GROUP_HOUR,"时 (0 - 23)","时")};a._loadClass();a.getTypes=function(f){return a._CLASSIFICATION_TO_TYPES[f]}})(jQuery);(function(d){var b=andrea.grace;var a=b.operation.Operation;var e=b.operation.OperationPriorityBaseline;andrea.blink.declare("andrea.grace.operation.OperationFactory");var c=b.operation.OperationFactory;if(!c._count){c._count=0}if(!c._mapping){c._mapping={}}c.produce=function(f,g){var h=new a(f,g+c._count);c._count++;c._mapping[h.id]=h;return h};c.get=function(f){return c._mapping[f]}})(jQuery);(function(e){var c=andrea.grace;var b=c.operation.OperationType;var a=c.operation.Operation;var d=c.operation.OperationFactory;var g=c.operation.OperationClassification;var h=c.operation.OperationPriorityBaseline;andrea.blink.declare("andrea.grace.operation.OperationGroup");var f=c.operation.OperationGroup=function(j){this._operations=null;this._typeToOperation=null;this._initialize(j)};f.createByTypes=function(k,m){if(m){m=h.DISPLAY_ONLY}var l=[];for(var j=0;j<k.length;j++){var n=d.produce(k[j]);l.push(n.id)}return new f(l)};f.createByClassification=function(k,l){var j=a.getTypes(k);if(l){l.splice(0,0,j);j=_.without.apply(null,l)}return f.createByTypes(j)};f.prototype._initialize=function(k){this._operations=[];this._typeToOperation={};if(!k){return}var j;for(j=0;j<k.length;j++){var m=k[j];var l=d.get(m);this._operations.push(l);this._typeToOperation[l.type]=l}};f.prototype.operations=function(){return this._operations};f.prototype.mapIDs=function(){return _.map(this._operations,function(j){return j.id})};f.prototype.mapNames=function(){return _.map(this._operations,function(j){return j.name})};f.prototype.mapAbbrs=function(){return _.map(this._operations,function(j){return j.abbreviation})};f.prototype.get=function(j){return this._typeToOperation[j]};f.prototype.ascend=function(){return this.get(b.SORT_ASCEND)||this.get(b.SORT_ALPHABET_ASCEND)};f.prototype.descend=function(){return this.get(b.SORT_DESCEND)||this.get(b.SORT_ALPHABET_DESCEND)};f.prototype.has=function(j){return this._typeToOperation[j]!==undefined};f.prototype.hasClassification=function(j){return _.map(this._operations,function(k){return k.classification}).indexOf(j)!=-1};f.prototype.calculator=function(){if(this.has(b.CALC_COUNT)){return new c.calculator.Count()}else{if(this.has(b.CALC_UNIQ_COUNT)){return new c.calculator.UniqCount()}else{if(this.has(b.CALC_SUM)){return new c.calculator.Sum()}else{if(this.has(b.CALC_AVG)){return new c.calculator.Avg()}else{if(this.has(b.CALC_MAX)){return new c.calculator.Max()}else{if(this.has(b.CALC_MIN)){return new c.calculator.Min()}}}}}}return null};f.prototype.addOperation=function(k){var j=d.get(k);this._operations=_.filter(this._operations,function(l){return !g.exclusive(l.classification,j.classification)});this._operations.push(j)};f.prototype.removeOperation=function(k){var j=d.get(k);this._operations=_.without(this._operations,j);delete this._typeToOperation[j.type]}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.models.value.ValueBase");var a=b.models.value.ValueBase=function(c,d){this._raw=c;this._value=d;this._quantified=null;this._caption=null};a.prototype.raw=function(){return this._raw};a.prototype.value=function(){return this._value};a.prototype.notNull=function(){return true};a.prototype.quantified=function(){throw new Error("StringValue does not quantifiable.")};a.prototype.caption=function(){};a.prototype.toString=function(){return this._value.toString()}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.models.value.BooleanValue");var b=a.models.value.BooleanValue=function(c,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.grace.models.value.ValueBase);b._falseInstance=new b(false,false);b._trueInstance=new b(true,true);b.falseInstance=function(){return b._falseInstance};b.trueInstance=function(){return b._trueInstance};b.prototype.caption=function(){if(this._value){return"是"}else{return"否"}}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.models.value.DateValue");var a=b.models.value.DateValue=function(c,d){a.superclass.constructor.apply(this,arguments);this._captionsByFormat={};a._instances[c]=this};andrea.blink.extend(a,andrea.grace.models.value.ValueBase);a.parseQuantified=function(c){var e=new Date();e.setTime(c);return new a(c.toString(),e)};a._instances={};a.instance=function(c){return a._instances[c]};a.prototype.quantified=function(){if(this._quantified===null){this._quantified=this._value.getTime()}return this._quantified};a.CAPTION_DRILL_YEAR="CAPTION_DRILL_YEAR";a.CAPTION_DRILL_MONTH="CAPTION_DRILL_MONTH";a.CAPTION_DRILL_WEEK="CAPTION_DRILL_WEEK";a.CAPTION_DRILL_DATE="CAPTION_DRILL_DATE";a.CAPTION_GROUP_MONTH="CAPTION_GROUP_MONTH";a.CAPTION_GROUP_DATE="CAPTION_GROUP_DATE";a.CAPTION_GROUP_DAY="CAPTION_GROUP_DAY";a.CAPTION_GROUP_HOUR="CAPTION_GROUP_HOUR";a.prototype.caption=function(d){if(!d){d=a.CAPTION_DRILL_DATE}var c;if(!this._captionsByFormat[d]){if(d===a.CAPTION_DRILL_YEAR){c=this._value.format("yyyy")}else{if(d===a.CAPTION_DRILL_MONTH){c=this._value.format("yyyy/M")}else{if(d===a.CAPTION_DRILL_DATE){c=this._value.format("yyyy/M/d")}else{if(d===a.CAPTION_DRILL_WEEK){var f=this._value.getMonsday();var e=new Date();e.setTime(f.getTime()+7*24*3600*1000);c=f.format("yyyy/M/d")+"-"+e.format("M/d")}else{if(d===a.CAPTION_GROUP_MONTH){c=Date.monthNames[this._value.getMonth()]}else{if(d===a.CAPTION_GROUP_DATE){c=Date.dateNames[this._value.getDate()-1]}else{if(d===a.CAPTION_GROUP_DAY){c=Date.dayNames[this._value.getDay()]}else{if(d===a.CAPTION_GROUP_HOUR){c=Date.hourNames[this._value.getHours()]}}}}}}}}this._captionsByFormat[d]=c}return this._captionsByFormat[d]}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.models.value.NullValue");var a=b.models.value.NullValue=function(c,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.grace.models.value.ValueBase);a._instance=new a();a.instance=function(){return a._instance};a.prototype.notNull=function(){return false};a.prototype.quantified=function(){return 0};a.prototype.caption=function(){return"{空值}"};a.prototype.toString=function(){return""}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.models.value.NumberValue");var a=b.models.value.NumberValue=function(c,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.grace.models.value.ValueBase);a.parseQuantified=function(c){return new a(c.toString(),c)};a.prototype.quantified=function(){return this._value};a.prototype.caption=function(){if(this._caption===null){var c=this._value;if(c!=parseInt(c)){this._caption=$.number(c,2)}else{this._caption=$.number(c,0)}}return this._caption}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.models.value.StringValue");var a=b.models.value.StringValue=function(c,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.grace.models.value.ValueBase);a.prototype.caption=function(){return this._value}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.utils.URLUtil");var c=a.utils.URLUtil;var b=null;c.hashPairs=function(){if(b===null){b={};var g=window.location.hash.slice(1);var f=g.split("&");for(var e in f){var h=f[e].split("=");if(h.length==2){var d=h[0];if(d){b[d]=decodeURIComponent(h[1])}}}g=window.location.search.slice(1);f=g.split("&");for(var e in f){var h=f[e].split("=");if(h.length==2){var d=h[0];if(d&&(b[d]==null||b[d]==="")){b[d]=decodeURIComponent(h[1])}}}}return b}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.utils.FilterUtil");var b=a.utils.FilterUtil;b.filter=function(e,g){if(!g||g.length===0){return e}var f=[];for(i=0;i<e.numRows;i++){var c=e.getRValues(i);var d=true;_.each(g,function(h){d=d&&h.filter.filter(c[h.source.index])});if(!d){continue}f.push(c)}return new a.models.DataProvider(f)}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.utils.ConverterType");var a=b.utils.ConverterType;a.ANY="any";a.BOOLEAN="boolean";a.STRING="string";a.NUMBER="number";a.EXCEL_DATE="excelDate";a.DATE="date";a._dateFormats=(function(){var c=[];c.push("yyyy/MM/dd");c.push("yyyy/M/d");c.push("yy/MM/dd");c.push("yy/M/d");c.push("MM/dd/yyyy");c.push("M/d/yyyy");c.push("MM/dd/yy");c.push("M/d/yy");c.reverse();return c})();a.getDateFormats=function(){return a._dateFormats};a._monthFormats=(function(){var c=[];c.push("yyyy/M");c.push("yy/M");c.reverse();return c})();a.getMonthFormats=function(){return a._monthFormats}})();(function(){var g=andrea.grace;var f=g.utils.ConverterType;var c=g.models.value.DateValue;var e=g.models.value.NullValue;var h=g.models.value.BooleanValue;var a=g.models.value.NumberValue;var b=g.models.value.StringValue;andrea.blink.declare("andrea.grace.utils.DataConvertUtil");var d=g.utils.DataConvertUtil;d.match=function(j,m){var l=null;var k=null;if(j){l=d._convertNumber(j);if(l.notNull()){if(m&&(l.value()>=32874&&l.value()<=47848)){l=d._convertExcelDate(j);k=f.EXCEL_DATE}else{k=f.NUMBER}}if(!l.notNull()){l=d._convertDate(j);k=f.DATE}if(!l.notNull()){l=d._convertBoolean(j);k=f.BOOLEAN}if(!l.notNull()){l=d._convertString(j);k=f.STRING}}else{k=f.ANY;l=e.instance()}return{type:k,value:l}};d.getConverter=function(k,j){if(k===f.BOOLEAN){return d._convertBoolean}else{if(k===f.NUMBER){return d._convertNumber}else{if(k===f.DATE){return d._convertDate}else{if(k===f.EXCEL_DATE){return d._convertExcelDate}else{if(k===f.STRING){return d._convertString}else{return null}}}}}};d._convertString=function(j){if(j!=null){return new b(j,_.str.trim(j.toString()))}else{return e.instance()}};d._convertBoolean=function(j){if(j===false){return new h.falseInstance()}else{if(j===true){return new h.trueInstance()}else{return e.instance()}}};d._convertNumber=function(j){if(j!=null){var k=_.str.trim(j.toString());if(!isNaN(k)){return new a(j,Number(k))}else{if(k.length>1&&k.substr(k.length-1,1)==="%"){k=k.substr(0,k.length-1);if(!isNaN(k)){return new a(j,Number(k))}}}}else{return e.instance()}return e.instance()};d._convertDate=function(q){if(!q){return e.instance()}var t=_.str.trim(q.toString());if(t.length<6||isNaN(t.substr(0,1))||isNaN(t.substr(t.length-1,1))){return e.instance()}t=t.replace(/[年月日_-]/g,"/");if(t.indexOf("/")===-1){return e.instance()}var j=c.instance(q);if(j){return j}var r;if(t.indexOf(" ")!==-1){if(t.indexOf(":")===-1){return e.instance()}else{if(t.indexOf(":")===t.lastIndexOf(":")){r="H:m"}else{r="H:m:s"}}}var k=null;if(d._preferDateTest){k=Date.parseString(t,d._preferDateTest)}var p;var l=t.split("/");if(l.length===3){p=f.getDateFormats()}else{if(l.length===2){p=f.getMonthFormats()}}for(var m=p.length-1;m>=0&&!k;m--){var n=p[m];if(r){n=n+" "+r}k=Date.parseString(t,n);if(k){d._preferDateTest=n;break}}if(k){return new c(q,k)}else{return e.instance()}};d._preferDateTest=null;d._convertExcelDate=function(l){if(!l){return e.instance()}var m=_.str.trim(l.toString());if(isNaN(m)){return e.instance()}var j=c.instance(l);if(j){return j}excelTime=parseFloat(m);if(excelTime>d._WRONG_DATE_IN_EXCEL_FORMAT){excelTime=excelTime-1}var p=d._EXCEL_BASE_TIME-d._DAY_IN_MILLISECONDS;var n=p+excelTime*d._DAY_IN_MILLISECONDS;var k=new Date();k.setTime(n+d._getTimezoneOffsetMS());return new c(l,k)};d._EXCEL_BASE_TIME=-2208988800000;d._WRONG_DATE_IN_EXCEL_FORMAT=60;d._DAY_IN_MILLISECONDS=86400000;d._TIMEZONE_OFFSET_MS=0;d._createAndReadTimezoneOffset=function(){d._TIMEZONE_OFFSET_MS=new Date().getTimezoneOffset()*60*1000;d._getTimezoneOffsetMS=d._readTimezoneOffset;return d._readTimezoneOffset()};d._readTimezoneOffset=function(){return d._TIMEZONE_OFFSET_MS};d._getTimezoneOffsetMS=d._createAndReadTimezoneOffset})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.utils.ColorUtil");var b=a.utils.ColorUtil;b.hexToRgb=function(e){var d=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(d,function(h,k,j,f){return k+k+j+j+f+f});var c=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return c?{r:parseInt(c[1],16),g:parseInt(c[2],16),b:parseInt(c[3],16)}:null};b.rgbToHex=function(e,d,c){return"#"+b._componentToHex(e)+b._componentToHex(d)+b._componentToHex(c)};b._componentToHex=function(e){var d=e.toString(16);return d.length==1?"0"+d:d}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.utils.Stopwatch");var a=b.utils.Stopwatch=function(d,c){this._s=null;this._e=null;this._laps=null;this.type=d;if(c===true){this.start()}};a.prototype.start=function(){this._s=new Date().getTime();this._laps=[]};a.prototype.lap=function(d){var c=this._laps;c.push(new Date().getTime());if(d===true){this._e=c[c.length-1]}if(c.length>1){return c[c.length-1]-c[c.length-2]}else{return c[0]-this._s}};a.prototype.total=function(){return this._e-this._s}})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.managers.Log");var a=b.managers.Log;a.INTERACTION="interaction";a.PERFORMANCE="performance";a.LINE_SPLITTER="%LINE_SPLITTER%";a._start=new Date().getTime();a._uid=a._start+"_"+_.random(0,10000);a.user=null;a.console=function(){console.log(arguments)};a.interaction=function(d,e){a._log("info",a.INTERACTION,[d,e].join(","))};a.performance=function(d,e){a._log("info",a.PERFORMANCE,[d,e].join(","))};c(window).on("beforeunload",function(){a.interaction("close",(new Date().getTime()-a._start)/1000);a._releaseCache()});a._logCache=null;a._log=function(h,e,d){var f=[];f.push("grace_"+b.Settings.version);f.push("log_"+b.Settings.log.version);f.push(a.user);f.push(a._uid);f.push(a._time());var g=[f.join(","),e,d].join(",");if(b.Settings.log.console&&console){console.log(h,g)}if(!a._logCache){a._logCache={};_.delay(a._releaseCache,10*1000)}if(!a._logCache[h]){a._logCache[h]=[]}a._logCache[h].push(g)};a._releaseCache=function(){if(!a._logCache){return}for(var e in a._logCache){var d=a._logCache[e].join(a.LINE_SPLITTER);c.ajax({dataType:"json",url:b.Settings.log.url,data:{level:e,msg:d},type:"POST"})}a._logCache=null};a._time=function(){var f=new Date();var e=f.getTime().toString();return f.format("yyyy/MM/dd HH:mm:ss")+","+e.substr(e.length-3)}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.helpers.PageTransition");var a=b.helpers.PageTransition=function(e,d,c){this._$outPage=e["$page"];this._outClasses=e.classes.join(" ");this._outDelay=e.delay;this._$inPage=d["$page"];this._inClasses=d.classes.join(" ");this._inDelay=d.delay;this._endCallback=c;this._inEnded=false;this._outEnded=false};a.prototype.$outPage=function(){return this._$outPage};a.prototype.$inPage=function(){return this._$inPage};a.prototype.play=function(){if(this._outClasses){var d=$.proxy(function(){this._$outPage.addClass(this._outClasses).on("webkitAnimationEnd",$.proxy(function(){this._$outPage.off("webkitAnimationEnd");this._inEnded=true;this._animationEndHandler()},this))},this);if(this._outDelay){_.delay(d,this._outDelay)}else{d()}}else{this._inEnded=true;this._animationEndHandler()}if(this._inClasses){var c=$.proxy(function(){this._$inPage.show(0);this._$inPage.addClass(this._inClasses).on("webkitAnimationEnd",$.proxy(function(){this._$inPage.off("webkitAnimationEnd");this._outEnded=true;this._animationEndHandler()},this))},this);if(this._inDelay){this._$inPage.hide(0);_.delay(c,this._inDelay)}else{c()}}else{this._outEnded=true;this._animationEndHandler()}};a.prototype._animationEndHandler=function(){if(!this._inEnded||!this._outEnded){return}this._$outPage.removeClass(this._outClasses);this._$inPage.removeClass(this._inClasses);this._inEnded=false;this._outEnded=false;if(this._endCallback){this._endCallback.call(this)}}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.supportClasses.ICalculator");var a=b.calculator.supportClasses.ICalculator=function(){};a.prototype.addFactor=function(c){};a.prototype.calculate=function(){return 0}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Sum");var a=b.calculator.Sum=function(){this._sum=0};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){c=parseFloat(c);if(!isNaN(c)){this._sum=parseFloat((this._sum+c).toFixed(4))}};a.prototype.calculate=function(){return this._sum}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Max");var b=a.calculator.Max=function(){this._max=0};andrea.blink.extend(b,a.calculator.supportClasses.ICalculator);b.prototype.addFactor=function(c){if(!isNaN(c)){this._max=Math.max(this._max,c)}};b.prototype.calculate=function(){return this._max}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Min");var a=b.calculator.Min=function(){this._max=Number.MAX_VALUE};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){if(!isNaN(c)){this._max=Math.min(this._max,c)}};a.prototype.calculate=function(){return this._max}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Avg");var a=b.calculator.Avg=function(){this._sumAlternate=0;this._count=0};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){if(!isNaN(c)){this._sumAlternate+=Math.round(c*1000000)}this._count++};a.prototype.calculate=function(){if(this._count===0){return 0}else{return Math.round(this._sumAlternate/this._count)/1000000}}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.calculator.Count");var a=b.calculator.Count=function(){this._count=0};andrea.blink.extend(a,b.calculator.supportClasses.ICalculator);a.prototype.addFactor=function(c){this._count++};a.prototype.calculate=function(){return this._count}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.calculator.UniqCount");var b=a.calculator.UniqCount=function(){this._count=0;this._mapping={}};andrea.blink.extend(b,a.calculator.supportClasses.ICalculator);b.prototype.addFactor=function(c){if(!this._mapping[c]){this._mapping[c]=true;this._count++}};b.prototype.calculate=function(){return this._count}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.filter.IFilter");var a=b.filter.IFilter=function(){};a.prototype.filter=function(c){return false}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.filter.TextFilter");var b=a.filter.TextFilter=function(c,e){var d=this._options={};_.each(c,function(f){d[f.caption()]=true});this.nullable=e};andrea.blink.extend(b,a.filter.IFilter);b.prototype.filter=function(c){return this._options[c.caption()]};b.prototype.addOption=function(c){this._options[c.caption()]=true};b.prototype.removeOption=function(c){this._options[c.caption()]=false}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.filter.RangeFilter");var b=a.filter.RangeFilter=function(c,e,d){this._from=Number.MAX_VALUE;this._to=-Number.MAX_VALUE;_.each(c,$.proxy(function(g){var f=g.quantified();this._from=Math.min(this._from,f);this._to=Math.max(this._to,f)},this));this._min=this._from;this._max=this._to;this.nullable=e;this._parseQuantified=d};andrea.blink.extend(b,a.filter.IFilter);b.prototype.filter=function(d){var c=d.quantified();return this._max>=c&&this._min<=c};b.prototype.from=function(c){return this._from};b.prototype.to=function(c){return this._to};b.prototype.min=function(c){if(arguments.length>0){this._min=c;return this}else{return this._min}};b.prototype.max=function(c){if(arguments.length>0){this._max=c;return this}else{return this._max}};b.prototype.parseQuantified=function(c){return this._parseQuantified.call(null,c)}})();(function(b){var a=andrea.grace;andrea.blink.declare("andrea.grace.managers.PopUpManager");var c=a.managers.PopUpManager;c.createPopUp=function(f,g){var h=b("body");var j=b(document);var e=b("<div/>").addClass("grace-popup-layer").appendTo(h);if(g){e.width(j.width());e.height(j.height())}var d=b(f.dom());d.appendTo(e);return f};c.removePopUp=function(e){var d=b(e.dom());d.parent().detach()};c.centerPopUp=function(e){var d=b(e.dom());var f=b("body");var g=f.children().eq(0);d.css({left:(g.width()-d.width())/2+"px",top:(g.height()-d.height())/2-36+"px"})}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.models.vo.Analysis");var b=d.constants.ShelfType;var c=d.utils.DataConvertUtil;var e=d.constants.ValueType;var a=d.models.vo.Analysis=function(f){this.id=f?f:_.uniqueId("analysisID_");this.index=null;this.name=null;this._valueType=null;this.quantifiable=false;this.analysisType=null;this.numUniqueValue=null;this.dateSpan=null};a.prototype.valueType=function(f){if(arguments.length>0){this._valueType=f;this.quantifiable=this._valueType===e.NUMBER||this._valueType===e.DATE;return this}else{return this._valueType}}})();(function(){var c=andrea.grace;var e=c.constants.ValueType;var a=c.constants.AnalysisType;var d=c.operation.OperationClassification;andrea.blink.declare("andrea.grace.models.vo.ShelvedAnalysis");var b=c.models.vo.ShelvedAnalysis=function(g,f){this.id=g;this.source=f;this.operationGroup=null;this.visualized=false;this.numPartialVisualized=0;this.filter=null};b.prototype.isDateSeries=function(){return this.source.valueType()===e.DATE&&this.operationGroup.hasClassification(d.DRILL)};b.prototype.multiply=function(g){var f={};if(g&&g.source&&g.source.numUniqueValue){f.numUniqueValue=this.source.numUniqueValue*g.source.numUniqueValue}else{f.numUniqueValue=this.source.numUniqueValue}return f}})();(function(d){var c=andrea.grace;var b=c.models.value.NullValue;andrea.blink.declare("andrea.grace.models.DataProvider");var a=c.models.DataProvider=function(e){this._values2d=e;this.numRows=0;this.numColumns=0;this._columnBased=null;this._build()};andrea.blink.extend(a,andrea.blink.mvc.Model);a.prototype._build=function(){var k,h;var g;var e=[];this._columnBased={values2d:[],uniqueValues2d:[],notNullValue2d:[],notNullUniqueValues2d:[],hasNull2d:[]};this.numRows=this._values2d.length;this.numColumns=this.numRows>0?this._values2d[0].length:0;for(h=0;h<this.numColumns;h++){this._columnBased.values2d[h]=[];this._columnBased.uniqueValues2d[h]=[];this._columnBased.notNullValue2d[h]=[];this._columnBased.notNullUniqueValues2d[h]=[];this._columnBased.hasNull2d[h]=false;e[h]=[]}for(k=0;k<this.numRows;k++){g=this.getRValues(k);for(h=0;h<this.numColumns;h++){var f=g[h];var l=f.toString();this._columnBased.hasNull2d[h]=this._columnBased.hasNull2d[h]||!f.notNull();this._columnBased.values2d[h].push(f);if(f.notNull()){this._columnBased.notNullValue2d[h].push(f)}if(!e[h][l]){e[h][l]=true;if(f.notNull()){this._columnBased.uniqueValues2d[h].push(f);this._columnBased.notNullUniqueValues2d[h].push(f)}}}}for(h=0;h<this.numColumns;h++){if(this._columnBased.hasNull2d[h]){this._columnBased.uniqueValues2d[h].push(b.instance())}}};a.prototype.getRValues=function(e){return this._values2d[e]};a.prototype.getCValues=function(e,g,f){if(g&&f){return this._columnBased.notNullUniqueValues2d[e]}else{if(!g&&f){return this._columnBased.notNullValue2d[e]}else{if(g&&!f){return this._columnBased.uniqueValues2d[e]}else{if(!g&&!f){return this._columnBased.values2d[e]}}}}};a.prototype.isCHasNull=function(e){return this._columnBased.hasNull2d[e]}})(jQuery);(function(f){var e=andrea.grace;andrea.blink.declare("andrea.grace.models.DataDiscoveryModel");var d=e.constants.ShelfType;var a=andrea.grace.constants.AppConst;var c=e.constants.VizType;var b=e.models.DataDiscoveryModel=function(){b.superclass.constructor.apply(this,arguments);b._instance=this;this.raw=null;this.analyses=null;this.dataProvider=null;this._analysisFilters=[];this._analysisDimesions=[];this._analysisDatas=[];this._vizType=c.RECOMMEND};andrea.blink.extend(b,andrea.blink.mvc.Model);b._instance=null;b.instance=function(){return b._instance};b.prototype.viewNotify=function(g,h){this._notify(g,h)};b.prototype.setDataProvider=function(h,g,j){this.raw=h;this.analyses=g;this.dataProvider=j;this._vizType=c.RECOMMEND;this._analysisFilters=[];this._analysisDimesions=[];this._analysisDatas=[];this._notify(a.NOTIFICATION_DATA_PROVIDER_CHANGED)};b.prototype.vizType=function(g){if(arguments.length>0){if(this._vizType!==g){this._vizType=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}}else{return this._vizType}};b.prototype.analysisFilters=function(g){if(arguments.length>0){this._analysisFilters=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}else{return this._analysisFilters}};b.prototype.analysisDimesions=function(g){if(arguments.length>0){this._analysisDimesions=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}else{return this._analysisDimesions}};b.prototype.analysisDatas=function(g){if(arguments.length>0){this._analysisDatas=g;this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_CHANGED)}else{return this._analysisDatas}};b.prototype.invalidateShelvedAnalysis=function(){this._deferNotify(a.NOTIFICATION_VIZ_CONTEXT_APPLIED)};b.prototype.getAnalyses=function(j){var g=[];for(var h=0;h<j.length;h++){g.push(this.getAnalysis(j[h]))}return g};b.prototype.getAnalysis=function(g){return this._get(g,this.analyses)};b.prototype.getShelvedAnalysis=function(h){var g=this._get(h,this._analysisFilters);if(!g){g=this._get(h,this._analysisDimesions)}if(!g){g=this._get(h,this._analysisDatas)}return g};b.prototype._get=function(j,g){for(var h=0;h<g.length;h++){if(g[h].id===j){return g[h]}}return null}})(jQuery);(function(){var l=andrea.grace;andrea.blink.declare("andrea.grace.actions.ChangeDataProviderAction");var m=l.utils.ConverterType;var j=l.constants.ValueType;var b=l.models.value.NullValue;var e=andrea.grace.constants.AnalysisType;var k=andrea.grace.constants.AppConst;var d=l.models.vo.Analysis;var a=l.models.DataProvider;var h=l.utils.DataConvertUtil;var c=l.utils.Stopwatch;var f=l.managers.Log;var g=l.actions.ChangeDataProviderAction=function(){g.superclass.constructor.apply(this,arguments)};andrea.blink.extend(g,andrea.blink.mvc.Action);g.prototype.execute=function(O){g.superclass.execute.apply(this,arguments);var Q={columnDescriptors:O.columnDescriptors,rows:O.rows,source:O.source};var P,N;var H=Q.source==="excel";var v=Q.columnDescriptors;var R=Q.rows;var F=R.length;var y=v.length;f.interaction("parseColumnRows",[y,F].join(","));if(F===0){return}var x=new c([y,F].join(","),true);var A=[];for(N=0;N<y;N++){var S=v[N];var U=new d(S.id);U.index=N;U.name=S.name;U.analysisType=S.analysisType;A[N]=U}var V=[];var T=null;var J=null;var D=[];var E;for(P=F-1;P>=0;P--){V[P]=[];var u=R[P];for(N=y-1;N>=0;N--){var C=u[N];E=D[N];if(!E){D[N]=E={numByType:{}};E.numByType[m.ANY]=0}var X=v[N].converterType;if(X){if(C!=null){if(!E.fn){E.fn=h.getConverter(X)}J=E.fn.call(null,C)}else{J=b.instance();X=m.ANY}}else{var K=H;if(E.numByType&&E.numByType[m.NUMBER]&&E.numByType[m.NUMBER]>3){K=false}var q=h.match(C,K);X=q.type;J=q.value}if(!E.numByType[X]){E.numByType[X]=0}E.numByType[X]++;V[P][N]=J}}f.performance("parseDataProvider",[x.type,"parse",x.lap()].join(","));for(N=0;N<y;N++){U=A[N];if(!U.name){U.name="列"+(N+1)}if(!U.valueType()){var w=false;var I=false;var s=null;E=D[N];if(E.numByType){for(X in E.numByType){var n=E.numByType[X];var G=E.numByType[m.ANY];if(n/F===1){w=true}if(X===m.ANY){continue}if(n/(F-G)>0.5){if(X===m.EXCEL_DATE||X===m.DATE){U.valueType(j.DATE)}else{if(X===m.NUMBER){U.valueType(j.NUMBER)}else{if(X===m.STRING){U.valueType(j.STRING)}}}if(!w){s=X;if((n+G)/F===1){I=true}}break}}}if(!U.valueType()){U.valueType(j.STRING)}if(!w&&s){var B=h.getConverter(s);for(P=F-1;P>=0;P--){C=R[P][N];if(!C||!I){V[P][N]=B.call(null,C)}}}else{}}if(!U.analysisType){if(U.valueType()===j.NUMBER){U.analysisType=e.MEASURE}else{U.analysisType=e.DIMENSION}}}f.performance("parseDataProvider",[x.type,"rinse",x.lap()].join(","));var r=new a(V);var M=[];var z=[];for(N=0;N<y;N++){U=A[N];U.numUniqueValue=r.getCValues(N,true,false).length;if(U.valueType()===j.DATE){var L=_.sortBy(r.getCValues(N,true,true),function(Y){return Y.quantified()});var t=L[0];var W=L[L.length-1];U.dateSpan=W.quantified()-t.quantified()}if(U.analysisType===e.MEASURE){z.push(U.name)}else{if(U.analysisType===e.DIMENSION){M.push(U.name)}}}var p=this._getModel(k.MODEL_GRACE);p.setDataProvider(Q,A,r);f.performance("parseDataProvider",[x.type,"setDataProvider",x.lap(true),x.total()].join(","));f.interaction("parsedDimensions",[M].join(","));f.interaction("parsedMeasures",[z].join(","))}})();(function(){var e=andrea.grace;andrea.blink.declare("andrea.grace.actions.RunAnalysisAction");var b=andrea.grace.constants.AppConst;var c=e.constants.ShelfType;var d=e.models.vo.ShelvedAnalysis;var a=e.actions.RunAnalysisAction=function(){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.mvc.Action);a.prototype.execute=function(l){a.superclass.execute.apply(this,arguments);var j;var m=c;var g=this._getModel(b.MODEL_GRACE);if(l.shelfType){var h=l.shelfType;var f=l.shelvedContexts;if(!f){return}var k=[];_.each(f,function(p){var n=g.getShelvedAnalysis(p.shelvedAnalysisID);if(!n){n=new d(p.shelvedAnalysisID,g.getAnalysis(p.analysisID))}n.operationGroup=p.operationGroup;n.filter=p.filter;k.push(n)});if(h===m.DES_DIM){if(!_.isEqual(k,g.analysisDimesions())){g.analysisDimesions(k)}}else{if(h===m.DES_VALUE){if(!_.isEqual(k,g.analysisDatas())){g.analysisDatas(k)}}else{if(h===m.PROC_FILTER){g.analysisFilters(k)}}}}else{if(l.vizType){g.vizType(l.vizType)}}}})();(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.events.ShelfEvent");var b=a.views.analysisContainer.events.ShelfEvent=function(c,e,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.events.Event);b.CARD_COPIED="cardCopied";b.CARD_SHELVED="cardShelved";b.HELPER_DROPPED="helperDropped"})();(function(){var c=andrea.grace;var b=c.helpers.PageTransition;andrea.blink.declare("andrea.grace.views.components.MoreButton");var a=c.views.components.MoreButton=function(e){a.superclass.constructor.apply(this,arguments);var d=this._$dom.children();this._$p1=$(d[0]);this._$p2=$(d[1]);_.defer($.proxy(function(){this._onTop(this._$p1)},this));this._$dom.addClass("grace-morebutton");this._$p1.addClass("grace-morebutton-page");this._$p2.addClass("grace-morebutton-page");this._$dom.hover($.proxy(this.showP2,this),$.proxy(this.showP1,this))};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype._onTop=function(d){this._$p1.removeClass("pt-page-onTop");this._$p2.removeClass("pt-page-onTop");d.addClass("pt-page-onTop");this._$p1.css("width",this._$dom.width());this._$p1.css("height",this._$dom.height());this._$p2.css("width",this._$dom.width());this._$p2.css("height",this._$dom.height())};a.prototype.showP1=function(){var d=new b({"$page":this._$p2,classes:["pt-page-moveToBottom"]},{"$page":this._$p1,classes:["pt-page-moveFromTop"]},function(){});this._onTop(d.$inPage());d.play()};a.prototype.showP2=function(){var d=new b({"$page":this._$p1,classes:["pt-page-moveToTop"]},{"$page":this._$p2,classes:["pt-page-moveFromBottom"]},function(){});this._onTop(d.$inPage());d.play()}})();(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.PopUpEvent");var a=b.views.popUp.PopUpEvent=function(c,e,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.events.Event);a.POPUP_OPENED="popupOpened";a.POPUP_CLOSED="popupClosed"})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.PopUpBase");var e=b.managers.PopUpManager;var a=b.views.popUp.PopUpEvent;var d=b.views.popUp.PopUpBase=function(f){d.superclass.constructor.apply(this,arguments);this.$dom().bind("selectstart",function(){return false});this._classVisible=null;this._$dock=null};andrea.blink.extend(d,andrea.blink.mvc.View);d.prototype.$dock=function(){return this._$dock};d.prototype.open=function(g,h){this._$dock=g;var j=this;var f=c(this._dom);f.css({position:"absolute",left:g.offset().left,top:g.offset().top+g.outerHeight()});if(this._classVisible){_.defer(function(){f.addClass(j._classVisible)})}e.createPopUp(this,h);this.dispatchEvent(new a(a.POPUP_OPENED,this))};d.prototype.close=function(g){var h=this;var f=c(this._dom);if(g==null){g=1}if(this._classVisible){f.removeClass(this._classVisible);g=2000}if(g>0){setTimeout(function(){e.removePopUp(h)},g)}else{e.removePopUp(h)}this.dispatchEvent(new a(a.POPUP_CLOSED,this))};d.prototype.closeImmediately=function(){this.close(0)}})(jQuery);(function(b){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.HoverPopUpBase");var c=a.views.popUp.HoverPopUpBase=function(d){c.superclass.constructor.apply(this,arguments);this._hover=null;this._click=null;this._mousedown=null;this._mouseup=null};andrea.blink.extend(c,a.views.popUp.PopUpBase);c.prototype.open=function(d){c.superclass.open.apply(this,arguments);this._closeByHover(true)};c.prototype.close=function(){c.superclass.close.apply(this,arguments);this._closeByHover(false)};c.prototype._closeByClick=function(d){if(d){var f=this;var e=this._click=b.proxy(function(g){if(this._$dom[0]!=g.target&&!b.contains(this._$dom[0],g.target)){if(this._$dock[0]!=g.target&&!b.contains(this._$dock[0],g.target)){this.close()}}},this);b("body").on("click",e)}else{b("body").off("click",this._click)}};c.prototype._closeByHover=function(g){if(g){var l=this;var d=true;var h=false;var k=function(){if(h){return}setTimeout(function(){if(!d){l.close()}},120)};var f=this._hover=function(m){if(m.type==="mouseenter"){d=true}else{if(m.type==="mouseleave"){d=false;k()}}};var e=this._mousedown=function(){h=true};var j=this._mouseup=function(){h=false;if(!d){k()}};this._$dock.on("hover",f);this._$dom.on("hover",f);this._$dom.on("mousedown",e);b("body").on("mouseup",j)}else{this._$dock.off("hover",this._hover);this._$dom.off("hover",this._hover);this._$dom.off("mousedown",this._mousedown);b("body").off("mouseup",this._mouseup)}}})(jQuery);(function(c){var b=andrea.grace;var d=b.managers.PopUpManager;andrea.blink.declare("andrea.grace.views.popUp.Loading");var a=b.views.popUp.Loading=function(f,e){a.superclass.constructor.apply(this,arguments);this._classVisible="grace-loading-visible";this._$spin=null;this._spinner=null;this._label=e;this._percent=0;this._$label=null;this._createChildren()};andrea.blink.extend(a,b.views.popUp.PopUpBase);a.prototype.open=function(e,f){a.superclass.open.apply(this,arguments);if(this._label==null){this._$dom.width(90);this._$dom.height(90)}else{this._$dom.width(90);this._$dom.height(105);this._$label=c("<div/>").addClass("grace-loading-label").appendTo(this._$dom);this._validateLabel()}this._$spin.width(this._$dom.width());this._$spin.height(90);this._spinner=new Spinner({color:"#ffffff"});this._spinner.spin(this._$spin[0]);d.centerPopUp(this,e)};a.prototype.percent=function(e){this._percent=e;this._validateLabel()};a.prototype._validateLabel=function(){var e=Math.min(99,Math.round(this._percent*100))+"%";if(this._label){e=this._label+": "+e}this._$label.text(e)};a.prototype._createChildren=function(){this._$dom.addClass("grace-loading");this._$spin=c("<div/>").addClass("grace-loading-spin").appendTo(this._$dom)}})(jQuery);(function(d){var c=andrea.grace;var b=c.models.value.NullValue;andrea.blink.declare("andrea.grace.views.popUp.filter.dataProvider.TextValuesProxy");var a=c.views.popUp.filter.dataProvider.TextValuesProxy=function(f,e,g){this.filter=f;this._dp=_.sortBy(e,function(h){return h.caption()});this._hasNull=g};a.prototype.checked=function(e,f){if(arguments.length>1){if(f){this.filter.addOption(e)}else{this.filter.removeOption(e)}}else{return this.filter.filter(e)}};a.prototype.length=function(){return this._dp.length};a.prototype.getItemAt=function(e){return this._dp[e]};a.prototype.getCaption=function(e){return e.caption()};a.prototype.getNullItem=function(){if(this._hasNull){b.instance()}else{return null}}})(jQuery);(function(d){var c=andrea.grace;var a=c.models.value.NullValue;andrea.blink.declare("andrea.grace.views.popUp.filter.dataProvider.RangeValuesProxy");var b=c.views.popUp.filter.dataProvider.RangeValuesProxy=function(e,f){this.filter=e;this._hasNull=f};b.prototype.from=function(e){return this.filter.from.apply(this.filter,arguments)};b.prototype.to=function(e){return this.filter.to.apply(this.filter,arguments)};b.prototype.min=function(e){return this.filter.min.apply(this.filter,arguments)};b.prototype.max=function(e){return this.filter.max.apply(this.filter,arguments)};b.prototype.getNullItem=function(){if(this._hasNull){a.instance()}else{return null}};b.prototype.getMinCaption=function(e){return this.filter.parseQuantified(this.min()).caption()};b.prototype.getMaxCaption=function(e){return this.filter.parseQuantified(this.max()).caption()}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.filter.FilterEvent");var a=b.views.popUp.filter.FilterEvent=function(c,e,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.events.Event);a.ITEM_SELECTED="itemSelected"})();(function(d){var c=andrea.grace;var b=c.views.popUp.filter.FilterEvent;andrea.blink.declare("andrea.grace.views.popUp.filter.PopUpTextFilter");var a=c.views.popUp.filter.PopUpTextFilter=function(f,e){a.superclass.constructor.apply(this,arguments);this._$dom.addClass("grace-text-filter");this._classVisible="grace-text-filter-visible";this._dataProvider=e};andrea.blink.extend(a,c.views.popUp.HoverPopUpBase);a.create=function(e){var f=new a(d("<div/>")[0],e);f._createChildren();return f};a.prototype._createChildren=function(){var l=this;var g=this._dataProvider;var j=d("<ul/>").appendTo(this._$dom);var h;var n;var q=function(s,t){var w=d("<li/>");var v=_.uniqueId("checkbox_");var u=d('<input type="checkbox"/>').appendTo(w).attr({id:v,checked:s});var r=d("<label/>").appendTo(w).attr({"for":v}).addClass("grace-text-ellipsis");d("<span/>").appendTo(r).attr({usage:"icon"});d("<span/>").appendTo(r).text(t);w.on("change",function(z){var A;w=d(this);var B=d('li[__all="false"]',j);var y=f(w);var x=w.attr("__all")==="true";if(x){for(h=0;h<B.length;h++){w=B.eq(h);A=w.data("__item");l._dataProvider.checked(A,y);d("input",w).attr("checked",y)}}else{A=w.data("__item");if(A.notNull()){l._dataProvider.checked(A,y);k()}}l.dispatchEvent(new b(b.ITEM_SELECTED,l))});return w};var f=function(r){return d("input",r).attr("checked")==="checked"};var k=function(){var t=d('li[__all="false"]',j);var r=true;for(h=0;h<t.length;h++){var s=t.eq(h);r=r&&f(s)}d("input",d('li[__all="true"]',j)).attr("checked",r)};var m;m=q(true,"全选");m.attr("__all",true).appendTo(j);d("<div/>").appendTo(j);var p=d("<ul/>").appendTo(d("<li/>").appendTo(j).addClass("grace-text-filter-li-ascontainer")).addClass("fancy-scrollbar");for(h=0;h<g.length();h++){n=g.getItemAt(h);m=q(g.checked(n),g.getCaption(n));m.attr("__all",false).data("__item",n);m.appendTo(p)}var e=g.getNullItem();if(e){m=q(g.checked(e),g.getCaption(e));m.attr("__all",false).appendTo(j);d("<div/>").appendTo(j)}_.defer(function(){j.removeClass("grace-text-filter-animation");j.width(p.width());_.defer(function(){j.addClass("grace-text-filter-animation")})});k()}})(jQuery);(function(c){var b=andrea.grace;var a=b.views.popUp.filter.FilterEvent;andrea.blink.declare("andrea.grace.views.popUp.filter.PopUpRangeFilter");var d=b.views.popUp.filter.PopUpRangeFilter=function(f,e){d.superclass.constructor.apply(this,arguments);this._$dom.addClass("grace-range-filter");this._classVisible="grace-range-filter-visible";this._dataProvider=e;this._itemSelectRequested=false};andrea.blink.extend(d,b.views.popUp.HoverPopUpBase);d.create=function(e){var f=new d(c("<div/>")[0],e);f._createChildren();return f};d.prototype.close=function(e){if(this._itemSelectRequested){this.dispatchEvent(new a(a.ITEM_SELECTED,this))}d.superclass.close.apply(this,arguments)};d.prototype._createChildren=function(){var l=this;var k=this._dataProvider;var f=c("<div/>").addClass("grace-range-filter-label");f.appendTo(this._$dom);var j=c("<div/>").addClass("grace-range-filter-slider");var g=c("<div/>").slider({range:true,min:k.from(),max:k.to(),values:[k.min(),k.max()],slide:function(m,n){k.min(n.values[0]);k.max(n.values[1]);e(true);h()}}).appendTo(j);j.appendTo(this._$dom);l._itemSelectRequested=false;var h=function(){if(!l._itemSelectRequested){l._itemSelectRequested=true;_.delay(function(){l._itemSelectRequested=false;l.dispatchEvent(new a(a.ITEM_SELECTED,l))},300)}};var e=function(){f.text([k.getMinCaption(),k.getMaxCaption()].join(" - "))};e(false)}})(jQuery);(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.menu.dataProvider.OperationGroupProxy");var a=b.views.popUp.menu.dataProvider.OperationGroupProxy=function(d){this._operationGroups=d};a.prototype.length=function(){return this._operationGroups.length};a.prototype.groupLength=function(d){return this._operationGroups[d].operations().length};a.prototype.getItem=function(e,d){return this._operationGroups[e].operations()[d]}})(jQuery);(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.menu.dataProvider.AnalysesProxy");var a=b.views.popUp.menu.dataProvider.AnalysesProxy=function(d){this._analyses=d};a.prototype.length=function(){return 1};a.prototype.groupLength=function(d){if(d===0){return this._analyses.length}else{return 0}};a.prototype.getItem=function(e,d){if(e===0){return this._analyses[d]}else{return null}}})(jQuery);(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.menu.MenuEvent");var b=a.views.popUp.menu.MenuEvent=function(c,e,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.events.Event);b.ITEM_SELECTED="itemSelected"})();(function(c){var b=andrea.grace;var d=b.views.popUp.menu.MenuEvent;andrea.blink.declare("andrea.grace.views.popUp.menu.PopUpMenu");var a=b.views.popUp.menu.PopUpMenu=function(e){a.superclass.constructor.apply(this,arguments);this._$dom.addClass("grace-menu");this._classVisible="grace-menu-visible";this._dataProvider=null};andrea.blink.extend(a,b.views.popUp.HoverPopUpBase);a.create=function(e){var f=new a(c("<div/>"));f._createChildren(e);return f};a.prototype._createChildren=function(e){this._dataProvider=e;this._createMenu(this._dataProvider,c(this._dom))};a.prototype._createMenu=function(g,q){var m=this;var n=function(j){p=c(j.currentTarget);m.dispatchEvent(new d(d.ITEM_SELECTED,m,{item:p.data("__item")}));m.close()};var l=c("<ul/>").appendTo(q);var k,h;var e;for(k=0;k<g.length();k++){if(k!==0){c("<div/>").appendTo(l)}for(h=0;h<g.groupLength(k);h++){var p=c("<li/>").appendTo(l);var f=c("<a/>").appendTo(p);e=g.getItem(k,h);p.data({__item:e}).click(n);f.text(e.name)}}}})(jQuery);(function(f){var y=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.supportClasses.ShelfBase");var h=y.models.DataDiscoveryModel;var D=y.constants.ValueType;var n=y.models.value.NumberValue;var E=y.models.value.DateValue;var l=andrea.grace.constants.AnalysisType;var C=y.views.analysisContainer.events.ShelfEvent;var j=y.models.vo.Analysis;var q=y.constants.ShelfType;var p=y.views.popUp.menu.PopUpMenu;var z=y.views.popUp.menu.dataProvider.OperationGroupProxy;var v=y.views.popUp.menu.dataProvider.AnalysesProxy;var m=y.views.popUp.PopUpEvent;var t=y.operation.OperationFactory;var e=y.views.popUp.menu.MenuEvent;var c=y.operation.OperationGroup;var b=y.operation.OperationClassification;var r=y.operation.OperationPriorityBaseline;var a=y.operation.OperationType;var k=y.filter.TextFilter;var u=y.utils.FilterUtil;var x=y.views.popUp.filter.dataProvider.TextValuesProxy;var d=y.views.popUp.filter.PopUpTextFilter;var B=y.filter.RangeFilter;var A=y.views.popUp.filter.dataProvider.RangeValuesProxy;var g=y.views.popUp.filter.PopUpRangeFilter;var w=y.views.popUp.filter.FilterEvent;var s=y.views.analysisContainer.supportClasses.ShelfBase=function(H){s.superclass.constructor.apply(this,arguments);var I=this;this._$ph=f("<div/>").addClass("grace-analysis-card_placeholder");this._popUpMenu=null;this._popUpFilter=null;this._trashMenu=null;this._type=null;this._layout=null;this._initialization();this.helperGetAnalysis=null;f(this._dom).css({}).addClass("grace-analysis-contaier");this._$trashBin=null;this._$cards=null;var G;G=f(this._dom);G=f("<div/>").appendTo(G).addClass("grace-analysis-titleArea grace-analysis-clearfix");G=f("<div/>").appendTo(G).addClass("grace-analysis-title");f("<h2/>").appendTo(G).addClass("grace-analysis-title-text");if(q.src(this._type)){this._$trashBin=f("<span/>").appendTo(G).attr("title","移回");this._$trashBin.addClass(["grace-analysis-operation","grace-analysis-title-operation","grace-analysis-title-operation-recycleBin"].join(" "))}G=f(this._dom);G=f("<div/>").appendTo(G).addClass("grace-analysis-cardArea");var F=this._$cards=f("<div/>").appendTo(G).addClass("grace-analysis-cards fancy-scrollbar");if(this._layout==="horizontal"){F.addClass("grace-analysis-cards-horizontal")}if(I._layout==="vertical"){f("<div/>").appendTo(G).addClass("grace-analysis-cardArea-gradientTop");f("<div/>").appendTo(G).addClass("grace-analysis-cardArea-gradientBottom")}f(this._dom).droppable({tolerance:"pointer",accept:function(K){var M=K.attr("__shelfType");var L=I._type;var J=I.helperGetAnalysis(K.attr("__analysisID"));if(q.src(L)){if(L===q.SRC_MEA){if(q.src(M)&&J.valueType()===D.NUMBER){return true}}else{if(q.src(M)){return true}}}else{if(q.des(L)){if(L===q.DES_DIM){if(J.analysisType===l.DIMENSION){return true}}else{return true}}else{if(q.proc(L)){return true}}}return false},activate:function(K){var J=f(K.currentTarget);var M=J.attr("__shelfType");var L=I._type;if(M!==L){f(this).addClass("grace-analysis-contaier_dropAcceptable")}},deactivate:function(J){f(this).removeClass("grace-analysis-contaier_dropAcceptable");I._$ph.detach()},drop:function(K,L){var N=L.helper.attr("__shelfType");var M=I._type;I._$ph.detach();L.helper.attr("__toContainerType",M);var J=null;if(N===M){J=L.helper.attr("__shelvedAnalysisID")}I.dispatchEvent(new C(C.HELPER_DROPPED,I,{analysisID:L.helper.attr("__analysisID"),"$helper":L.helper,from:N,to:M}));I.dispatchEvent(new C(C.CARD_SHELVED,I,{shelvedContexts:I.getShelvedContexts()}))},over:function(K,L){L.helper.attr("__overContainerType",I._type);I._$ph.attr("__toIndex","");var J=I._$cards;I._$ph.appendTo(J).css({width:L.helper.outerWidth()+"px",height:L.helper.outerHeight()+"px"});if(I._layout==="horizontal"){I._$ph.addClass("grace-analysis-card_horizontal")}L.helper.on("event-drag",function(){var N=[];var Q=-1;I._traversalCards(function(S){var T=f(this);if(T.attr("__dragging")==="true"){Q=N.length}N.push({top:T.offset().top,left:T.offset().left})},true,false);var R;if(I._layout==="vertical"){R="top"}else{if(I._layout==="horizontal"){R="left"}}var P=L.helper.offset()[R];for(i=-1;i<N.length;i++){var O=i<0?Number.MIN_VALUE:N[i][R];var M=i===N.length-1?Number.MAX_VALUE:N[i+1][R];if(P>O&&P<=M){if(I._$ph.attr("__toIndex")!==i+1+""){I._$ph.detach();I._$ph.attr("__toIndex",i+1);if(Q===-1||(Q!==i+1&&Q!==i)){J.appendAt(I._$ph,i+1)}}break}}}).removeClass("grace-analysis-card_draggingHelper_noDrop").addClass("grace-analysis-card_draggingHelper_grabbing")},out:function(J,K){var L=K.helper.attr("__overContainerType");if(I._type===L){K.helper.off("event-drag").addClass("grace-analysis-card_draggingHelper_noDrop").removeClass("grace-analysis-card_draggingHelper_grabbing")}I._$ph.detach()}})};andrea.blink.extend(s,andrea.blink.mvc.View);s.OPERATION_DISPLAY_SPLITTER=" | ";s.prototype.getShelvedContexts=function(){var F=[];this._traversalCards(function(H){var I=f(this);var G={analysisID:I.attr("__analysisID"),shelvedAnalysisID:I.attr("__shelvedAnalysisID"),operationGroup:new c(JSON.parse(I.attr("__operationIDs"))),filter:I.data("__filter")};F.push(G)},true,true);return F};s.prototype._traversalCards=function(M,J,N){var F=this._$cards;var H=F.children();var L=0;for(var K=0;K<H.length;K++){var I=H[K];var G=f(I);if(J&&I===this._$ph[0]){continue}if(N&&G.attr("__dragging")==="true"){continue}M.call(I,L);L++}};s.prototype._setTitle=function(G){var F=f(this._dom).find("h2");F.text(G)};s.prototype._setRequired=function(G){var F=f(this._dom).find("h2");if(G){F.addClass("grace-analysis-title-text_required")}else{F.removeClass("grace-analysis-title-text_required")}};s.prototype.addSuffix=function(G){var F=f(this._dom).find("h2");if(G){F.addClass("grace-analysis-title-text_suffix").attr({__suffix:G})}else{F.removeClass("grace-analysis-title-text_suffix")}};s.prototype.type=function(F){if(arguments.length>0){this._type=F}else{return this._type}};s.prototype.dropAnalysis=function(F,G,J,I){var H=this._addCardAt(F,parseInt(this._$ph.attr("__toIndex")),G,J!==I)};s.prototype.addCard=function(F){return this._addCardAt(F)};s.prototype._getOperationInfo=function(){return{availableOGs:[],defaultTypes:[]}};s.prototype._addCardAt=function(X,L,I,J){var S=this;var V=this._$cards;var K=f("<div/>").addClass(["grace-analysis-card","grace-analysis-card-transition"].join(" "));if(this._layout==="horizontal"){K.addClass("grace-analysis-card_horizontal")}K.width("");V.appendAt(K,L);var Y;if(I&&!J){Y=I.attr("__shelvedAnalysisID")}else{Y=_.uniqueId("shelvedAnalysisID_")}K.data({__analysis:X});K.attr({__analysisID:X.id,__shelvedAnalysisID:Y,__shelfType:this._type});var U=f("<div/>").appendTo(K).addClass("grace-analysis-card-text grace-text-ellipsis").text(X.name);U.on("mouseenter",function(){var Z=f(this);if(this.offsetWidth<this.scrollWidth&&!K.attr("title")){K.attr("title",Z.text())}}).on("mouseleave",function(){K.attr("title","")});var O;if(I&&I.attr("__operationIDs")&&I.attr("__shelfType")===this._type){O=JSON.parse(I.attr("__operationIDs"))}var W=this._getOperationInfo(X);var T=W.availableOGs;var Q=W.defaultTypes;var N=function(Z){return false};var F=function(){var Z=f("<span/>").appendTo(K).addClass(["grace-analysis-operation","grace-analysis-card-operation"].join(" "));Z.addClass(["grace-analysis-card-operation-removeFromShelf","grace-analysis-card-operation-1"].join(" "));Z.attr("title","移除");Z.on("click",function(){S._hide(K,function(){K.detach();S.dispatchEvent(new C(C.CARD_SHELVED,S))})}).on("mousedown",N);return Z};var R;if(q.proc(this._type)){F();var H=this._model().dataProvider.getCValues(X.index,true,false);var M=this._model().dataProvider.isCHasNull(X.index);if(X.quantifiable){if(X.valueType()===D.DATE){K.data("__filter",new B(H,M,E.parseQuantified))}else{if(X.valueType()===D.NUMBER){K.data("__filter",new B(H,M,n.parseQuantified))}}}else{K.data("__filter",new k(H,M))}R=f("<span/>").appendTo(K).addClass(["grace-analysis-operation","grace-analysis-card-operation"].join(" "));R.addClass(["grace-analysis-card-operation-filter","grace-analysis-card-operation-2"].join(" "));R.on("hover",function(Z){if(Z.type==="mouseenter"){S._createPopUpFilter(X,K,R)}}).on("mousedown",N)}else{if(q.des(this._type)){F();if(T&&T.length>0){R=f("<span/>").appendTo(K).addClass(["grace-analysis-operation","grace-analysis-card-operation"].join(" "));R.addClass(["grace-analysis-card-operation-dropDown","grace-analysis-card-operation-2"].join(" "));R.on("hover",function(Z){if(Z.type==="mouseenter"){S._createPopUpMenu(T,X,K,R)}}).on("mousedown",N)}}else{if(q.src(this._type)){R=f("<span/>").appendTo(K).addClass(["grace-analysis-operation","grace-analysis-card-operation"].join(" "));R.addClass(["grace-analysis-card-operation-addToAnalysis","grace-analysis-card-operation-1"].join(" "));if(this._type===q.SRC_DIM){R.attr("title","添加到分析纬度")}else{if(this._type===q.SRC_MEA){R.attr("title","添加到分析指标")}}var P=function(){var Z;if(this._type===q.SRC_DIM){Z=q.DES_DIM}else{if(this._type===q.SRC_MEA){Z=q.DES_VALUE}}this.dispatchEvent(new C(C.CARD_COPIED,this,{analysis:K.data("__analysis"),pasteTo:Z}))};K.on("dblclick",f.proxy(P,this));R.on("click",f.proxy(P,this)).on("mousedown",N);R=f("<span/>").appendTo(K).addClass(["grace-analysis-operation","grace-analysis-card-operation"].join(" "));R.addClass(["grace-analysis-card-operation-moveToTrash","grace-analysis-card-operation-2"].join(" "));R.attr("title","隐藏");R.on("click",f.proxy(function(){this._addToTrash(K)},this)).on("mousedown",N)}}}if(!O||O.length===0){O=c.createByTypes(Q).mapIDs()}if(!O){O=[]}this._setOperations(O,K);if(q.src(this._type)){if(this._type===q.SRC_DIM){X.analysisType=l.DIMENSION}else{if(this._type===q.SRC_MEA){X.analysisType=l.MEASURE}}}if(q.dim(this._type)&&q.src(this._type)){var G;if(X.valueType()===D.DATE){G="\uf073"}else{if(X.numUniqueValue!==null){G=X.numUniqueValue}}if(G){U.addClass("grace-analysis-card-text_suffix").attr({__suffix:G})}}K.addClass("grace-analysis-card_asSource");if(X.analysisType===l.DIMENSION){K.addClass("grace-analysis-card_asDimension")}else{if(X.analysisType===l.MEASURE){K.addClass("grace-analysis-card_asMeasure")}}K.draggable({containment:f("#divDataDiscovery"),helper:function(Z){var aa=f(this).clone();aa.width(f(this).width()).addClass("grace-analysis-card_draggingHelper");aa.removeClass("grace-analysis-card_asSource grace-analysis-card_asDimension grace-analysis-card_asMeasure");aa.removeClass("grace-analysis-card-transition");aa.appendTo(f("body"));return aa},start:function(Z,aa){f(this).addClass("grace-analysis-card_disabled").attr({__dragging:"true"});aa.helper.addClass("grace-analysis-card_draggingHelper_grabbing")},stop:function(Z,aa){f(this).removeClass("grace-analysis-card_disabled").attr({__dragging:"false"});aa.helper.removeClass("grace-analysis-card_draggingHelper_grabbing");var ac=aa.helper.attr("__shelfType");var ab=aa.helper.attr("__toContainerType");if(ab){if(q.like(ac,ab)){f(this).detach()}else{if(q.des(ac)&&q.proc(ab)){f(this).detach()}else{if(q.proc(ac)&&q.des(ab)){f(this).detach()}}}}else{if(q.des(ac)){f(this).detach()}}aa.helper.off("event-drag");S.dispatchEvent(new C(C.CARD_SHELVED,S,{shelvedContexts:S.getShelvedContexts()}))},drag:function(Z,aa){aa.helper.trigger("event-drag")}});if(this._animationActivated){K.width(K.width());this._show(K)}return K};s.prototype._addOperation=function(F,I){var H=t.produce(F,r.USER_SPECIFICATION);var G=new c(JSON.parse(I.attr("__operationIDs")));G.addOperation(H.id);this._setOperations(G.mapIDs(),I)};s.prototype._setOperations=function(K,L){var G=L.find(".grace-analysis-card-text");var J=JSON.stringify(K);if(J){if(L.attr("__operationIDs")!==J){L.attr({__shelvedAnalysisID:_.uniqueId("shelvedAnalysisID_"),__operationIDs:J})}var I=new c(K);var H=I.mapAbbrs();H=_.without(H,"");var F=H.join(s.OPERATION_DISPLAY_SPLITTER);if(F&&q.des(this._type)){G.addClass("grace-analysis-card-text_prefix").attr({__prefix:F})}else{G.removeClass("grace-analysis-card-text_prefix")}}else{L.removeAttr("__operationIDs");G.removeClass("grace-analysis-card-text_prefix")}};s.prototype._model=function(){return h.instance()};s.prototype._createPopUpFilter=function(O,G,H){if(this._popUpFilter){if(this._popUpFilter.$dock()===H){return}else{this._popUpFilter.closeImmediately()}}var M=this;this._showOperation(true,G,H);G.find(".grace-analysis-card-text").addClass("grace-analysis-card-text-shrink");var K=this._model();var I=[];var L=this.getShelvedContexts();_.each(L,function(R){var Q=K.getShelvedAnalysis(R.shelvedAnalysisID);if(Q.id!==G.attr("__shelvedAnalysisID")){I.push(Q)}});var J=u.filter(K.dataProvider,I);var P=J.getCValues(O.index,true,true);var F=J.isCHasNull(O.index);if(O.quantifiable){this._popUpFilter=g.create(new A(G.data("__filter"),F))}else{this._popUpFilter=d.create(new x(G.data("__filter"),P,F))}var N=false;this._popUpFilter.addEventListener(w.ITEM_SELECTED,function(Q){M.dispatchEvent(new C(C.CARD_SHELVED,M))});this._popUpFilter.addEventListener(m.POPUP_CLOSED,function(Q){this._showOperation(false,G,H);G.find(".grace-analysis-card-text").removeClass("grace-analysis-card-text-shrink");M._popUpFilter.removeAllEventListeners();M._popUpFilter=null},this);this._popUpFilter.open(H)};s.prototype._showOperation=function(F,H,G){if(F){H.find(".grace-analysis-card-text").addClass("grace-analysis-card-text-shrink");G.addClass("grace-analysis-card-operation-show")}else{H.find(".grace-analysis-card-text").removeClass("grace-analysis-card-text-shrink");G.removeClass("grace-analysis-card-operation-show")}};s.prototype._createPopUpMenu=function(F,G,J,I){if(this._popUpMenu){return}var H=this;this._showOperation(true,J,I);this._popUpMenu=p.create(new z(F));this._popUpMenu.addEventListener(e.ITEM_SELECTED,function(L){var K=L.data.item;H._addOperation(K.type,J);H.dispatchEvent(new C(C.CARD_SHELVED,H))});this._popUpMenu.addEventListener(m.POPUP_CLOSED,function(K){this._showOperation(false,J,I);H._popUpMenu.removeAllEventListeners();H._popUpMenu=null},this);this._popUpMenu.open(I)};s.prototype.updateShelvedAnalyses=function(G){var H=this;var F=0;this._traversalCards(function(J){var K=f(this);var I=G(K.attr("__shelvedAnalysisID"));if(I&&I.visualized){F++}},true,true);this._traversalCards(function(J){var K=f(this);var I=G(K.attr("__shelvedAnalysisID"));if(I){if(F>0&&!I.visualized){K.addClass("grace-analysis-card_disabled")}else{K.removeClass("grace-analysis-card_disabled")}H._setOperations(I.operationGroup.mapIDs(),K)}},true,true)};s.prototype._addToTrash=function(J){var F=J.data("__analysis");var G=this._$cards.data("__trash")||[];if(G.length===0){var I=this._$trashBin;var H=f.proxy(function(K){if(K.type==="mouseenter"&&!this._trashMenu){var L=this._trashMenu=p.create(new v(this._$cards.data("__trash")));L.addEventListener(e.ITEM_SELECTED,function(M){this._removeFromTrash(M.data.item)},this);L.addEventListener(m.POPUP_CLOSED,function(M){L.removeAllEventListeners();this._trashMenu=null},this);L.open(I)}},this);this._show(I).on("hover",H)}G.push(F);this._$cards.data("__trash",G);this._hide(J,f.proxy(function(){J.detach()},this))};s.prototype._removeFromTrash=function(F){var G=this._$cards.data("__trash")||[];G=_.without(G,F);if(G.length===0){this._hide(this._$trashBin).off("hover")}this._$cards.data("__trash",G);this._addCardAt(F,0)};s.prototype._hide=function(F,G){F.width(F.width());return F.show(0).hide("explode",{easing:"easeOutSine"},180,G)};s.prototype._show=function(F,G){return F.hide(0).show("explode",{easing:"easeInSine"},250,G)};s.prototype.removeAll=function(){this._$cards.empty()};s.prototype._validateSize=function(){var F=this.size();var G=F.height-36;this._$cards.css({"max-height":G+"px",height:G+"px"})}})(jQuery);(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.supportClasses.ShelfBaseMediator");var a=c.constants.AppConst;var f=c.views.analysisContainer.events.ShelfEvent;var b=c.views.popUp.VizNavigatorEvent;var e=c.views.analysisContainer.supportClasses.ShelfBaseMediator=function(g){e.superclass.constructor.apply(this,arguments);this._view=g;this._model=null};andrea.blink.extend(e,andrea.blink.mvc.ViewMediator);e.prototype.init=function(){var h=this;this._model=this._getModel(a.MODEL_GRACE);this._view.helperGetAnalysis=function(j){return h._model.getAnalysis(j)};var g=function(){h._action(a.ACTION_RUN_ANALYSIS,{shelfType:h._view.type(),shelvedContexts:h._view.getShelvedContexts()})};this._view.addEventListener(f.CARD_SHELVED,function(j){g()},this);this._view.addEventListener(f.HELPER_DROPPED,function(k){var j=h._model.getAnalysis(k.data.analysisID);h._view.dropAnalysis(j,k.data.$helper,k.data.from,k.data.to)});this._view.addEventListener(f.CARD_COPIED,function(j){h._model.viewNotify(a.VIEW_NOTIFICATION_PASTE_TO,{analysis:j.data.analysis,targetShelfType:j.data.pasteTo})});this._subscribe(a.VIEW_NOTIFICATION_PASTE_TO,function(j){if(h._view.type()===j.data.targetShelfType){h._view.addCard(j.data.analysis)}g()});this._subscribe(a.NOTIFICATION_DATA_PROVIDER_CHANGED,function(j){h._dataProviderChangedHandler(j)});this._subscribe(a.NOTIFICATION_VIZ_CONTEXT_APPLIED,function(j){h._view.updateShelvedAnalyses(function(k){return h._model.getShelvedAnalysis(k)})})};e.prototype._dataProviderChangedHandler=function(g){this._view.removeAll()}})(jQuery);(function(){var e=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcDimensionShelf");var a=e.constants.AnalysisType;var b=e.constants.ShelfType;var g=e.operation.OperationClassification;var d=e.operation.OperationType;var f=e.operation.OperationGroup;var c=e.views.analysisContainer.source.SrcDimensionShelf=function(h){c.superclass.constructor.apply(this,arguments);this._setTitle("纬度");$(this._dom).css({})};andrea.blink.extend(c,e.views.analysisContainer.supportClasses.ShelfBase);c.prototype._initialization=function(){this._type=b.SRC_DIM;this._layout="vertical"}})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcDimensionShelfMediator");var b=c.constants.AppConst;var a=andrea.grace.constants.AnalysisType;var e=c.views.analysisContainer.source.SrcDimensionShelfMediator=function(){e.superclass.constructor.apply(this,arguments)};andrea.blink.extend(e,c.views.analysisContainer.supportClasses.ShelfBaseMediator);e.prototype.init=function(){e.superclass.init.apply(this,arguments)};e.prototype._dataProviderChangedHandler=function(){e.superclass._dataProviderChangedHandler.apply(this,arguments);this._view.deactivateAnimation();var g=this._getModel(b.MODEL_GRACE);for(var h=0;h<g.analyses.length;h++){var f=g.analyses[h];if(f.analysisType===a.DIMENSION){this._view.addCard(f)}}this._view.activateAnimation()}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcMeasureShelf");var a=d.constants.AnalysisType;var b=d.constants.ShelfType;var g=d.operation.OperationClassification;var c=d.operation.OperationType;var f=d.operation.OperationGroup;var e=d.views.analysisContainer.source.SrcMeasureShelf=function(h){e.superclass.constructor.apply(this,arguments);this._setTitle("指标")};andrea.blink.extend(e,d.views.analysisContainer.supportClasses.ShelfBase);e.prototype._initialization=function(){this._type=b.SRC_MEA;this._layout="vertical"}})();(function(e){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.source.SrcMeasureShelfMediator");var b=d.constants.AppConst;var a=andrea.grace.constants.AnalysisType;var c=d.views.analysisContainer.source.SrcMeasureShelfMediator=function(){c.superclass.constructor.apply(this,arguments)};andrea.blink.extend(c,d.views.analysisContainer.supportClasses.ShelfBaseMediator);c.prototype.init=function(){c.superclass.init.apply(this,arguments)};c.prototype._dataProviderChangedHandler=function(){c.superclass._dataProviderChangedHandler.apply(this,arguments);this._view.deactivateAnimation();var g=this._getModel(b.MODEL_GRACE);this._view.addSuffix(g.dataProvider.numRows);for(var h=0;h<g.analyses.length;h++){var f=g.analyses[h];if(f.analysisType===a.MEASURE){this._view.addCard(f)}}this._view.activateAnimation()}})(jQuery);(function(){var g=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesDimensionShelf");var d=g.constants.AnalysisType;var f=g.constants.ValueType;var b=g.constants.ShelfType;var a=g.operation.OperationType;var k=g.operation.OperationGroup;var j=g.operation.OperationClassification;var l=a;var e=k;var h=j;var c=g.views.analysisContainer.destination.DesDimensionShelf=function(m){c.superclass.constructor.apply(this,arguments);this._setTitle("分析维度");this._setRequired(true)};andrea.blink.extend(c,g.views.analysisContainer.supportClasses.ShelfBase);c.prototype._initialization=function(){this._type=b.DES_DIM;this._layout="horizontal"};c.prototype._getOperationInfo=function(n){var m;var p;if(n.valueType()===f.DATE){m=c.OGS_DATE;p=[l.SORT_ASCEND];if(n.dateSpan<86400000*(365/2+1)){p.push(l.DRILL_DATE)}else{if(n.dateSpan<86400000*(365*1)){p.push(l.DRILL_WEEK)}else{if(n.dateSpan<86400000*(365*5)){p.push(l.DRILL_MONTH)}else{p.push(l.DRILL_YEAR)}}}}else{m=c.OGS_DEFAULT;p=[l.SORT_NONE]}return{availableOGs:m,defaultTypes:p}};c.OGS_DATE=null;c.OGS_DEFAULT=null;c._loadClass=function(){var m;m=[];m.push(e.createByTypes([l.SORT_ASCEND,l.SORT_DESCEND]));m.push(e.createByClassification(h.DRILL));m.push(e.createByClassification(h.GROUP));c.OGS_DATE=m;m=[];m.push(e.createByTypes([l.SORT_NONE,l.SORT_ALPHABET_ASCEND,l.SORT_ALPHABET_DESCEND]));c.OGS_DEFAULT=m};c._loadClass()})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesDimensionShelfMediator");var a=c.constants.AppConst;var b=c.views.analysisContainer.destination.DesDimensionShelfMediator=function(){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,c.views.analysisContainer.supportClasses.ShelfBaseMediator);b.prototype.init=function(){b.superclass.init.apply(this,arguments)}})(jQuery);(function(){var e=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesMeasureShelf");var c=e.constants.AnalysisType;var b=e.constants.ShelfType;var a=e.operation.OperationType;var j=e.operation.OperationGroup;var h=e.operation.OperationClassification;var g=e.operation.OperationFactory;var l=a;var d=j;var f=h;var k=e.views.analysisContainer.destination.DesMeasureShelf=function(m){k.superclass.constructor.apply(this,arguments);this._setTitle("分析指标");this._setRequired(true)};andrea.blink.extend(k,e.views.analysisContainer.supportClasses.ShelfBase);k.prototype._initialization=function(){this._type=b.DES_VALUE;this._layout="horizontal"};k.prototype._getOperationInfo=function(n){var m;var p;if(n.analysisType===c.DIMENSION){m=k.OGS_DIMENSION;p=[l.CALC_COUNT]}else{if(n.analysisType===c.MEASURE){m=k.OGS_MEASURE;p=[l.CALC_SUM]}}return{availableOGs:m,defaultTypes:p}};k.OGS_DIMENSION=null;k.OGS_MEASURE=null;k._loadClass=function(){var m;m=[];m.push(d.createByTypes([l.CALC_UNIQ_COUNT,l.CALC_COUNT]));m.push(d.createByTypes([l.SORT_NONE,l.SORT_ASCEND,l.SORT_DESCEND]));k.OGS_DIMENSION=m;m=[];m.push(d.createByTypes([l.CALC_SUM,l.CALC_AVG,l.CALC_MAX,l.CALC_MIN]));m.push(d.createByTypes([l.SORT_NONE,l.SORT_ASCEND,l.SORT_DESCEND]));k.OGS_MEASURE=m};k._loadClass()})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.destination.DesMeasureShelfMediator");var b=c.constants.AppConst;var a=c.views.analysisContainer.destination.DesMeasureShelfMediator=function(){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,c.views.analysisContainer.supportClasses.ShelfBaseMediator);a.prototype.init=function(){a.superclass.init.apply(this,arguments)}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.processor.FilterShelf");var a=d.constants.AnalysisType;var b=d.constants.ShelfType;var c=d.views.analysisContainer.processor.FilterShelf=function(e){c.superclass.constructor.apply(this,arguments);this._setTitle("过滤数据")};andrea.blink.extend(c,d.views.analysisContainer.supportClasses.ShelfBase);c.prototype._initialization=function(){this._type=b.PROC_FILTER;this._layout="vertical"}})();(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.processor.FilterShelfMediator");var a=b.constants.AppConst;var d=b.views.analysisContainer.processor.FilterShelfMediator=function(){d.superclass.constructor.apply(this,arguments)};andrea.blink.extend(d,b.views.analysisContainer.supportClasses.ShelfBaseMediator);d.prototype.init=function(){d.superclass.init.apply(this,arguments)}})(jQuery);(function(c){var b=andrea.grace;var a=b.constants.VizType;andrea.blink.declare("andrea.grace.views.analysisResult.viz.VizFactory");var d=b.views.analysisResult.viz.VizFactory;d.produce=function(l,g,f){var e;var j=b.views.analysisResult.viz.placeHolder;var k=b.views.analysisResult.viz.highCharts;var h=b.views.analysisResult.viz.googleCharts;if(g===a.SCATTER){return new k.Scatter(l,"scatter",g)}else{if(g===a.BAR||g===a.STACKED_BAR){return new k.BasicXY(l,"bar",g)}else{if(g===a.COLUMN||g===a.STACKED_COLUMN){return new k.BasicXY(l,"column",g)}else{if(g===a.LINE||g===a.RADAR){return new k.BasicXY(l,"line",g)}else{if(g===a.AREA){return new k.BasicXY(l,"area",g)}else{if(g===a.PIE){return new k.Pie(l,"pie",g)}else{return new j.VizPH(l,f)}}}}}}}})(jQuery);(function(c){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.viz.VizBase");var a=b.views.analysisResult.viz.VizBase=function(d){a.superclass.constructor.apply(this,arguments);this._$dom=c(d);this._$dom.addClass("grace-result-viz")};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype.render=function(d,e,f){a._renderingCache=null;return true};a._renderingCache=null;a.prototype.destroy=function(){return true};a.prototype._addMessage=function(d){};a.prototype._removeMessages=function(d){};a._MESSAGES={}})(jQuery);(function(d){var c=andrea.grace;var a=c.constants.VizType;var b=c.views.analysisResult.viz.VizBase;andrea.blink.declare("andrea.grace.views.analysisResult.viz.placeHolder.VizPH");var e=c.views.analysisResult.viz.placeHolder.VizPH=function(g,f){e.superclass.constructor.apply(this,arguments);this._selectedVizType=f};andrea.blink.extend(e,b);e.prototype.render=function(h,j,p){b._renderingCache=null;var g=d("<div/>").appendTo(this._$dom).addClass("grace-result-viz-placeHolder-hint");var m=d("<span/>").appendTo(g);d("<br/>").appendTo(g);d("<br/>").appendTo(g);var l=d("<span/>").appendTo(g);if(h&&h.numRows===0){m.text("所有数据都被过滤掉了，");l.text("请修改过滤设置。")}else{if(this._selectedVizType===a.RECOMMEND){m.text("从左边的纬度栏和指标栏");l.text("开启您数据发现之旅！")}else{var f=a.manifest(this._selectedVizType);var k=f.required;var n="需要至少";if(k.numDimensions>0){n=n+k.numDimensions+"个分析纬度，"}if(k.numMeasures>0){n=n+k.numMeasures+"个分析指标。"}m.text(f.title+n);l.text("或者请使用推荐图形")}}g.css({left:(this._$dom.width()-g.width())/2+"px",top:(this._$dom.height()-g.height())/2+"px"});return true}})(jQuery);(function(){var d=andrea.grace;var f=d.constants.ValueType;var c=d.operation.OperationType;var b=d.models.value.NullValue;var a=d.models.value.DateValue;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueQuery");var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueQuery=function(j,h,g){this._dataProvider=j;this._sa=h;this._a=this._sa.source;this._names=null;this._captionParams=[];this._initialize();this._allNames=this._names;this._names=this._names.slice(0,g)};e.prototype._initialize=function(){var g=this._dataProvider.getCValues(this._a.index,true,true);var h={values:g,hasNull:this._dataProvider.isCHasNull(this._a.index)};if(this._a.valueType()===f.STRING){this._names=this._generateNames(h)}else{if(this._a.valueType()===f.NUMBER){this._names=this._generateNames(h)}else{if(this._a.valueType()===f.DATE){if(this._sa.operationGroup.has(c.DRILL_YEAR)){this._captionParams=[a.CAPTION_DRILL_YEAR];this._names=this._generateDateDrillNames(h,function(j){j.setMonth(0);j.setDate(1)},function(j,k){return j.getFullYear()<k.getFullYear()},function(j){j.setFullYear(j.getFullYear()+1)})}else{if(this._sa.operationGroup.has(c.DRILL_MONTH)){this._captionParams=[a.CAPTION_DRILL_MONTH];this._names=this._generateDateDrillNames(h,function(j){j.setDate(1)},function(j,k){return j.getFullYear()*12+j.getMonth()<k.getFullYear()*12+k.getMonth()},function(j){j.setMonth(j.getMonth()+1)})}else{if(this._sa.operationGroup.has(c.DRILL_WEEK)){this._captionParams=[a.CAPTION_DRILL_WEEK];this._names=this._generateDateDrillNames(h,function(j){},function(j,k){return Math.floor(j.getMonsday().getTime()/7/24/3600/1000)<Math.floor(k.getMonsday().getTime()/7/24/3600/1000)},function(j){j.setDate(j.getDate()+7)})}else{if(this._sa.operationGroup.has(c.DRILL_DATE)){this._captionParams=[a.CAPTION_DRILL_DATE];this._names=this._generateDateDrillNames(h,function(j){},function(j,k){return Math.floor(j.getTime()/24/3600/1000)<Math.floor(k.getTime()/24/3600/1000)},function(j){j.setDate(j.getDate()+1)})}else{if(this._sa.operationGroup.has(c.GROUP_MONTH)){this._captionParams=[a.CAPTION_GROUP_MONTH];this._names=this._generateSortedNames(h,_.clone(Date.monthNames))}else{if(this._sa.operationGroup.has(c.GROUP_DATE)){this._captionParams=[a.CAPTION_GROUP_DATE];this._names=this._generateSortedNames(h,_.clone(Date.dateNames))}else{if(this._sa.operationGroup.has(c.GROUP_DAY)){this._captionParams=[a.CAPTION_GROUP_DAY];this._names=this._generateSortedNames(h,_.clone(Date.dayNames))}else{if(this._sa.operationGroup.has(c.GROUP_HOUR)){this._captionParams=[a.CAPTION_GROUP_HOUR];this._names=this._generateSortedNames(h,_.clone(Date.hourNames))}}}}}}}}}}}};e.prototype._generateNames=function(j){var h=j.values;var g;if(this._sa.operationGroup.ascend()){h=_.sortBy(h,function(l){l.caption.apply(l,this._captionParams)})}else{if(this._sa.operationGroup.descend()){h=_.sortBy(h,function(l){l.caption.apply(l,this._captionParams)});h.reverse()}}var k=[];_.each(h,function(l){k.push(l.caption.apply(l,this._captionParams))});if(j.hasNull){g=b.instance();k.push(g.caption.apply(g,this._captionParams))}return k};e.prototype._generateDateDrillNames=function(g,k,j,r){var s=g.values;var h=_.sortBy(s,function(t){return t.quantified()});if(h.length===0){return[]}var n=h[0];var p=h[h.length-1];var l=new Date();l.setTime(n.value().getTime());k(l);var m=[];while(true){var q=new a("",l);m.push(q.caption.apply(q,this._captionParams));if(!j(l,p.value())){break}r(l)}return this._generateSortedNames(g,m)};e.prototype._generateSortedNames=function(h,j){if(this._sa.operationGroup.has(c.SORT_DESCEND)){j.reverse()}if(h.hasNull){var g=b.instance();j.push(g.caption.apply(g,this._captionParams))}return j};e.prototype.queryIndex=function(k){var g=k[this._a.index];var j=g.caption.apply(g,this._captionParams);var h=this._names.indexOf(j);if(h===-1&&this._allNames.indexOf(j)===-1){}return h};e.prototype.names=function(){return this._names}})();(function(){var a=andrea.grace;var b=a.operation.OperationGroup;var d=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.ValueQuery;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption");var c=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;c.genMain=function(e){return{chart:{type:e},title:{text:null},credits:{enabled:false}}};c.genLegend=function(e){var f=null;if(e){f={layout:"vertical",align:"left",verticalAlign:"middle"}}else{f={enabled:false}}return{legend:f}};c._visualize=function(f,g){var e=null;if(g<f.length){e=f[g];e.visualized=true}return e};c._setVisualized=function(g){if(!g){return}if(!_.isArray(g)){g=[g]}for(var f=0;f<g.length;f++){var e=g[f];e.visualized=true}};c.dataConfig=function(L,p,u,x,y,m){var D,H,F;var z;var h;var I,w,E;var G,s,C;var B,q;var k;var v;var A;var e=[];var r=[];var n=function(f){e.push(f);r.push(f.ascend());r.push(f.descend())};if(p){n(p.operationGroup)}if(u){n(u.operationGroup)}for(E=0;E<x.length;E++){n(x[0].operationGroup)}r=_.without(r,undefined);r.sort(function(M,f){return M.priority-f.priority});r.pop();_.each(e,function(f){_.each(r,function(M){f.removeOperation(M.id)})});if(!p){if(y){v=function(M,f){return f};G=x.length;C=1}else{v=function(M,f){return 0};G=1;C=x.length}}else{B=new d(L,p,m);v=function(M,f){return B.queryIndex(M)};G=B.names().length;C=x.length}if(!u){A=function(f){return 0};s=1}else{q=new d(L,u,m);A=function(f){return q.queryIndex(f)};s=q.names().length}var l=[];for(I=0;I<G;I++){l[I]={name:y?c.saToDisplay(x[I]):(B?B.names()[I]:c.saToDisplay(x[0])),data:[]};for(w=0;w<s;w++){l[I].data[w]={name:q?q.names()[w]:"",data:[]};for(E=0;E<C;E++){H=y?I:E;z=x[H].operationGroup;l[I].data[w].data[E]=z.calculator();if(!k&&(z.ascend()||z.descend())){k={si:I,di:E,ascend:z.ascend()}}}}}for(D=0;D<L.numRows;D++){var j=L.getRValues(D);for(H=0;H<x.length;H++){I=v(j,H);w=A(j);E=y?0:H;if(I===-1||w===-1||E===-1){continue}l[I].data[w].data[E].addFactor(j[x[H].source.index].value())}}var K=true;for(I=0;I<G;I++){for(w=0;w<s;w++){for(E=0;E<C;E++){var t=l[I].data[w].data[E].calculate();l[I].data[w].data[E]=t;K=K&&t>=0}}}var J={allPositive:K};if(q){J.categories=q.names()}J.series=l;if(k&&J.categories){var g=[];for(D=0;D<s;D++){o={category:J.categories[D],series:[]};for(I=0;I<J.series.length;I++){o.series[I]=J.series[I].data[D]}g.push(o)}g.sort(function(M,f){return M.series[k.si].data[k.di]-f.series[k.si].data[k.di]});if(!k.ascend){g.reverse()}J.categories=[];for(I=0;I<J.series.length;I++){J.series[I].data=[]}for(D=0;D<s;D++){o=g[D];J.categories.push(o.category);for(I=0;I<J.series.length;I++){J.series[I].data.push(o.series[I])}}}return J};c.OPERATION_DISPLAY_SPLITTER=" | ";c.OPERATION_DISPLAY_SPLITTER_ABBR="|";c.saToDisplay=function(e){var f=e.operationGroup.mapNames().join(c.OPERATION_DISPLAY_SPLITTER);if(f){return e.source.name+" ("+f+")"}else{return e.source.name}};c.saToDisplayAbbr=function(e){var f=e.operationGroup.mapAbbrs().join(c.OPERATION_DISPLAY_SPLITTER_ABBR);if(f){return e.source.name+"("+f+")"}else{return e.source.name}}})();(function(e){var d=andrea.grace;var f=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var b=d.constants.VizType;var c=d.views.analysisResult.viz.VizBase;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.HighChartsBase");var a=d.views.analysisResult.viz.highCharts.HighChartsBase=function(j,g,h){a.superclass.constructor.apply(this,arguments);this._chartType=g;this._vizType=h};andrea.blink.extend(a,c);a.prototype.highConfig=function(){return f.genMain(this._chartType)};a.prototype._setVisualized=function(h,k,j,l,g){f._setVisualized(k);f._setVisualized(j);f._setVisualized(l)};a.prototype.render=function(k,m,p){var j=f.genMain(this._chartType);var n={array:this.dataConfigArgs(k,m,p)};var q=function(t,v,u,w,s,r){n.object={dataProvider:t,seriesSA:v,categorySA:u,dataSAs:w,isSeriesByDatas:s,turboThreshold:r}};q.apply(this,n.array);this._setVisualized.apply(this,n.array);var h=a.checkOutdate(this._vizType,n);if(!h.render){return false}var g=f.dataConfig.apply(null,n.array);this.completeHighConfig(j,g,k,m,p);j.plotOptions=j.plotOptions||{};j.plotOptions.series=j.plotOptions.series||{};j.plotOptions.series.turboThreshold=n.object.turboThreshold;j.plotOptions.series.stickyTracking=false;if(!h.animation){j.plotOptions.series.animation=false}if(g.allPositive){j.xAxis=j.xAxis||{};j.xAxis.min=0;if(!j.yAxis){j.yAxis={};j.yAxis.min=0}else{for(var l=0;l<j.yAxis.length;l++){j.yAxis[l].min=0}}}e(this._dom).highcharts(j);return true};a.prototype.dataConfigArgs=function(g,h,j){};a.prototype.completeHighConfig=function(j,h,g,k,l){};a.checkOutdate=function(l,h){var m=function(n){if(n!=null){return JSON.parse(JSON.stringify(n))}else{return null}};var k={vizType:l,numRows:h.object.dataProvider.numRows,seriesSA:m(h.object.seriesSA),categorySA:m(h.object.categorySA),dataSAs:m(h.object.dataSAs),isSeriesByDatas:h.object.isSeriesByDatas};var g=c._renderingCache;var j;if(!g){j={render:true,animation:true}}else{if(!_.isEqual(g,k)){j={render:true,animation:g.numRows===k.numRows}}else{j={render:false}}}if(j.render){c._renderingCache=k}return j}})(jQuery);(function(c){var b=andrea.grace;var a=b.constants.VizType;var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var f=b.calculator.supportClasses.CalculatorFactory;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.Pie");var d=b.views.analysisResult.viz.highCharts.Pie=function(g){d.superclass.constructor.apply(this,[g,"pie",a.PIE])};andrea.blink.extend(d,b.views.analysisResult.viz.highCharts.HighChartsBase);d.prototype.dataConfigArgs=function(h,j,k){var g=b.Settings.dataDiscovery.highcharts.turboThreshold.pie;return[h,null,j[0],k.slice(0,1),false,g]};d.prototype.completeHighConfig=function(h,g,k,q,r){h.xAxis={title:{text:q[0].source.name},categories:g.categories};for(var m=0;m<g.series.length;m++){var n=g.series[m].data;for(var l=0;l<n.length;l++){n[l].y=n[l].data[0]}}h.series=g.series;h.tooltip={hideDelay:240};h.plotOptions={series:{dataLabels:{enabled:true,formatter:function(){return"<b>"+this.point.name+"</b>: "+this.percentage.toFixed(2)+" %"}}}};if(h.series.length>50){this._addMessage("W001");var p=this;_.delay(function(){this._removeMessages()},300)}else{}}})(jQuery);(function(d){var c=andrea.grace;var e=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var b=c.constants.VizType;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.BasicXY");var a=c.views.analysisResult.viz.highCharts.BasicXY=function(h,f,g){a.superclass.constructor.apply(this,arguments);this._chartType=f;this._vizType=g;this._isSeriesByDatas=false};andrea.blink.extend(a,c.views.analysisResult.viz.highCharts.HighChartsBase);a.prototype.dataConfigArgs=function(g,h,j){var j;var f=c.Settings.dataDiscovery.highcharts.turboThreshold.xy;if(h.length>1){j=j.slice(0,1);return[g,h[1],h[0],j,this._isSeriesByDatas,f]}else{j=j;this._isSeriesByDatas=true;return[g,null,h[0],j,this._isSeriesByDatas,f]}};a.prototype.completeHighConfig=function(l,g,m,s,x){l.xAxis={};if(s&&s[0]){l.xAxis.title={text:e.saToDisplayAbbr(s[0])}}else{l.xAxis.title={text:null}}if(g.categories){l.xAxis.categories=g.categories;l.xAxis.labels={rotation:-45,align:"right"}}else{l.xAxis.categories=[""]}l.yAxis=[];var u=function(j){var y;if(!j){y=null}else{if(this._vizType===b.RADAR){y=null}else{y=e.saToDisplay(j)}}return{title:{text:y}}};if(this._isSeriesByDatas){for(var q=0;q<x.length;q++){var t=u.call(this,x[q]);t.opposite=q%2===1;l.yAxis.push(t)}}else{l.yAxis.push(u.call(this,x.length===1?x[0]:null))}for(var q=0;q<g.series.length;q++){var p=g.series[q];if(l.yAxis.length===g.series.length){p.yAxis=q}var r=p.data;for(var k=0;k<r.length;k++){r[k].y=r[k].data[0]}}l.series=g.series;var w=l.series.length>1;l=_.defaults(l,e.genLegend(w));l.tooltip={headerFormat:'<span style="font-size:10px">{point.key}</span><table>',footerFormat:"</table>",shared:this._isSeriesByDatas,useHTML:true,hideDelay:240};if(w){l.tooltip.pointFormat='<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0"><b>{point.y}</b></td></tr>'}else{l.tooltip.pointFormat='<tr><td style="padding:0"><b>{point.y}</b></td></tr>'}if(this._vizType){if(this._vizType===b.RADAR){l.chart.polar=true;l.xAxis.labels={rotation:0,align:"center"}}else{if(this._vizType===b.STACKED_BAR||this._vizType===b.STACKED_COLUMN){l.plotOptions={series:{stacking:"normal"}}}}}var h=l.series.length;var v=h>0?l.series[0].data.length:0;var f;var n;if(b.horizontal(this._vizType)){n="width"}else{if(b.vertical(this._vizType)){n="height"}}if(this._vizType===b.BAR||this._vizType===b.COLUMN){f=h*v*12}else{if(this._vizType===b.STACKED_BAR||this._vizType===b.STACKED_COLUMN){f=v*18}else{if(this._vizType===b.LINE||this._vizType===b.AREA){f=h*6}}}if(n&&f>this._$dom[n]()){this._$dom[n](f)}}})(jQuery);(function(d){var c=andrea.grace;var f=andrea.grace.views.analysisResult.viz.highCharts.supportClasses.HighChartsOption;var a=c.constants.VizType;var e=c.utils.ColorUtil;andrea.blink.declare("andrea.grace.views.analysisResult.viz.highCharts.Scatter");var b=c.views.analysisResult.viz.highCharts.Scatter=function(j,g,h){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,c.views.analysisResult.viz.highCharts.HighChartsBase);b.prototype.render=function(g,h,j){if(j.length>=3){this._chartType="bubble"}else{this._chartType="scatter"}return b.superclass.render.apply(this,arguments)};b.prototype.dataConfigArgs=function(h,j,k){k=k.slice(0,3);var g=c.Settings.dataDiscovery.highcharts.turboThreshold.scatter;if(j.length===1){return[h,null,j[0],k,false,g]}else{return[h,j[0],j[1],k,false,g]}};b.prototype.completeHighConfig=function(v,l,D,g,r){var y,x;v.xAxis={title:{text:f.saToDisplay(r[0])},startOnTick:true,endOnTick:true};v.yAxis={};var m=r.length>1?f.saToDisplay(r[1]):null;v.yAxis.title={text:m};v.yAxis.labels={enabled:m!==null};var k;var p=[];if(g.length===1){p.push("<b>"+f.saToDisplayAbbr(g[0])+": </b>{point.name}")}else{if(g.length===2){p.push("<b>"+f.saToDisplayAbbr(g[0])+": </b>{series.name}");p.push("<b>"+f.saToDisplayAbbr(g[1])+": </b>{point.name}")}}p.push("    "+f.saToDisplayAbbr(r[0])+": {point.x}");if(r.length>1){p.push("    "+f.saToDisplayAbbr(r[1])+": {point.y}")}if(r.length>2){p.push("    "+f.saToDisplayAbbr(r[2])+": {point.z}")}k=p.join("<br/>");var C;C="";v.plotOptions={series:{tooltip:{pointFormat:k,headerFormat:C}}};v.tooltip={hideDelay:240};var n;var w;var E;n=[];var q=Highcharts.getOptions().colors;for(y=0;y<l.series.length;y++){var t=l.series[y];var u=t.data;w=[];for(x=0;x<u.length;x++){var B=u[x];var A=B.data;if(A.length===1&&A[0]===0){continue}else{if(A.length===2&&A[0]===0&&A[1]===0){continue}else{if(A.length===3&&A[0]===0&&A[1]===0&&A[2]===0){continue}}}E={name:B.name,x:A[0],y:A[1]!=null?A[1]:1,z:A[2]!=null?A[2]:1};w.push(E)}var h=e.hexToRgb(q[y%q.length]);n.push({name:t.name,data:w,color:"rgba("+h.r+", "+h.g+", "+h.b+", .65)"})}v.series=n;var z=v.series.length>1;v=_.defaults(v,f.genLegend(z));if(v.series.length>50||(v.series.length*v.series[0].data.length>1000)){this._addMessage("W001");_.delay(d.proxy(function(){this._removeMessages()},this),300)}else{}}})(jQuery);(function(e){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.AnalysisResult");var f=d.views.analysisResult.viz.VizFactory;var c=d.constants.VizType;var b=d.models.DataProvider;var g=d.utils.FilterUtil;var a=d.views.analysisResult.AnalysisResult=function(h){a.superclass.constructor.apply(this,arguments);this._$dom=e(h);this._$dom.addClass("grace-result fancy-scrollbar");this._renderArgs=null};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype.render=function(r,l,k,p,u){this._renderArgs=arguments;var n=function(v){v.visualized=false;v.numPartialVisualized=0};_.each(p,n);_.each(u,n);l=g.filter(l,k);var q=null;if(l&&l.numRows===0){q=null}else{if(r===c.RECOMMEND){q=this._recommend(l,p,u)}else{if(this._valid(r,l,p,u)){q=r}else{q=null}}}var m=e("<div/>").css({height:this.size().height+"px"});this._$dom.append(m);var s=f.produce(m[0],q,r);var t=s.render(l,p,u);if(t){while(this._$dom.children().length>1){this._$dom.children().eq(0).detach()}var j=this.size();var h=s.size();this._$dom.css({"overflow-x":"hidden","overflow-y":"hidden"});if(h.width>j.width){this._$dom.css("overflow-x","auto")}if(h.height>j.height){this._$dom.css("overflow-y","auto")}}else{while(this._$dom.children().length>1){this._$dom.children().eq(this._$dom.children().length-1).detach()}}};a.prototype._validateSize=function(){var h=this.size();this._$dom.css({height:h.height+"px",width:h.width+"px"});if(this._renderArgs){this.render.apply(this,this._renderArgs)}};a.prototype._recommend=function(k,l,p){if(p.length===0){return null}var n,m;var j,h;if(l.length>=2&&p.length>=2){return c.SCATTER}else{if(l.length>=2&&p.length===1){n=l[0];j=k.getCValues(n.source.index,true,false).length;m=l[1];h=k.getCValues(m.source.index,true,false).length;if(n.isDateSeries()){return c.LINE}else{if(j<16&&h<16){return c.COLUMN}else{if((j*h)>(40*40)){return c.SCATTER}else{if(j>h){return c.STACKED_COLUMN}else{return c.STACKED_BAR}}}}}else{if(l.length===1){n=l[0];j=k.getCValues(n.source.index,true,false).length;if(n.isDateSeries()){return c.LINE}else{return c.COLUMN}}else{if(l.length===0){return c.BAR}}}}return null};a.prototype._valid=function(l,h,k,n){var j=c.manifest(l);var m=j.required;return k.length>=m.numDimensions&&n.length>=m.numMeasures}})(jQuery);(function(e){var d=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisResult.AnalysisResultMediator");var c=d.constants.AppConst;var b=d.managers.Log;var a=d.views.analysisResult.AnalysisResultMediator=function(f){a.superclass.constructor.apply(this,arguments);this._view=f;this._model=null};andrea.blink.extend(a,andrea.blink.mvc.ViewMediator);a.prototype.init=function(){var h=this;var f=this._model=this._getModel(c.MODEL_GRACE);var g=function(j){var k=[];_.each(j,function(l){k.push(l.source.name)});return[j.length,k.join("|")].join(",")};this._subscribe(c.NOTIFICATION_VIZ_CONTEXT_CHANGED,function(j){b.interaction("analysis",[g(f.analysisDimesions()),g(f.analysisDatas()),g(f.analysisFilters())].join(","));h._view.render(f.vizType(),f.dataProvider,f.analysisFilters(),f.analysisDimesions(),f.analysisDatas());f.invalidateShelvedAnalysis()});h._view.render(f.vizType(),f.dataProvider,f.analysisFilters(),f.analysisDimesions(),f.analysisDatas())}})(jQuery);(function(){var a=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.VizIconEvent");var b=a.views.popUp.VizIconEvent=function(c,e,d){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.events.Event);b.CLICK="click"})();(function(c){var b=andrea.grace;var d=b.views.popUp.VizIconEvent;andrea.blink.declare("andrea.grace.views.vizNavigator.VizIcon");var a=b.views.vizNavigator.VizIcon=function(f,e){a.superclass.constructor.apply(this,arguments);this._$dom=c(this._dom);this._enabled=false;this._selected=false;this._data=e.data;this._basicClass=e.basicClass;this._enabledClass=e.enabledClass;this._selectedClass=e.selectedClass;var g=this;this._$dom.addClass(this._basicClass).click(function(){g.dispatchEvent(new d(d.CLICK,g))});if(this._data.icon){this._$dom.css({"background-image":'url("'+this._data.icon+'")'})}else{if(this._data.title){c("<div/>").text(this._data.title).appendTo(this._$dom)}}this._$dom.attr({title:this._data.title})};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype.type=function(){return this._data.type};a.prototype.enabled=function(e){if(arguments.length>0){if(this._enabled!==e){this._enabled=e;if(this._enabled){if(!this.selected()){this._$dom.addClass(this._enabledClass)}else{this._$dom.removeClass(this._enabledClass)}}else{this._$dom.removeClass(this._enabledClass)}}return this}else{return this._enabled}};a.prototype.selected=function(e){if(arguments.length>0){if(this._selected!==e){this._selected=e;if(this._selected){this._$dom.addClass(this._selectedClass);this._$dom.removeClass(this._enabledClass)}else{this._$dom.removeClass(this._selectedClass);if(this.enabled()){this._$dom.addClass(this._enabledClass)}}}return this}else{return this._selected}};a.prototype.update=function(f,e){var g=this._data.required;this.enabled(f>=g.numDimensions&&e>=g.numMeasures)}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.popUp.VizNavigatorEvent");var a=b.views.popUp.VizNavigatorEvent=function(c,e,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.events.Event);a.VIZ_CHANGED="vizChanged"})();(function(f){var e=andrea.grace;var d=e.views.vizNavigator.VizIcon;var g=e.views.popUp.VizIconEvent;var c=e.views.popUp.VizNavigatorEvent;var b=e.constants.VizType;andrea.blink.declare("andrea.grace.views.vizNavigator.VizNavigator");var a=e.views.vizNavigator.VizNavigator=function(l){a.superclass.constructor.apply(this,arguments);this._$dom=f(this._dom);this._selectedType=null;this._defaultViewIcon=null;var n=b;var h=n.manifest(n.RECOMMEND);var v=[{title:"对比",icons:[n.manifest(n.COLUMN),n.manifest(n.BAR),n.manifest(n.RADAR)]},{title:"相关性",icons:[n.manifest(n.SCATTER)]},{title:"趋势",icons:[n.manifest(n.LINE),n.manifest(n.AREA)]},{title:"贡献度",icons:[n.manifest(n.PIE),n.manifest(n.STACKED_COLUMN),n.manifest(n.STACKED_BAR)]}];var p=this;this._vizIcons=[];var u=f("<div/>").appendTo(this._$dom).addClass("grace-navigator-contaier");var j=f("<div/>").appendTo(u).addClass("grace-navigator-recommend");var s=f("<div/>").appendTo(j);var k=this._defaultViewIcon=new d(s[0],{data:h,basicClass:"grace-navigator-recommend-icon",enabledClass:"grace-navigator-recommend-icon-enabled",selectedClass:"grace-navigator-recommend-icon-selected"});f("div",k.dom()).css("margin-top","4px");this._vizIcons.push(k);var t=f("<div/>").appendTo(u).addClass("grace-navigator-selector");var r;r=f("<div/>").appendTo(t).addClass("grace-navigator-line");this._createGroup(r,v[0]);this._createGroup(r,v[1]);r=f("<div/>").appendTo(u).addClass("grace-navigator-line");this._createGroup(r,v[2]);this._createGroup(r,v[3]);var q=function(w){p._select(w.target())};for(var m=0;m<this._vizIcons.length;m++){this._vizIcons[m].addEventListener(g.CLICK,q)}k.enabled(true);this._select(this._defaultViewIcon)};andrea.blink.extend(a,andrea.blink.mvc.View);a.prototype._createGroup=function(p,q){var l=this;$group=f("<div/>").appendTo(p).addClass("grace-navigator-group");var h=f("<h2/>").appendTo($group).addClass("grace-navigator-group-text");h.text(q.title);var r=f("<div/>").appendTo($group).addClass("grace-navigator-group-icons");for(var j=0;j<q.icons.length;j++){var n=q.icons[j];var m=f("<div/>").appendTo(r);var k=new d(m[0],{data:n,basicClass:"grace-navigator-group-icon",enabledClass:"grace-navigator-group-icon-enabled",selectedClass:"grace-navigator-group-icon-selected"});this._vizIcons.push(k)}};a.prototype.selectedType=function(){return this._selectedType};a.prototype._select=function(h){if(!h.enabled()||h.selected()){return}this._selectedType=h.type();_.each(this._vizIcons,function(j){j.selected(j===h)});this.dispatchEvent(new c(c.VIZ_CHANGED,this))};a.prototype.update=function(j,h){var k=this;_.each(this._vizIcons,function(l){var n=l.selected();l.update(j,h);var m=l.enabled()})}})(jQuery);(function(e){var c=andrea.grace;var b=c.views.popUp.VizNavigatorEvent;var a=c.constants.AppConst;andrea.blink.declare("andrea.grace.views.vizNavigator.VizNavigatorMediator");var d=c.views.vizNavigator.VizNavigatorMediator=function(f){d.superclass.constructor.apply(this,arguments);this._view=f;this._model=null};andrea.blink.extend(d,andrea.blink.mvc.ViewMediator);d.prototype.init=function(){var g=this;var f=this._model=this._getModel(a.MODEL_GRACE);this._view.addEventListener(b.VIZ_CHANGED,function(h){g._action(a.ACTION_RUN_ANALYSIS,{vizType:g._view.selectedType()})},this);this._subscribe(a.NOTIFICATION_VIZ_CONTEXT_CHANGED,function(h){g._view.update(f.analysisDimesions().length,f.analysisDatas().length)})}})(jQuery);(function(){var d=andrea.grace;andrea.blink.declare("andrea.grace.DataDiscovery");var c=andrea.blink.mvc.App;var a=d.constants.AppConst;var b=d.DataDiscovery=function(e){b.superclass.constructor.apply(this,arguments);this._div=e;this._$dom=$(e);this._viewSourceDim=null;this._viewSourceMea=null;this._viewDesDimensionShelf=null;this._viewDesMeasureShelf=null;this._viewFilterShelf=null;this._viewAnalysisResult=null;this._viewVizNavigator=null;this._applyHighSettings();this._startup()};andrea.blink.extend(b,andrea.blink.mvc.View);b.prototype._applyHighSettings=function(){Highcharts.setOptions({chart:{style:{fontFamily:"Trebuchet MS, Verdana, sans-serif, FontAwesome"}}})};b.prototype.rowBasedDataProvider=function(g,f,e){this._apiMediator.rowBasedDataProvider(g,f,e)};b.prototype._startup=function(){var h=new c();var f=null;var g=null;this._viewSourceDim=new d.views.analysisContainer.source.SrcDimensionShelf($("#divSrcDim")[0]);this._viewSourceMea=new d.views.analysisContainer.source.SrcMeasureShelf($("#divSrcMea")[0]);this._viewDesDimensionShelf=new d.views.analysisContainer.destination.DesDimensionShelf($("#divDesAnalysisDim")[0]);this._viewDesMeasureShelf=new d.views.analysisContainer.destination.DesMeasureShelf($("#divDesAnalysisMea")[0]);this._viewFilterShelf=new d.views.analysisContainer.processor.FilterShelf($("#divProcFilter")[0]);this._viewAnalysisResult=new d.views.analysisResult.AnalysisResult($("#divAnalysisResult")[0]);this._viewVizNavigator=new d.views.vizNavigator.VizNavigator($("#divVizNavigator")[0]);h.registerModel(a.MODEL_GRACE,new d.models.DataDiscoveryModel());h.registerAction(a.ACTION_CHANGE_DATA_PROVIDER,d.actions.ChangeDataProviderAction);h.registerAction(a.ACTION_RUN_ANALYSIS,d.actions.RunAnalysisAction);g=new d.DataDiscoveryMediator();h.registerViewMediator(a.MEDIATOR_DATA_DISCOVERY,g);this._apiMediator=g;g=new d.views.analysisContainer.source.SrcDimensionShelfMediator(this._viewSourceDim);h.registerViewMediator(a.MEDIATOR_ANALYSIS_SRC_DIM,g);g=new d.views.analysisContainer.source.SrcMeasureShelfMediator(this._viewSourceMea);h.registerViewMediator(a.MEDIATOR_ANALYSIS_SRC_MEA,g);g=new d.views.analysisContainer.destination.DesDimensionShelfMediator(this._viewDesDimensionShelf);h.registerViewMediator(a.MEDIATOR_ANALYSIS_DES_DIM,g);g=new d.views.analysisContainer.destination.DesMeasureShelfMediator(this._viewDesMeasureShelf);h.registerViewMediator(a.MEDIATOR_ANALYSIS_DES_MEA,g);g=new d.views.analysisContainer.processor.FilterShelfMediator(this._viewFilterShelf);h.registerViewMediator(a.MEDIATOR_ANALYSIS_DES_MEA,g);g=new d.views.analysisResult.AnalysisResultMediator(this._viewAnalysisResult);h.registerViewMediator(a.MEDIATOR_ANALYSIS_RESULT,g);g=new d.views.vizNavigator.VizNavigatorMediator(this._viewVizNavigator);h.registerViewMediator(a.MEDIATOR_VIZ_NAVIGATOR,g);var j=this;var e=false;$(window).resize(function(){if(!e){setTimeout(function(){e=false;j._validateSize()},1000/24)}e=true});this._validateSize()};b.prototype._validateSize=function(){var t;var v,q;var r=parseInt($("body").css("margin"));var f=$(window).height()-r*2;var j=$(window).width()-r*2;var g=$("#divHeader",this._$dom);var p=$("#divFooter",this._$dom);var k=$("#divMain",this._$dom);var u=f-g.outerHeight()-p.outerHeight()-k.vMargin();var l=j-k.hMargin();k.css({height:u+"px",width:l+"px"});var s=172;$("#divCol1").css({width:s+"px",height:u+"px"});t=$(this._viewSourceDim.dom());var e=parseInt($(this._viewSourceDim.dom()).css("margin-bottom"));this._viewSourceDim.size({width:s,height:(u-e)/2+e-t.vPadding()-6});this._viewSourceMea.size({width:s,height:(u-e)/2+e-t.vPadding()-6});var x=142;$("#divCol2").css({width:x+"px",});this._viewFilterShelf.size({height:228});v=l-$("#divCol1").layoutWidth()-$("#divCol2").layoutWidth();$("#divCol3").css({width:v+"px",height:u+"px"});var n=$("#divVizNavigator",this._$dom);var m=$("#divDestinations",this._$dom);m.css({width:Math.min(1024,v-n.width()-parseInt(m.css("margin-right")))+"px"});this._viewDesDimensionShelf.size({height:35+34*1-6});this._viewDesMeasureShelf.size({height:35+34*1-6});this._viewAnalysisResult.size({height:u-(35+34*1)*2})};b.prototype._createChildDiv=function(e){var f=document.createElement("div");if(e){$(f).appendTo(e)}return f}})();(function(d){var c=andrea.grace;andrea.blink.declare("andrea.grace.DataDiscoveryMediator");var a=c.constants.AppConst;var b=andrea.grace.DataDiscoveryMediator=function(){b.superclass.constructor.apply(this,arguments)};andrea.blink.extend(b,andrea.blink.mvc.ViewMediator);b.prototype.rowBasedDataProvider=function(g,f,e){this._action(a.ACTION_CHANGE_DATA_PROVIDER,{rows:g,columnDescriptors:f,source:e})}})(jQuery);(function(){var b=andrea.grace;andrea.blink.declare("andrea.grace.views.analysisContainer.events.DataSourceEvent");var a=b.views.analysisContainer.events.DataSourceEvent=function(c,e,d){a.superclass.constructor.apply(this,arguments)};andrea.blink.extend(a,andrea.blink.events.Event);a.DATA_SOURCE_READY="dataSourceReady"})();(function(){var g=andrea.grace;var f=g.views.components.MoreButton;var l=g.views.analysisContainer.events.DataSourceEvent;var e=g.utils.URLUtil;var c=g.constants.AnalysisType;var a=g.constants.Taobao;var j=g.utils.ConverterType;var h=g.views.popUp.Loading;var b=g.utils.Stopwatch;var d=g.managers.Log;andrea.blink.declare("andrea.grace.DataSource");var k=g.DataSource=function(r){k.superclass.constructor.apply(this,arguments);this._$main=$("#divDataSourceMain",this._$dom);this._$main.empty();this._loading=null;this._btnAnalysis=null;this._$btnAnalysis=null;this._watch;this._cdaReady=false;this._cdsNumTrades=0;this._dp=null;var p=this._genCell(0,0,3,2).addClass("grace-dataSource-main-container").appendTo(this._$main);p.css({position:"absolute",left:(this._$main.width()-p.width())/2,top:(this._$main.height()-p.height())/2});if($.browser.webkit){this._createChildren(p)}else{var m=this._genCell(0,0,3,2).appendTo(p);m.text("请通过谷歌浏览器使用易分析！").addClass("grace-dataSource-chrome");m.css("line-height",m.height()+"px");m.on("click",$.proxy(function(s){window.location=g.Settings.chrome.localURL},this));var q=$("<a/>").appendTo(p).addClass("grace-dataSource-chrome-official");q.text("官方下载…").css("color","#ffffff");q.attr({target:"_blank",href:g.Settings.chrome.officialURL}).on("click",function(s){s.stopPropagation()})}var n=e.hashPairs();if(n.dataSource==="taobao"){this._gotoTaobao()}};andrea.blink.extend(k,andrea.blink.mvc.View);k.prototype._gotoTaobao=function(){var r=e.hashPairs();var n=g.Settings.crossDomainAccessor;if(r.access_token&&r.taobao_user_id&&r.taobao_user_nick){this._watch=new b([r.taobao_user_id,r.taobao_user_nick].join(","),true);this._addLoading("",0);this._getCrossDomainAccessor($.proxy(function(t){t.setAccessToken(r.access_token);var s=[];for(var u=0;u<this._dp.columnDescriptors.length;u++){s.push(this._dp.columnDescriptors[u].id)}d.interaction("dataSource",["taobao",r.taobao_user_id,r.taobao_user_nick].join(","));t.load(n.taobao.trade.maxResults,s.join(","));d.performance("loadTaobaoTrades",[this._watch.type,"loadSWF",this._watch.lap()].join(","))},this))}else{if(r.error){d.interaction("authorizeError",[r.error,r.error_description.replace(/,/g,"|")]);if(r.error==="invalid_client"){var q=prompt("留下您的 店铺。(店铺网址/店铺名称 均可)\n应用尚未正式发布需要手动设置授权。");var m=prompt("留下您的 联系方式。以便完成授权之后通知您。\n(邮箱/QQ/微博 均可)");d.interaction("authorize",[q,m]);if(q&&m){alert("您的店铺已保存，完成授权预计需要一天，请稍候。\n完成后会通知到您。")}else{if(q){alert("您的店铺已保存，完成授权预计需要一天，请稍候。")}}}}else{var p=[];p.push(["client_id",n.taobao.appKey].join("="));p.push(["response_type","token"].join("="));p.push(["redirect_uri",n.taobao.redirect+"?dataSource=taobao"].join("="));window.location.href="https://oauth.taobao.com/authorize?"+p.join("&")}}};k.prototype.destroy=function(){this._loading.close()};k.prototype.faHoverHandler=function(m){if(m){this._btnAnalysis.showP2()}else{this._btnAnalysis.showP1()}};k.prototype.faClickHandler=function(m){this._addLoading()};k.prototype.faCancelHandler=function(){this._removeLoading()};k.prototype.faDataHandler=function(n,q,p){if(g.Settings.debug.egJS){var r=g.Settings.debug.egJS;var m=[];m.push("(function() {");m.push("var grace = andrea.grace;");m.push('andrea.blink.declare("andrea.grace.eg.'+r+'");');m.push("var "+r+" = grace.eg."+r+" = function() {");m.push("this.columnDescriptors = '"+p.replace(/\'/g,"\\'")+"';");m.push("this.rows = '"+q.replace(/\'/g,"\\'")+"';");m.push("}");m.push("})();");console.log(m.join("\n"))}d.interaction("dataSource",["file",this._decode(n)].join(","));this._stringDataHandler(q,p)};k.prototype.cdaReadyHandler=function(){this._cdaReady=true;var n=[];var m=function(s,r,q,p){return{id:s,name:r,converterType:q,analysisType:p}};n.push(m("status","交易状态",j.STRING,c.DIMENSION));n.push(m("type","交易类型",j.STRING,c.DIMENSION));n.push(m("created","交易创建时间",j.DATE,c.DIMENSION));n.push(m("buyer_nick","买家昵称",j.STRING,c.DIMENSION));n.push(m("receiver_state","收货人省份",j.STRING,c.DIMENSION));n.push(m("receiver_city","收货人城市",j.STRING,c.DIMENSION));n.push(m("has_yfx","包含运费险",j.BOOLEAN,c.DIMENSION));n.push(m("shipping_type","物流方式",j.STRING,c.DIMENSION));n.push(m("trade_from","交易来源",j.STRING,c.DIMENSION));n.push(m("orders.title","商品标题",j.STRING,c.DIMENSION));n.push(m("orders.logistics_company","快递公司",j.STRING,c.DIMENSION));n.push(m("orders.price","商品价格",j.NUMBER,c.MEASURE));n.push(m("orders.num","购买数量",j.NUMBER,c.MEASURE));n.push(m("orders.total_fee","应付金额",j.NUMBER,c.MEASURE));this._dp={rows:[],columnDescriptors:n,source:"taobao"}};k.prototype.cdaDataHandler=function(u){d.performance("loadTaobaoTrades",[this._watch.type,"loadData",this._watch.lap()].join(","));var x,w,v;u=this._decode(u);var z=u.trades_sold_get_response.trades.trade;var D=this._dp.rows;var q=this._dp.columnDescriptors;this._cdsNumTrades+=z.length;for(x=0;x<z.length;x++){var A=z[x];var s=A.orders.order;for(w=0;w<s.length;w++){var n=s[w];var C=[];for(v=q.length-1;v>=0;v--){var p=q[v];var m=p.id;var B=m.split(".");if(B[0]==="orders"){m=B[1];C[v]=a.toCaption(n[m],"order",m)}else{m=B[0];C[v]=a.toCaption(A[m],"trade",m)}}D.push(C)}}var r=g.Settings.crossDomainAccessor;var y=this._cdsNumTrades/Math.min(r.taobao.trade.maxResults,u.trades_sold_get_response.total_results);this._loading.percent(y)};k.prototype.cdaCompleteHandler=function(){d.performance("loadTaobaoTrades",[this._watch.type,"loadComplete",this._watch.lap(true),this._watch.total()].join(","));this._dpReady()};k.prototype._getCrossDomainAccessor=function(n){var m=$.proxy(function(){var p=$("#CrossDomainAccessor");if(p[0]&&this._cdaReady){n(p[0])}else{_.delay(m,500)}},this);m()};k.prototype._stringDataHandler=function(n,m){this._dp={rows:_.isString(n)?this._decode(n):n,columnDescriptors:_.isString(m)?this._decode(m):m,source:"excel"};this._dpReady()};k.prototype._encode=function(n){var m=JSON.stringify(n);m=m.replace(/%/g,"%25");m=m.replace(/\\/g,"%5C");m=m.replace(/\"/g,"%22");return m};k.prototype._decode=function(m){m=m.replace(/%22/g,'"');m=m.replace(/%5C/g,"\\");m=m.replace(/%25/g,"%");return JSON.parse(m)};k.prototype._addLoading=function(m,n){this._loading=new h($("<div/>"),m,n);this._loading.open(this._$main,true)};k.prototype._removeLoading=function(){this._loading.close()};k.prototype._loadEg=function(n,m){this._addLoading();LazyLoad.js([n],$.proxy(function(){var p=new g.eg[m]();d.interaction("dataSource",["sample",m].join(","));this._stringDataHandler(p.rows,p.columnDescriptors)},this))};k.prototype._dpReady=function(){this.dispatchEvent(new l(l.DATA_SOURCE_READY,this,this._dp))};k.prototype._createChildren=function(s){var r;var p,q;var t=this._$btnAnalysis=this._createButtonAnalysis(this._genCell(0,0,2,1),s);r=$("<div/>").appendTo(s);p=t.width();q=t.height();var n=g.Settings.fileAccessor;this._embedFlash($("<div/>").appendTo(r),n.name,n.swfURL,"transparent",p,q,{alpha:0,width:p,height:q,hoverCallback:"andrea.grace.Grace.faHoverCallback",clickCallback:"andrea.grace.Grace.faClickCallback",cancelCallback:"andrea.grace.Grace.faCancelCallback",dataCallback:"andrea.grace.Grace.faDataCallback",logFileURL:g.Settings.logFile.url});r.css({"z-index":10000,position:"absolute",left:parseFloat(t.css("left"))+1,top:parseFloat(t.css("top"))+1,width:p,height:q});var m=g.Settings.crossDomainAccessor;this._createButton(this._genCell(0,1,1,1),s,{color:"#ff692f",captions:["淘宝","销售分析"],description:"分析卖家的近3个月销售数据。"}).on("click",$.proxy(function(u){this._gotoTaobao()},this));r=$("<div/>").appendTo(s);p=q=1;this._embedFlash($("<div/>").appendTo(r),m.name,m.swfURL,"window",p,q,{readyCallback:"andrea.grace.Grace.cdaReadyCallback",dataCallback:"andrea.grace.Grace.cdaDataCallback",completeCallback:"andrea.grace.Grace.cdaCompleteCallback"});r.css("visibility","hidden");this._createButton(this._genCell(1,1,1,1),s,{color:"#3498db",captions:["定制","我的数据源…"],description:"创建专属于您的数据源。请邮件至andiris29@gmail.com"}).on("click",$.proxy(function(u){window.location.href="mailto:andiris29@gmail.com?subject=添加定制数据源&body=<请描述您的数据源（如数据库地址、网页地址等）。作者会在至多2个工作日内给您回复。"},this));this._createButton(this._genCell(2,0,1,1),s,{name:"SuperMarket",color:"#e74c3c",captions:["样例","超市销售"],description:"时间、空间、产品、客户等多维度查看及分析超市的销售状况。",link:{text:"下载数据…",url:g.Settings.data.superMarket.excel}}).on("click",$.proxy(function(u){this._loadEg(g.Settings.data.superMarket.js,"SuperMarket")},this));this._createButton(this._genCell(2,1,1,1),s,{color:"#e74c3c",captions:["样例","世界银行"],description:"世界银行公布的各国数据指标。涵盖股市、金融、商业等。",link:{text:"下载数据…",url:g.Settings.data.worldBank.excel}}).on("click",$.proxy(function(u){this._loadEg(g.Settings.data.worldBank.js,"WorldBank")},this))};k.prototype._genCell=function(n,t,q,r){var s={horizontal:30,vertical:20};var m={width:160,height:100};var p=$("<div/>");p.css({width:m.width*q+s.horizontal*(q-1)+"px",height:m.height*r+s.vertical*(r-1)+"px",left:n*(m.width+s.horizontal)+"px",top:t*(m.height+s.vertical)+"px"});return p};k.prototype._embedFlash=function(r,m,x,n,v,t,p){var u=_.uniqueId("flashContent_");var q={};q.quality="high";q.bgcolor="#ffffff";q.allowscriptaccess="sameDomain";q.allowfullscreen="true";q.wmode=n;var s={};s.id=m;s.name=m;s.align="middle";r.attr("id",u);swfobject.embedSWF(x,u,v,t,"11.0.0",null,p,q,s)};k.prototype._createButtonAnalysis=function(r,t){var n=r.addClass("grace-dataSource-main-analysis");var m=$("<div/>").appendTo(n).addClass("grace-dataSource-main-analysis-more");var s=$("<div/>").appendTo(m).addClass("grace-dataSource-main-analysis-p1").css("line-height",r.height()+"px");$("<span/>").appendTo(s).text("数据文件");var q=$("<div/>").appendTo(m).addClass("grace-dataSource-main-analysis-p2");$("<div/>").appendTo(q).addClass("grace-dataSource-main-analysis-p2-ribbon");$("<div/>").appendTo(q).addClass("grace-dataSource-main-analysis-p2-text").text("分析数据文件").css("line-height",r.height()+"px");var p=$("<div/>").appendTo(q).addClass("grace-dataSource-main-analysis-p2-type");$("<div/>").appendTo(p).addClass("grace-dataSource-main-analysis-p2-type-icon");$("<div/>").appendTo(p).addClass("grace-dataSource-main-analysis-p2-type-text").text("2007,2003,CSV");this._btnAnalysis=new f(m[0]);n.appendTo(t);return n};k.prototype._createButton=function(u,n,m){var v=u.addClass("grace-dataSource-main-example").appendTo(n);var q=$("<div/>").appendTo(v).addClass("grace-dataSource-main-example-more");var t=$("<div/>").appendTo(q).addClass("grace-dataSource-main-example-p1").css("background-color",m.color);var p=$("<div/>").appendTo(t).addClass("grace-dataSource-main-example-p1-caption");_.each(m.captions,function(w){$("<span/>").appendTo(p).text(w);$("<br/>").appendTo(p).css("line-height",30+"px")});p.children().last().detach();p.css({top:(u.height()-p.height())/2,left:(u.width()-p.width())/2});var s=$("<div/>").appendTo(q).addClass("grace-dataSource-main-example-p2");$("<div/>").appendTo(s).addClass("grace-dataSource-main-example-p2-ribbon").css("background-color",m.color);$("<div/>").appendTo(s).addClass("grace-dataSource-main-example-p2-icon");$("<div/>").appendTo(s).addClass("grace-dataSource-main-example-p2-text").text(m.description);if(m.link){var r=$("<a/>").appendTo(s).addClass("grace-dataSource-main-example-p2-download");r.text(m.link.text).css("color",m.color);r.attr({target:"_blank",href:m.link.url,title:"右键，另存为…"});r.on("click",function(w){w.stopPropagation()})}new f(q[0]);return v}})();(function(){var e=andrea.grace;var c=e.helpers.PageTransition;var d=e.views.analysisContainer.events.DataSourceEvent;var b=e.managers.Log;var f=e.utils.URLUtil;andrea.blink.declare("andrea.grace.Grace");var a=e.Grace=function(g){var h=f.hashPairs();b.user=h.andrea_user?h.andrea_user:"user";b.interaction("open",JSON.stringify($.browser));a._instance=this;$($.proxy(function(){LazyLoad.js(g,$.proxy(this._jsReady,this));this._$dataSource=$("#divDataSource");this._$dataDiscovery=$("#divDataDiscovery");$("#divMain",this._$dataDiscovery).bind("selectstart",function(){return false});var j=this._dataSource=new e.DataSource(this._$dataSource[0]);j.addEventListener(d.DATA_SOURCE_READY,this._dataSourceDataSourceReadyHandler,this)},this));this._dataSource=null;this._$dataSource=null;this._$dataDiscovery=null;this._lazyLoading=true;this._dp=null};a._instance=null;a._flashCallback=function(h,j,g){_.defer($.proxy(function(){this[j].apply(this,arguments[0])},h),g)};a.faHoverCallback=function(g){a._flashCallback(a._instance._dataSource,"faHoverHandler",arguments)};a.faClickCallback=function(g){a._flashCallback(a._instance._dataSource,"faClickHandler",arguments)};a.faCancelCallback=function(h,g){a._flashCallback(a._instance._dataSource,"faCancelHandler",arguments)};a.faDataCallback=function(h,g){a._flashCallback(a._instance._dataSource,"faDataHandler",arguments);return true};a.cdaReadyCallback=function(){a._flashCallback(a._instance._dataSource,"cdaReadyHandler",arguments)};a.cdaDataCallback=function(g){a._flashCallback(a._instance._dataSource,"cdaDataHandler",arguments)};a.cdaCompleteCallback=function(){a._flashCallback(a._instance._dataSource,"cdaCompleteHandler",arguments)};a.prototype._dataSourceDataSourceReadyHandler=function(g){this._dp=g.data;this._gotoDataDiscovery()};a.prototype._jsReady=function(){this._lazyLoading=false;this._gotoDataDiscovery()};a.prototype._gotoDataDiscovery=function(){if(!this._dp){return}if(this._lazyLoading){return}this._dataSource.destroy();var g=new e.DataDiscovery(this._$dataDiscovery[0]);g.rowBasedDataProvider(this._dp.rows,this._dp.columnDescriptors,this._dp.source);var h=new c({"$page":this._$dataSource,classes:["pt-page-scaleDownCenter"]},{"$page":this._$dataDiscovery,classes:["pt-page-scaleUpCenter"],delay:180},$.proxy(function(){this._$dataSource.css("z-index",-1)},this));_.defer(function(){h.play()})}})();